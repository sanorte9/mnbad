<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MN Badminton Tournament 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .header .subtitle {
                font-size: 16px;
            }
            
            
            .admin-progress-container {
                margin: 15px 0;
                padding: 15px;
            }
            
            .admin-progress-label {
                font-size: 16px;
            }
            
            .admin-progress-bar {
                height: 14px;
            }
            
            .admin-progress-text {
                font-size: 14px;
            }
            
            .admin-btn {
                top: 25px;
                right: 30px;
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .category-btn {
                padding: 20px;
            }
            
            .category-name {
                font-size: 18px;
            }
            
            .category-info {
                font-size: 14px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
            }
            
            .header {
                padding: 30px;
            }
            
            .nav-container {
                padding: 30px;
            }
            
            .content-area {
                padding: 30px;
            }
            
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
            
            .category-btn {
                padding: 24px;
            }
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }


        .admin-progress-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .admin-progress-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .admin-progress-bar {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .admin-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.3);
        }

        .admin-progress-text {
            font-size: 12px;
            color: #666;
            text-align: center;
            font-weight: 600;
        }

        .admin-btn {
            position: absolute;
            top: 50px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-container {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .nav-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .category-btn {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-color: #0056b3;
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .category-info {
            font-size: 12px;
            opacity: 0.7;
        }

        .status-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .content-area {
            padding: 20px;
            min-height: 400px;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }

        .welcome-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .welcome-text {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bracket-container {
            padding: 0;
        }

        .bracket-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
        }

        .bracket-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .bracket-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .tab-btn.active {
            background: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            padding: 20px;
            min-height: 400px;
        }

        .groups-container {
            padding: 0;
            display: grid;
            gap: 20px;
        }

        .group-card {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        .group-title {
            background: #343a40;
            color: white;
            padding: 12px 15px;
            font-weight: 600;
            text-align: center;
        }

        .standings-table {
            background: white;
        }

        .table-header {
            display: grid;
            grid-template-columns: 35px 1fr 35px 35px 35px 35px 45px 45px;
            gap: 6px;
            padding: 8px 12px;
            background: #e9ecef;
            font-weight: 600;
            font-size: 11px;
            color: #495057;
        }

        .team-row {
            display: grid;
            grid-template-columns: 35px 1fr 35px 35px 35px 35px 45px 45px;
            gap: 6px;
            padding: 8px 12px;
            border-bottom: 1px solid #f1f3f4;
            align-items: center;
            font-size: 12px;
        }

        .team-row.qualified {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }

        .rank {
            font-weight: 600;
            color: #666;
        }

        .team-name {
            font-size: 12px;
            color: #333;
            font-weight: 600;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .points {
            font-weight: 600;
            color: #007bff;
            text-align: center;
        }
        
        .total-points {
            color: #28a745;
            font-weight: 500;
            text-align: center;
        }
        
        .team-row span {
            text-align: center;
        }
        
        .team-row span:nth-child(2) {
            text-align: left;
        }

        .round-robin-matches {
            padding: 20px 0;
            border-top: 1px solid #e9ecef;
            background: #fafafa;
            margin: -20px;
            margin-top: 20px;
        }

        .matches-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 0 20px 15px 20px;
        }

        .group-matches {
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .group-matches-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #343a40;
            color: white;
            border-radius: 6px;
            text-align: center;
        }

        .round-robin-match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .round-robin-match-card.completed {
            border-color: #28a745;
        }

        .rr-match-header {
            background: #f8f9fa;
            padding: 6px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #666;
        }

        .round-robin-match-card.completed .rr-match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .rr-match-teams {
            padding: 12px;
        }

        .rr-team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .rr-team:last-child {
            border-bottom: none;
        }

        .rr-team-name {
            font-size: 13px;
            color: #333;
            flex: 1;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .set-score {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .set-score.set-win {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .total-sets {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            margin-left: 2px;
        }

        .total-sets.match-win {
            background: #28a745;
            color: white;
        }

        .rr-vs {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 3px 0;
            font-size: 10px;
        }

        .knockout-section {
            padding: 20px 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .matches-grid {
            display: grid;
            gap: 10px;
        }

        .match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .match-card.completed {
            border-color: #28a745;
        }

        .match-card.pending {
            border-color: #ffc107;
        }

        .match-header {
            background: #f8f9fa;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #666;
        }

        .match-card.completed .match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .match-teams {
            padding: 15px;
        }

        .team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .team:last-child {
            border-bottom: none;
        }

        .team-score {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .team-score.winner {
            background: #d4edda;
            color: #155724;
        }

        .vs {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 5px 0;
            font-size: 12px;
        }

        .finals-section {
            padding: 20px 0;
        }

        .finals-container {
            display: grid;
            gap: 20px;
        }

        .final-match {
            text-align: center;
        }

        .match-label {
            background: #343a40;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .championship .match-label {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #333;
        }

        .third-place .match-label {
            background: #cd7f32;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-login {
            background: #007bff;
            color: white;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .refresh-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        .refresh-btn {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }

        .refresh-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
        }

        .refresh-btn.loading {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            animation: pulse 1s infinite;
        }

        .refresh-btn.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .refresh-btn.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .error-message {
            background: #fdf2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message h4 {
            color: #e74c3c;
            margin: 0 0 10px 0;
        }

        .error-message p {
            color: #666;
            margin: 0 0 15px 0;
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }

        .nav-tab-btn {
            flex: 1;
            padding: 10px 15px;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab-btn.active {
            background: white;
            color: #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-view {
            transition: all 0.3s ease;
        }

        .team-search-container {
            padding: 10px 0;
        }

        .team-search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .team-search-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .team-search-results {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .team-result-item {
            padding: 12px 16px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .team-result-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }

        .team-result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .team-result-info {
            font-size: 12px;
            color: #666;
        }

        .team-matches-container {
            padding: 20px;
        }

        .team-matches-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
            border-radius: 12px 12px 0 0;
        }

        .team-matches-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .team-matches-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .team-match-section {
            margin-bottom: 25px;
        }

        .team-match-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .admin-container {
            padding: 0;
        }

        .admin-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
            position: relative;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .admin-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .admin-logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .admin-tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .admin-tab-btn {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .admin-tab-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .admin-tab-btn.active {
            background: white;
            color: #dc3545;
            border-bottom-color: #dc3545;
        }

        .admin-tab-content {
            padding: 20px;
            min-height: 400px;
        }

        .admin-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 16px;
        }

        /* Settings Styles */
        .settings-container {
            padding: 20px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .settings-header h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .settings-section h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        .settings-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .action-group label {
            font-weight: 600;
            color: #333;
        }

        .action-group small {
            color: #666;
            font-size: 12px;
        }

        .danger-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 200px;
        }

        .danger-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .warning-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 200px;
        }

        .warning-btn:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .primary-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .primary-btn:hover {
            background: #0056b3;
        }

        .secondary-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            background: #545b62;
        }

        .sheets-info, .system-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-item label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }

        .sheets-link {
            color: #007bff;
            text-decoration: none;
            word-break: break-all;
            font-size: 12px;
        }

        .sheets-link:hover {
            text-decoration: underline;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-indicator.success {
            background: #d4edda;
            color: #155724;
        }

        .password-section {
            margin: 20px 0;
        }

        .password-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .password-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .url-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .url-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            font-family: monospace;
        }

        .url-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .small-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }

        .small-btn:hover {
            background: #218838;
        }

        .status-indicator.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-indicator.error {
            background: #f8d7da;
            color: #721c24;
        }

        .error {
            padding: 20px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .match-management-container {
            padding: 0;
        }

        .match-management-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .match-management-header h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 8px;
        }

        .match-management-header p {
            color: #666;
            margin: 0;
        }

        .category-selector {
            margin-bottom: 25px;
        }

        .selectors-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .round-selector {
            margin-bottom: 0;
        }

        .category-selector label,
        .round-selector label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }


        .search-no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .no-results-text {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .no-results-hint {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
        }

        .admin-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .admin-select:focus {
            outline: none;
            border-color: #dc3545;
        }

        .admin-matches-list {
            border: 2px solid #f1f3f4;
            border-radius: 8px;
            min-height: 300px;
        }

        .no-selection {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #666;
            font-style: italic;
        }

        .all-matches-container {
            padding: 0;
        }

        .all-matches-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .all-matches-header h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
        }

        .matches-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .summary-label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .all-matches-content {
            background: #f8f9fa;
            padding: 40px 20px;
            border-radius: 8px;
            text-align: center;
            color: #666;
        }

        .all-matches-filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .matches-table-container {
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            overflow: hidden;
        }

        .matches-table-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .table-stats {
            font-weight: 600;
            color: #495057;
        }

        .matches-table-scroll {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .matches-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .matches-table th {
            background: #343a40;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .matches-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .match-row.completed {
            background: rgba(40, 167, 69, 0.05);
        }

        .match-row.pending {
            background: rgba(255, 193, 7, 0.05);
        }


        .match-category {
            font-weight: 600;
        }

        .match-round {
            color: #666;
            font-size: 12px;
        }

        .team-name {
            font-weight: 500;
        }

        .match-score {
            font-family: monospace;
            font-size: 12px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .table-btn-record {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }

        .table-btn-record:hover {
            background: #218838;
        }

        .draw-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }

        .draw-info p {
            margin: 5px 0;
            font-size: 14px;
            color: #1976d2;
        }


        /* Tablet and Desktop Responsive Styles */
        @media (min-width: 768px) {
            .selectors-container {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 30px;
            }
            
            .admin-tabs-nav {
                flex-wrap: wrap;
            }
            
            .admin-tab-btn {
                padding: 18px 15px;
                font-size: 14px;
            }
            
            .admin-matches-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .all-matches-filters {
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
            }
            
            .matches-table {
                font-size: 15px;
            }
            
            .matches-table th,
            .matches-table td {
                padding: 15px 12px;
            }
            
            .score-modal-content {
                max-width: 600px;
            }
            
            .sets-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .admin-container {
                padding: 0;
            }
            
            .admin-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .admin-tab-content {
                padding: 30px;
            }
            
            .admin-matches-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .matches-table-scroll {
                max-height: 500px;
            }
            
            .all-matches-filters {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .score-modal-content {
                max-width: 700px;
            }
        }

        /* Team Search and Matches Responsive */
        @media (min-width: 768px) {
            .team-search-results {
                max-height: 250px;
            }
            
            .team-result-item {
                padding: 15px 20px;
            }
            
            .team-matches-container {
                padding: 0;
            }
            
            .team-matches-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .team-match-section {
                margin-bottom: 30px;
            }
            
            .match-card {
                margin-bottom: 12px;
            }
            
            .round-robin-match-card {
                margin-bottom: 10px;
            }
        }

        @media (min-width: 1024px) {
            .team-search-input {
                font-size: 18px;
                padding: 15px 20px;
            }
            
            .team-result-item {
                padding: 18px 24px;
            }
            
            .team-result-name {
                font-size: 16px;
            }
            
            .team-result-info {
                font-size: 14px;
            }
            
            .matches-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        /* Bracket Display Responsive */
        @media (min-width: 768px) {
            .bracket-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .bracket-title {
                font-size: 28px;
            }
            
            .bracket-stats {
                font-size: 16px;
            }
            
            .tabs-nav {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                padding: 18px 15px;
                font-size: 15px;
            }
            
            .tab-content {
                padding: 30px;
            }
            
            .groups-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
            
            .standings-table {
                font-size: 12px;
            }
            
            .table-header {
                grid-template-columns: 30px 2fr 25px 25px 25px 25px 30px 30px;
                gap: 4px;
                padding: 8px 10px;
                font-size: 10px;
            }
            
            .team-row {
                grid-template-columns: 30px 2fr 25px 25px 25px 25px 30px 30px;
                gap: 4px;
                padding: 8px 10px;
                font-size: 11px;
            }
            
            .team-name {
                font-size: 11px;
                white-space: normal;
                word-wrap: break-word;
                line-height: 1.2;
                min-height: 20px;
            }
        }

        @media (min-width: 769px) and (max-width: 1023px) {
            .standings-table {
                font-size: 13px;
            }
            
            .table-header {
                grid-template-columns: 35px 2fr 30px 30px 30px 30px 40px 40px;
                gap: 5px;
                padding: 10px 12px;
                font-size: 11px;
            }
            
            .team-row {
                grid-template-columns: 35px 2fr 30px 30px 30px 30px 40px 40px;
                gap: 5px;
                padding: 10px 12px;
                font-size: 12px;
            }
            
            .team-name {
                font-size: 12px;
                white-space: normal;
                word-wrap: break-word;
                line-height: 1.3;
                min-height: 22px;
            }
        }

        @media (min-width: 1024px) {
            .groups-container {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
            
            .finals-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }
            
            .knockout-section .matches-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile Landscape Orientation */
        @media (max-width: 767px) and (orientation: landscape) {
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .header .subtitle {
                font-size: 12px;
            }
            
            
            .admin-progress-container {
                margin: 10px 0;
                padding: 10px;
            }
            
            .admin-progress-label {
                font-size: 12px;
            }
            
            .admin-progress-bar {
                height: 8px;
            }
            
            .admin-progress-text {
                font-size: 10px;
            }
            
            .admin-btn {
                top: 15px;
                right: 20px;
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .nav-container {
                padding: 15px 20px;
            }
            
            .nav-title {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .category-btn {
                padding: 12px;
            }
            
            .category-name {
                font-size: 14px;
            }
            
            .category-info {
                font-size: 11px;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .bracket-header {
                padding: 15px;
                margin: -15px -15px 15px -15px;
            }
            
            .bracket-title {
                font-size: 20px;
            }
            
            .bracket-stats {
                font-size: 12px;
            }
            
            .tab-btn {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .admin-header {
                padding: 15px;
                margin: -15px -15px 15px -15px;
            }
            
            .admin-title {
                font-size: 20px;
            }
            
            .admin-stats {
                font-size: 12px;
            }
            
            .admin-tab-btn {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .admin-tab-content {
                padding: 15px;
            }
            
            .selectors-container {
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .admin-select {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .team-search-input {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .matches-table {
                font-size: 12px;
            }
            
            .matches-table th,
            .matches-table td {
                padding: 8px 6px;
            }
            
            
            .team-name {
                font-size: 12px;
            }
            
            .match-score {
                font-size: 10px;
            }
            
            
            .score-modal-content {
                width: 98%;
                max-width: none;
                margin: 1%;
            }
            
            .sets-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .set-column h4 {
                font-size: 12px;
            }
            
            .score-input {
                width: 50px;
                padding: 6px;
                font-size: 14px;
            }
        }

        .admin-matches-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .admin-matches-header h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 18px;
        }

        .matches-stats {
            font-size: 14px;
            color: #666;
        }

        .admin-matches-grid {
            padding: 20px;
            display: grid;
            gap: 15px;
        }

        .admin-match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .admin-match-card.completed {
            border-color: #28a745;
        }

        .admin-match-card.pending {
            border-color: #ffc107;
        }

        .admin-match-header {
            background: #f8f9fa;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .admin-match-card.completed .admin-match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .admin-match-card.pending .admin-match-header {
            background: rgba(255, 193, 7, 0.1);
        }

        .match-id {
            font-weight: 700;
            color: #333;
        }

        .match-round {
            color: #666;
        }

        .match-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .match-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .match-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .admin-match-teams {
            padding: 15px;
        }

        .admin-team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .team-score-display {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .score-badge {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .sets-badge {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            margin-left: 2px;
        }

        .score-placeholder {
            color: #999;
            font-style: italic;
            font-size: 12px;
        }

        .vs-divider {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 5px 0;
            font-size: 12px;
        }

        .admin-match-actions {
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .admin-btn-record {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .admin-btn-record:hover {
            background: #218838;
        }

        .admin-btn-edit {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .admin-btn-edit:hover {
            background: #e0a800;
        }

        .score-modal-content {
            max-width: 500px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .score-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .score-modal-header h3 {
            margin: 0;
            color: #333;
        }

        .modal-close-btn {
            background: #6c757d;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .match-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .match-id-display {
            font-size: 18px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 8px;
        }

        .match-teams-display {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .vs-text {
            margin: 0 10px;
            color: #666;
        }

        .match-round-display {
            font-size: 14px;
            color: #666;
        }

        .score-form {
            margin-bottom: 20px;
        }

        .sets-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .set-column {
            text-align: center;
        }

        .set-column h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .score-inputs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .score-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .score-divider {
            font-weight: 600;
            color: #666;
        }

        .score-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .sets-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .team-sets {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sets-count {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .sets-vs {
            color: #666;
            font-weight: 600;
        }

        .winner-display {
            text-align: center;
            font-weight: 600;
            padding: 8px;
            border-radius: 6px;
            background: #e9ecef;
            color: #495057;
        }

        .winner-display.has-winner {
            background: #d4edda;
            color: #155724;
        }


        .cost-display {
            color: #856404;
            font-weight: 600;
        }

        .score-modal-footer {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 2px solid #f1f3f4;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="admin-btn" onclick="openAdminModal()"> Admin</button>
            <h1> MN Badminton Tournament</h1>
            <div class="subtitle">77   7   159 </div>
        </div>

        <div class="nav-container">
            <div class="nav-title"></div>
            <div class="nav-tabs">
                <button class="nav-tab-btn active" onclick="showCategoryView()"> </button>
                <button class="nav-tab-btn" onclick="showTeamSearchView()"> </button>
            </div>
            <div id="categoryView" class="nav-view">
                <div class="category-grid">
                    <div class="category-btn" onclick="loadCategory('A')">
                        <div class="category-name"> A</div>
                        <div class="category-info">6   2 </div>
                        <div class="status-badge">6</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('B')">
                        <div class="category-name"> B</div>
                        <div class="category-info">12   4 </div>
                        <div class="status-badge">12</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('C-B')">
                        <div class="category-name"> C-B</div>
                        <div class="category-info">17   4 </div>
                        <div class="status-badge">17</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('C-C')">
                        <div class="category-name"> C-C</div>
                        <div class="category-info">11   2 </div>
                        <div class="status-badge">11</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('D')">
                        <div class="category-name"> D</div>
                        <div class="category-info">10   2 </div>
                        <div class="status-badge">10</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('')">
                        <div class="category-name"></div>
                        <div class="category-info">9   2 </div>
                        <div class="status-badge">9</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('')" style="grid-column: 1 / -1;">
                        <div class="category-name"></div>
                        <div class="category-info">12   4 </div>
                        <div class="status-badge">12</div>
                    </div>
                </div>
            </div>
            <div id="teamSearchView" class="nav-view" style="display: none;">
                <div class="team-search-container">
                    <input type="text" id="teamSearchInput" class="team-search-input" placeholder=" ( -)" oninput="searchTeams()">
                    <div id="teamSearchResults" class="team-search-results"></div>
                </div>
            </div>
        </div>

        <div class="content-area" id="contentArea">
            <div class="welcome-screen">
                <div class="welcome-icon"></div>
                <div class="welcome-title"></div>
                <div class="welcome-text">
                    
                    <br><br>
                     
                </div>
            </div>
        </div>

        <div class="refresh-container">
            <button class="refresh-btn" onclick="refreshData()" title=""></button>
        </div>
    </div>

    <div class="modal" id="adminModal">
        <div class="modal-content">
            <h3>  Admin</h3>
            <input type="password" class="password-input" id="adminPassword" placeholder=" Admin" maxlength="3">
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" onclick="closeAdminModal()"></button>
                <button class="modal-btn btn-login" onclick="adminLogin()"></button>
            </div>
        </div>
    </div>

    <div class="modal" id="scoreModal">
        <div class="modal-content score-modal-content">
            <div class="score-modal-header">
                <h3 id="scoreModalTitle"> </h3>
                <button class="modal-close-btn" onclick="closeScoreModal()"></button>
            </div>
            <div class="score-modal-body">
                <div class="match-info">
                    <div class="match-id-display" id="matchIdDisplay">M001</div>
                    <div class="match-teams-display">
                        <span id="team1Display"> 1</span>
                        <span class="vs-text">VS</span>
                        <span id="team2Display"> 2</span>
                    </div>
                    <div class="match-round-display" id="matchRoundDisplay"></div>
                </div>
                
                <div class="score-form">
                    <div class="sets-grid">
                        <div class="set-column">
                            <h4> 1</h4>
                            <div class="score-inputs">
                                <input type="number" id="set1Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set1Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                        <div class="set-column">
                            <h4> 2</h4>
                            <div class="score-inputs">
                                <input type="number" id="set2Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set2Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                        <div class="set-column">
                            <h4> 3</h4>
                            <div class="score-inputs">
                                <input type="number" id="set3Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set3Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="score-summary">
                        <div class="sets-summary">
                            <div class="team-sets">
                                <span id="team1Name"> 1</span>
                                <span class="sets-count" id="team1Sets">0</span>
                            </div>
                            <div class="sets-vs"></div>
                            <div class="team-sets">
                                <span class="sets-count" id="team2Sets">0</span>
                                <span id="team2Name"> 2</span>
                            </div>
                        </div>
                        <div class="winner-display" id="winnerDisplay"></div>
                    </div>

                </div>
            </div>
            <div class="score-modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeScoreModal()"></button>
                <button class="modal-btn btn-save" onclick="saveMatchScore()"></button>
            </div>
        </div>
    </div>

    <script>
        let currentCategory = null;
        let isAdminMode = false;
        let allTeams = []; // 
        
        // Initialize global variables
        window.currentEditMatch = null;
        let currentAdminMatches = []; // 


        function showCategoryView() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.nav-tab-btn').classList.add('active');
            
            document.getElementById('categoryView').style.display = 'block';
            document.getElementById('teamSearchView').style.display = 'none';
        }

        function showTeamSearchView() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.nav-tab-btn')[1].classList.add('active');
            
            document.getElementById('categoryView').style.display = 'none';
            document.getElementById('teamSearchView').style.display = 'block';
            
            // Reset content area to welcome screen
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="welcome-screen">
                    <div class="welcome-icon"></div>
                    <div class="welcome-title"></div>
                    <div class="welcome-text">
                        
                        <br><br>
                         <br>
                         
                    </div>
                </div>
            `;
            
        }

        async function searchTeams() {
            const searchTerm = document.getElementById('teamSearchInput').value.toLowerCase().trim();
            const resultsContainer = document.getElementById('teamSearchResults');
            
            if (searchTerm.length < 2) {
                resultsContainer.innerHTML = '';
                return;
            }
            
            // 
            resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;"><div class="loading-spinner"></div> ...</div>';
            
            try {
                //  Google Sheets
                const teamsData = await getTeamsData();
                const standingsData = await getStandingsData();
                
                //  standings
                const allTeamsWithData = teamsData.map(team => {
                    const standing = standingsData.find(s => s.team_id === team.team_id);
                    return {
                        ...team,
                        group: standing ? standing.group_name : '',
                        rank: standing ? standing.rank_in_group : 0,
                        points: standing ? standing.points : 0,
                        qualified: standing ? standing.qualified : false
                    };
                });
                
                const filteredTeams = allTeamsWithData.filter(team => 
                    team.team_name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredTeams.length === 0) {
                resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;"></div>';
                return;
            }
            
            resultsContainer.innerHTML = filteredTeams.map(team => `
                    <div class="team-result-item" onclick="showTeamMatches('${team.team_name}', '${team.category}')">
                        <div class="team-result-name">${team.team_name}</div>
                    <div class="team-result-info"> ${team.category}  ${team.group}   ${team.rank}  ${team.points}  ${team.qualified ? ' ' : ''}</div>
                </div>
            `).join('');
                
            } catch (error) {
                console.error('Error searching teams:', error);
                resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #e74c3c;"></div>';
            }
        }

        async function showTeamMatches(teamName, category) {
            console.log('=== SHOW TEAM MATCHES DEBUG ===');
            console.log('Team name:', teamName);
            console.log('Category:', category);
            
            // 
            const searchInput = document.getElementById('teamSearchInput');
            const searchResults = document.getElementById('teamSearchResults');
            
            if (searchInput) searchInput.value = '';
            if (searchResults) searchResults.innerHTML = '';
            
            //  category name 
            const categoryKey = getCategoryKey(category);
            console.log('Category key:', categoryKey);
            
            try {
                const categoryData = await getCategoryData(categoryKey);
                console.log('Category data:', categoryData);
            const teamMatches = [];
            
            // 
                console.log('Searching in groups:', categoryData.groups);
            categoryData.groups.forEach(group => {
                if (group.matches) {
                        console.log('Group:', group.name, 'matches:', group.matches.length);
                    group.matches.forEach(match => {
                            console.log('Checking match:', match.id, 'team1:', match.team1, 'team2:', match.team2, 'vs teamName:', teamName);
                        if (match.team1 === teamName || match.team2 === teamName) {
                                console.log('Found match in round robin:', match.id);
                            teamMatches.push({
                                ...match,
                                round: '',
                                group: group.name
                            });
                        }
                    });
                }
            });
            
            // 
                console.log('Searching in knockout matches:', categoryData.knockoutMatches);
            categoryData.knockoutMatches.forEach(match => {
                console.log('Checking knockout match:', match.id, 'team1:', match.team1, 'team2:', match.team2, 'vs teamName:', teamName);
                if (match.team1 === teamName || match.team2 === teamName) {
                    console.log('Found match in knockout:', match.id);
                    teamMatches.push({
                        ...match,
                        round: '',
                        group: null
                    });
                }
            });
            
            // 
            console.log('Searching in finals:', categoryData.finals);
            categoryData.finals.forEach(match => {
                console.log('Checking final match:', match.id, 'team1:', match.team1, 'team2:', match.team2, 'vs teamName:', teamName);
                if (match.team1 === teamName || match.team2 === teamName) {
                    console.log('Found match in finals:', match.id);
                    teamMatches.push({
                        ...match,
                        round: match.type === 'championship' ? '' : ' 3',
                        group: null
                    });
                }
            });
            
            // 
            console.log('Total matches found:', teamMatches.length);
            console.log('Team matches:', teamMatches);
            
            const totalMatches = teamMatches.length;
            const completedMatches = teamMatches.filter(m => m.completed).length;
            const wins = teamMatches.filter(m => {
                if (!m.completed) return false;
                return (m.team1 === teamName && m.sets1 > m.sets2) || 
                       (m.team2 === teamName && m.sets2 > m.sets1);
            }).length;
            
            console.log('Stats - Total:', totalMatches, 'Completed:', completedMatches, 'Wins:', wins);
            
            // 
            const contentArea = document.getElementById('contentArea');
                console.log('Generating team matches content...');
                const teamMatchesContent = generateTeamMatchesContent(teamMatches, teamName);
                console.log('Generated content:', teamMatchesContent);
                
            contentArea.innerHTML = `
                <div class="team-matches-container">
                    <div class="team-matches-header">
                        <h2 class="team-matches-title">${teamName}</h2>
                        <div class="team-matches-stats"> ${category}  ${totalMatches}    ${wins}    ${completedMatches}/${totalMatches}</div>
                    </div>
                        ${teamMatchesContent}
                </div>
            `;
            
                console.log('Content area updated successfully');
                
            } catch (error) {
                console.error('Error showing team matches:', error);
                const contentArea = document.getElementById('contentArea');
                contentArea.innerHTML = `
                    <div style="padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;"></div>
                        <h3 style="color: #f44336; margin-bottom: 10px;"> Google Sheets </h3>
                        <p style="color: #666; margin-bottom: 20px;"> URL  Google Apps Script</p>
                        <button class="btn" onclick="showTeamMatches('${teamName}', '${category}')" style="margin-right: 10px;"> </button>
                        <button class="btn" onclick="document.getElementById('teamSearchView').style.display = 'none'; document.getElementById('navMenu').style.display = 'block';" style="background: #f44336;"> </button>
                    </div>
                `;
                // 
                const teamSearchInput = document.getElementById('teamSearchInput');
                const teamSearchResults = document.getElementById('teamSearchResults');
                if (teamSearchInput) teamSearchInput.value = '';
                if (teamSearchResults) teamSearchResults.innerHTML = '';
            }
        }

        function generateTeamMatchesContent(matches, teamName) {
            console.log('=== GENERATE TEAM MATCHES CONTENT ===');
            console.log('Input matches:', matches);
            console.log('Team name:', teamName);
            
            const groupedMatches = {};
            
            matches.forEach(match => {
                const roundKey = match.round + (match.group ? ` (${match.group})` : '');
                console.log('Processing match:', match.id, 'round key:', roundKey);
                if (!groupedMatches[roundKey]) {
                    groupedMatches[roundKey] = [];
                }
                groupedMatches[roundKey].push(match);
            });
            
            console.log('Grouped matches:', groupedMatches);
            
            let content = '';
            
            Object.keys(groupedMatches).forEach(roundKey => {
                content += `
                    <div class="team-match-section">
                        <div class="team-match-section-title">${roundKey}</div>
                        <div class="matches-grid">`;
                        
                groupedMatches[roundKey].forEach(match => {
                    const isTeam1 = match.team1 === teamName;
                    const opponent = isTeam1 ? match.team2 : match.team1;
                    const teamSets = isTeam1 ? match.sets1 : match.sets2;
                    const opponentSets = isTeam1 ? match.sets2 : match.sets1;
                    const teamScore = isTeam1 ? match.score1 : match.score2;
                    const opponentScore = isTeam1 ? match.score2 : match.score1;
                    
                    const isWinner = match.completed && teamSets > opponentSets;
                    const isLoser = match.completed && teamSets < opponentSets;
                    
                    content += `
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? (isWinner ? '' : '') : ''}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team" style="${isTeam1 ? 'background: rgba(0, 123, 255, 0.1);' : ''}">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score1 && match.score1.length > 0) {
                        match.score1.forEach((score, index) => {
                            const isWin = match.score2[index] && score > match.score2[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team" style="${!isTeam1 ? 'background: rgba(0, 123, 255, 0.1);' : ''}">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score2 && match.score2.length > 0) {
                        match.score2.forEach((score, index) => {
                            const isWin = match.score1[index] && score > match.score1[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                
                content += '</div></div>';
            });
            
            return content;
        }

        async function loadAdminMatches() {
            const category = document.getElementById('adminCategorySelect').value;
            const matchesList = document.getElementById('adminMatchesList');
            
            if (!category) {
                matchesList.innerHTML = '<div class="no-selection"></div>';
                currentAdminMatches = [];
                return;
            }
            
            // 
            matchesList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
            
            try {
                //  Google Sheets
                const categoryData = await getCategoryData(category);
                console.log(' Admin - Category data loaded:', categoryData);
            currentAdminMatches = [];
            
            // 
                if (categoryData.groups) {
                    console.log(' Admin - Processing groups:', categoryData.groups.length);
            categoryData.groups.forEach(group => {
                        if (group.matches) {
                            console.log(` Admin - Group ${group.name} has ${group.matches.length} matches:`, group.matches.map(m => m.id));
                group.matches.forEach(match => {
                    currentAdminMatches.push({
                        ...match,
                        round: '',
                        group: group.name
                    });
                });
                        }
            });
                }
            
            //  -  8   4 
                if (categoryData.knockoutMatches) {
                    console.log(' Admin - Processing knockout matches:', categoryData.knockoutMatches.length, categoryData.knockoutMatches.map(m => m.id));
            categoryData.knockoutMatches.forEach((match, index) => {
                let roundName = ' 8 ';
                
                // 
                const totalKnockout = categoryData.knockoutMatches.length;
                if (totalKnockout >= 4) {
                    //  4   4  8 
                    if (index >= 4) {
                        roundName = ' 4 ';
                    }
                } else {
                    //  4   4 
                    roundName = ' 4 ';
                }
                
                currentAdminMatches.push({
                    ...match,
                    round: roundName,
                    group: null
                });
            });
                }
            
            // 
                if (categoryData.finals) {
                    console.log(' Admin - Processing finals matches:', categoryData.finals.length, categoryData.finals.map(m => m.id));
            categoryData.finals.forEach(match => {
                currentAdminMatches.push({
                    ...match,
                    round: match.type === 'championship' ? '' : ' 3',
                    group: null
                });
            });
                }
            
            // Reset round selector
            document.getElementById('adminRoundSelect').value = '';
            
            // 
            console.log(' Admin - Total matches collected:', currentAdminMatches.length);
            console.log(' Admin - All match IDs:', currentAdminMatches.map(m => m.id));
            displayFilteredMatches(currentAdminMatches, category);
                
            } catch (error) {
                console.error('Error loading admin matches:', error);
                matchesList.innerHTML = `
                    <div style="padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;"></div>
                        <h3 style="color: #f44336; margin-bottom: 10px;"> Google Sheets </h3>
                        <p style="color: #666; margin-bottom: 20px;"> URL  Google Apps Script</p>
                        <button class="btn" onclick="loadAdminMatches()" style="margin-right: 10px;"> </button>
                        <button class="btn" onclick="document.getElementById('adminCategorySelect').value = ''; document.getElementById('adminMatchesList').innerHTML = '';" style="background: #f44336;"> </button>
                    </div>
                `;
            }
        }

        function filterMatchesByRound() {
            const selectedRound = document.getElementById('adminRoundSelect').value;
            const category = document.getElementById('adminCategorySelect').value;
            
            if (!category || currentAdminMatches.length === 0) {
                return;
            }
            
            let filteredMatches = currentAdminMatches;
            
            if (selectedRound) {
                filteredMatches = currentAdminMatches.filter(match => match.round === selectedRound);
            }
            
            displayFilteredMatches(filteredMatches, category);
        }



        function displayFilteredMatches(matches, category) {
            const matchesList = document.getElementById('adminMatchesList');
            
            const completedCount = matches.filter(m => m.completed).length;
            const pendingCount = matches.filter(m => !m.completed).length;
            
            matchesList.innerHTML = `
                <div class="admin-matches-header">
                    <h4>  ${category}</h4>
                    <div class="matches-stats">
                         ${matches.length}   
                         ${completedCount}   
                         ${pendingCount} 
                    </div>
                </div>
                <div class="admin-matches-grid">
                    ${matches.map(match => generateAdminMatchCard(match)).join('')}
                </div>
            `;
        }

        function generateAdminMatchCard(match) {
            const statusClass = match.completed ? 'completed' : 'pending';
            const statusText = match.completed ? '' : '';
            const roundText = match.group ? `${match.round} (${match.group})` : match.round;
            
            console.log('Generating card for match:', match.id, 'completed:', match.completed);
            
            return `
                <div class="admin-match-card ${statusClass}">
                    <div class="admin-match-header">
                        <span class="match-id">${match.id}</span>
                        <span class="match-round">${roundText}</span>
                        <span class="match-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="admin-match-teams">
                        <div class="admin-team">
                            <span class="team-name">${match.team1}</span>
                            <div class="team-score-display">
                                ${match.completed && match.score1 ? 
                                    match.score1.map(score => `<span class="score-badge">${score}</span>`).join('') + 
                                    `<span class="sets-badge">(${match.sets1})</span>` :
                                    '<span class="score-placeholder">- -</span>'
                                }
                            </div>
                        </div>
                        <div class="vs-divider">VS</div>
                        <div class="admin-team">
                            <span class="team-name">${match.team2}</span>
                            <div class="team-score-display">
                                ${match.completed && match.score2 ? 
                                    match.score2.map(score => `<span class="score-badge">${score}</span>`).join('') + 
                                    `<span class="sets-badge">(${match.sets2})</span>` :
                                    '<span class="score-placeholder">- -</span>'
                                }
                            </div>
                        </div>
                    </div>
                    <div class="admin-match-actions">
                        ${match.completed ? 
                            `<button class="admin-btn-edit" onclick="editMatchHandler('${match.id}')"></button>` :
                            `<button class="admin-btn-record" onclick="editMatchHandler('${match.id}')"></button>`
                        }
                    </div>
                </div>
            `;
        }

        // Separate handler functions to avoid quote escaping issues

        function editMatchHandler(matchId) {
            console.log('=== EDIT MATCH HANDLER ===');
            console.log('Edit match handler called for:', matchId);
            console.log('Current admin matches length:', currentAdminMatches ? currentAdminMatches.length : 'undefined');
            console.log('Available matches:', currentAdminMatches ? currentAdminMatches.map(m => m.id) : 'none');
            
            // 
            const match = findMatchById(matchId);
            if (match) {
                //  isEdit = true , false 
                const isEdit = match.completed;
                console.log('Match completed:', match.completed, 'Using isEdit:', isEdit);
                openScoreModal(matchId, isEdit);
            } else {
                console.error('Match not found:', matchId);
                alert('');
            }
        }

        // Test function to verify if functions exist
        function testAdminFunctions() {
            console.log('Testing admin functions...');
            console.log('editMatchHandler function exists:', typeof editMatchHandler === 'function');
            console.log('findMatchById function exists:', typeof findMatchById === 'function');
            console.log('openScoreModal function exists:', typeof openScoreModal === 'function');
        }

        // Functions removed - now using editMatchHandler for both record and edit

        function openScoreModal(matchId, isEdit) {
            console.log('=== OPEN SCORE MODAL ===');
            console.log('Opening score modal for:', matchId, 'isEdit:', isEdit);
            
            const match = findMatchById(matchId);
            console.log('Found match:', match);
            
            if (!match) {
                console.error('Match not found:', matchId);
                alert(': ' + matchId + '\n\n');
                return;
            }

            // Set modal title
            document.getElementById('scoreModalTitle').textContent = isEdit ? ' ' : ' ';

            // Set match info
            document.getElementById('matchIdDisplay').textContent = matchId;
            document.getElementById('team1Display').textContent = match.team1;
            document.getElementById('team2Display').textContent = match.team2;
            document.getElementById('matchRoundDisplay').textContent = match.round || '';
            
            // Set team names in summary
            document.getElementById('team1Name').textContent = match.team1;
            document.getElementById('team2Name').textContent = match.team2;

            // Fill existing scores if editing
            if (isEdit && match.completed) {
                console.log('Filling existing scores:', match.score1, match.score2);
                fillExistingScores(match);
            } else {
                clearScoreInputs();
            }

            // Store current match data
            console.log('=== MATCH OBJECT DEBUG ===');
            console.log('Original match object:', match);
            console.log('Match round property:', match.round);
            
            window.currentEditMatch = { 
                matchId, 
                isEdit, 
                originalMatch: match,
                round: match.round,  //  round property
                team1: match.team1,
                team2: match.team2,
                team1Id: match.team1_id || '',  //  team ID ( team1_id  Google Sheets)
                team2Id: match.team2_id || '',  //  team ID ( team2_id  Google Sheets)
                category: match.category || ''
            };
            console.log('Stored current match:', window.currentEditMatch);
            console.log('Team IDs:', {
                team1: match.team1,
                team1Id: match.team1_id,
                team2: match.team2,
                team2Id: match.team2_id
            });

            // Show modal
            document.getElementById('scoreModal').style.display = 'block';

            // Add event listeners for real-time calculation
            addScoreInputListeners();
        }

        //  currentAdminMatches ()
        function findMatchById(matchId) {
            console.log('Searching for match:', matchId);
            console.log('Current admin matches:', currentAdminMatches);
            
            if (!currentAdminMatches || currentAdminMatches.length === 0) {
                console.log('No admin matches loaded');
                return null;
            }
            
            const match = currentAdminMatches.find(m => m.id === matchId);
                        if (match) {
                console.log('Found match:', match);
                            return { 
                                ...match, 
                                // Ensure arrays exist
                                score1: match.score1 || [],
                                score2: match.score2 || [],
                                sets1: match.sets1 || 0,
                                sets2: match.sets2 || 0,
                                completed: match.completed || false
                            };
                        }
            
            console.log('Match not found');
            return null;
        }

        //  Google Sheets ( updateFinalsMatches)
        async function findMatchByIdFromSheets(matchId) {
            try {
                console.log('Searching for match in Google Sheets:', matchId);
                
                // 
                const categories = ['A', 'B', 'C-B', 'C-C', 'D', '', ''];
                
                for (const category of categories) {
                    const categoryData = await getCategoryData(category);
                    
                    //  knockout matches
                    const knockoutMatch = categoryData.knockoutMatches.find(m => m.id === matchId);
                    if (knockoutMatch) {
                        const round = categoryData.knockoutMatches.length >= 4 && 
                                     categoryData.knockoutMatches.indexOf(knockoutMatch) < 4 ? ' 8 ' : ' 4 ';
                        return { ...knockoutMatch, category, round };
                    }
                    
                    //  finals
                    const finalMatch = categoryData.finals.find(m => m.id === matchId);
                    if (finalMatch) {
                        const round = finalMatch.type === 'championship' ? '' : ' 3';
                        return { ...finalMatch, category, round };
                    }
                }
                
                console.log('Match not found in Google Sheets');
                return null;
            } catch (error) {
                console.error('Error finding match in Google Sheets:', error);
            return null;
            }
        }

        function fillExistingScores(match) {
            console.log('Filling existing scores for match:', match);
            
            if (match.score1 && match.score1.length > 0) {
                document.getElementById('set1Team1').value = match.score1[0] || '';
                document.getElementById('set1Team2').value = match.score2[0] || '';
            }
            if (match.score1 && match.score1.length > 1) {
                document.getElementById('set2Team1').value = match.score1[1] || '';
                document.getElementById('set2Team2').value = match.score2[1] || '';
            }
            if (match.score1 && match.score1.length > 2) {
                document.getElementById('set3Team1').value = match.score1[2] || '';
                document.getElementById('set3Team2').value = match.score2[2] || '';
            }
            
            
            // Set the existing sets count directly from match data
            document.getElementById('team1Sets').textContent = match.sets1 || 0;
            document.getElementById('team2Sets').textContent = match.sets2 || 0;
            
            // Update winner display
            const winnerDisplay = document.getElementById('winnerDisplay');
            if (match.sets1 > match.sets2) {
                winnerDisplay.textContent = ` ${match.team1} `;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (match.sets2 > match.sets1) {
                winnerDisplay.textContent = ` ${match.team2} `;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (match.sets1 === match.sets2 && match.sets1 > 0) {
                winnerDisplay.textContent = ' ';
                winnerDisplay.className = 'winner-display';
            } else {
                winnerDisplay.textContent = '';
                winnerDisplay.className = 'winner-display';
            }
            
            console.log('Filled scores - Team1 sets:', match.sets1, 'Team2 sets:', match.sets2);
        }

        function clearScoreInputs() {
            document.getElementById('set1Team1').value = '';
            document.getElementById('set1Team2').value = '';
            document.getElementById('set2Team1').value = '';
            document.getElementById('set2Team2').value = '';
            document.getElementById('set3Team1').value = '';
            document.getElementById('set3Team2').value = '';
            
            // Reset score summary
            document.getElementById('team1Sets').textContent = '0';
            document.getElementById('team2Sets').textContent = '0';
            
            const winnerDisplay = document.getElementById('winnerDisplay');
            winnerDisplay.textContent = '';
            winnerDisplay.className = 'winner-display';
        }

        function addScoreInputListeners() {
            // Remove existing listeners first to prevent duplicates
            const scoreInputs = document.querySelectorAll('.score-input');
            scoreInputs.forEach(input => {
                input.removeEventListener('input', updateScoreSummary);
                input.addEventListener('input', updateScoreSummary);
            });
            
            // Court selection doesn't need event listeners
            
            console.log('Score input listeners added');
        }

        function updateScoreSummary() {
            // Check if currentEditMatch exists
            if (!window.currentEditMatch || !window.currentEditMatch.originalMatch) {
                console.log('currentEditMatch not available yet, skipping update');
                return;
            }
            
            const sets = [
                {
                    team1: parseInt(document.getElementById('set1Team1').value) || 0,
                    team2: parseInt(document.getElementById('set1Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set2Team1').value) || 0,
                    team2: parseInt(document.getElementById('set2Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set3Team1').value) || 0,
                    team2: parseInt(document.getElementById('set3Team2').value) || 0
                }
            ];

            let team1Sets = 0;
            let team2Sets = 0;

            sets.forEach(set => {
                if (set.team1 > 0 || set.team2 > 0) {
                    if (set.team1 > set.team2) team1Sets++;
                    else if (set.team2 > set.team1) team2Sets++;
                }
            });

            document.getElementById('team1Sets').textContent = team1Sets;
            document.getElementById('team2Sets').textContent = team2Sets;

            const winnerDisplay = document.getElementById('winnerDisplay');
            const match = window.currentEditMatch.originalMatch;
            
            if (team1Sets > team2Sets && team1Sets >= 2) {
                winnerDisplay.textContent = ` ${match.team1} `;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (team2Sets > team1Sets && team2Sets >= 2) {
                winnerDisplay.textContent = ` ${match.team2} `;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (team1Sets === team2Sets && team1Sets > 0) {
                winnerDisplay.textContent = ' ';
                winnerDisplay.className = 'winner-display';
            } else {
                winnerDisplay.textContent = '';
                winnerDisplay.className = 'winner-display';
            }
        }

        // Removed updateCostDisplay function - no longer needed

        function closeScoreModal() {
            document.getElementById('scoreModal').style.display = 'none';
            window.currentEditMatch = null;
        }

        //  Progress Bar
        let progressInterval = null;
        let currentProgress = 0;
        let realProgress = 0;
        let lastUpdateTime = 0;
        let isProgressRunning = false;
        
        //  Progress Bar 
        function showSaveProgress(percentage, message) {
            let progressContainer = document.getElementById('saveProgressContainer');
            
            if (!progressContainer) {
                //  Progress Bar container
                progressContainer = document.createElement('div');
                progressContainer.id = 'saveProgressContainer';
                progressContainer.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    border: 2px solid #007bff;
                    border-radius: 10px;
                    padding: 20px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 10000;
                    min-width: 300px;
                    text-align: center;
                `;
                
                progressContainer.innerHTML = `
                    <div id="saveProgressMessage" style="margin-bottom: 15px; font-weight: bold; color: #007bff;">${message}</div>
                    <div style="background: #f0f0f0; border-radius: 10px; height: 20px; overflow: hidden; margin-bottom: 10px;">
                        <div id="saveProgressBar" style="background: linear-gradient(90deg, #007bff, #0056b3); height: 100%; width: 0%; transition: width 0.3s ease; border-radius: 10px;"></div>
                    </div>
                    <div id="saveProgressText" style="font-size: 14px; color: #666;">0%</div>
                `;
                
                document.body.appendChild(progressContainer);
                
                //  Progress Bar 
                startProgressAnimation();
            }
            
            // 
            document.getElementById('saveProgressMessage').textContent = message;
            
            // 
            realProgress = percentage;
            lastUpdateTime = Date.now();
            
            //  100%  100% 
            if (percentage === 100) {
                currentProgress = 100;
                const progressBar = document.getElementById('saveProgressBar');
                const progressText = document.getElementById('saveProgressText');
                
                if (progressBar && progressText) {
                    progressBar.style.width = '100%';
                    progressText.textContent = '100%';
                }
            }
        }
        
        //  Progress Bar 
        function startProgressAnimation() {
            if (isProgressRunning) return;
            
            isProgressRunning = true;
            currentProgress = 0;
            realProgress = 0;
            lastUpdateTime = Date.now();
            
            progressInterval = setInterval(() => {
                const now = Date.now();
                const timeSinceLastUpdate = now - lastUpdateTime;
                
                //  1 
                if (timeSinceLastUpdate < 1000) {
                    // 
                    if (currentProgress < realProgress) {
                        currentProgress = Math.min(currentProgress + 1, realProgress);
                    }
                } else {
                    //  1   1% 
                    if (currentProgress < 99) {
                        currentProgress = Math.min(currentProgress + 1, 99);
                    }
                }
                
                //  
                if (realProgress > currentProgress) {
                    currentProgress = realProgress;
                }
                
                //  Progress Bar
                const progressBar = document.getElementById('saveProgressBar');
                const progressText = document.getElementById('saveProgressText');
                
                if (progressBar && progressText) {
                    progressBar.style.width = currentProgress + '%';
                    progressText.textContent = currentProgress + '%';
                }
            }, 1000); //  1%  1 
        }
        
        //  Progress Bar 
        function updateProgressToTarget(percentage, message) {
            if (message) {
                document.getElementById('saveProgressMessage').textContent = message;
            }
            
            // 
            realProgress = percentage;
            lastUpdateTime = Date.now();
            
            //  100%  100% 
            if (percentage === 100) {
                currentProgress = 100;
                const progressBar = document.getElementById('saveProgressBar');
                const progressText = document.getElementById('saveProgressText');
                
                if (progressBar && progressText) {
                    progressBar.style.width = '100%';
                    progressText.textContent = '100%';
                }
            }
        }
        
        //  Progress Bar
        function hideSaveProgress() {
            //  Progress Bar
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            isProgressRunning = false;
            
            const progressContainer = document.getElementById('saveProgressContainer');
            if (progressContainer) {
                progressContainer.remove();
            }
        }

        //  Standings 
        async function updateStandingsAfterMatch(matchData, category) {
            try {
                console.log(' === UPDATE STANDINGS DEBUG (NEW LOGIC) === ');
                console.log(' Match data:', matchData);
                console.log(' Category:', category);
                console.log(' Function called at:', new Date().toISOString());
                
                //  Google Sheets
                const completedMatches = await getCompletedMatchesFromSheets(category);
                console.log('Completed matches from sheets:', completedMatches);
                
                // 
                console.log(' Fetching teams data...');
                const teamsData = await getTeamsData();
                console.log(' All teams data:', teamsData);
                const categoryTeams = teamsData.filter(team => team.category === category);
                console.log(' Category teams:', categoryTeams);
                
                //  standings 
                console.log(' Fetching standings data...');
                const currentStandings = await getStandingsData();
                console.log(' All standings data:', currentStandings);
                const categoryStandings = currentStandings.filter(s => s.category === category);
                console.log(' Category standings:', categoryStandings);
                
                // 
                const groups = {};
                categoryStandings.forEach(standing => {
                    if (!groups[standing.group_name]) {
                        groups[standing.group_name] = [];
                    }
                    groups[standing.group_name].push(standing);
                });
                
                console.log('Groups:', groups);
                
                // 
                const matchId = matchData.matchId;
                const relatedTeams = [];
                let matchGroup = null;
                
                // 
                for (const match of completedMatches) {
                    if (match.match_id === matchId) {
                        relatedTeams.push(match.team1_id, match.team2_id);
                        // 
                        for (const [groupName, groupTeams] of Object.entries(groups)) {
                            if (groupTeams.some(team => team.team_id === match.team1_id || team.team_id === match.team2_id)) {
                                matchGroup = groupName;
                                break;
                            }
                        }
                        break;
                    }
                }
                
                console.log(` Teams related to match ${matchId}:`, relatedTeams);
                console.log(` Match group: ${matchGroup}`);
                
                //  standings 
                if (matchGroup && groups[matchGroup]) {
                    const groupName = matchGroup;
                    const groupTeams = groups[matchGroup];
                    console.log(` Calculating standings for affected group: ${groupName}`);
                    
                    const standingsUpdates = [];
                    
                    for (const team of groupTeams) {
                        // 
                        if (relatedTeams.includes(team.team_id)) {
                            const stats = calculateTeamStats(team.team_id, completedMatches);
                            console.log(` Updating stats for related team ${team.team_id}:`, stats);
                            
                            standingsUpdates.push({
                                team_id: team.team_id,
                                matches_played: stats.matches_played,
                                wins: stats.wins,
                                draws: stats.draws,
                                losses: stats.losses,
                                points: stats.points,
                                total_points_scored: stats.total_points_scored,
                                rank_in_group: 0, // 
                                qualified: false // 
                            });
                        } else {
                            //    rank 
                            console.log(` Using existing stats for team ${team.team_id}:`, {
                                matches_played: team.matches_played,
                                wins: team.wins,
                                draws: team.draws,
                                losses: team.losses,
                                points: team.points,
                                total_points_scored: team.total_points_scored
                            });
                            
                            //  points  undefined
                            let points = team.points;
                            if (points === undefined || points === null) {
                                points = (team.wins * 3) + (team.draws * 1);
                                console.log(` Recalculated points for team ${team.team_id}: ${points}`);
                            }
                            
                            standingsUpdates.push({
                                team_id: team.team_id,
                                matches_played: team.matches_played || 0,
                                wins: team.wins || 0,
                                draws: team.draws || 0,
                                losses: team.losses || 0,
                                points: points || 0,
                                total_points_scored: team.total_points_scored || 0,
                                rank_in_group: 0, // 
                                qualified: false // 
                            });
                        }
                    }
                    
                    // 
                    rankTeamsInGroup(standingsUpdates);
                    
                    console.log(`Ranked standings for ${groupName}:`, standingsUpdates);
                    
                    //  standings  Google Sheets
                    console.log(`=== UPDATING ${standingsUpdates.length} TEAMS IN AFFECTED GROUP ===`);
                    for (const standing of standingsUpdates) {
                        console.log(` Updating standings for team_id: ${standing.team_id}`);
                        console.log('Standing data:', standing);
                        try {
                            const result = await updateStandingsInSheets(standing);
                            console.log(` Standings update result for ${standing.team_id}:`, result);
                        } catch (error) {
                            console.error(` Error updating standings for ${standing.team_id}:`, error);
                        }
                    }
                } else {
                    console.log(' No affected group found for the match');
                }
                
                console.log('All standings updated successfully');
                
            } catch (error) {
                console.error('Error updating standings:', error);
            }
        }
        
        //  Google Sheets
        async function getCompletedMatchesFromSheets(category) {
            try {
                console.log(' Fetching completed matches for category:', category);
                console.log(' Request URL:', `${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(category)}`);
                
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(category)}`);
                console.log(' Response status:', response.status);
                
                const result = await response.json();
                console.log(' Response result:', result);
                
                if (result.status === 'success') {
                    console.log('Raw matches data:', result.data.matches);
                    
                    // 
                    const completedMatches = result.data.matches.filter(match => 
                        match.round_type === '' && 
                        match.match_status === 'completed'
                    );
                    
                    console.log('Filtered completed matches:', completedMatches);
                    return completedMatches;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error fetching completed matches:', error);
                return [];
            }
        }
        
        // 
        function calculateTeamStats(teamId, completedMatches) {
            console.log(`=== CALCULATING STATS FOR TEAM ${teamId} ===`);
            console.log('Completed matches to process:', completedMatches);
            
            let stats = {
                matches_played: 0,
                wins: 0,
                draws: 0,
                losses: 0,
                points: 0,
                total_points_scored: 0
            };
            
            completedMatches.forEach(match => {
                console.log(`Processing match ${match.match_id}: ${match.team1_id} vs ${match.team2_id}, winner: ${match.winner_id}`);
                
                if (match.team1_id === teamId || match.team2_id === teamId) {
                    stats.matches_played++;
                    console.log(`Team ${teamId} found in match ${match.match_id}, matches_played: ${stats.matches_played}`);
                    
                    // 
                    if (match.winner_id === teamId) {
                        stats.wins++;
                        console.log(`Team ${teamId} won match ${match.match_id}, wins: ${stats.wins}`);
                    } else if (match.winner_id === "" || match.winner_id === null) {
                        stats.draws++;
                        console.log(`Match ${match.match_id} was a draw, draws: ${stats.draws}`);
                    } else {
                        stats.losses++;
                        console.log(`Team ${teamId} lost match ${match.match_id}, losses: ${stats.losses}`);
                    }
                    
                    // 
                    if (match.team1_id === teamId) {
                        const points = (match.set1_team1 || 0) + (match.set2_team1 || 0) + (match.set3_team1 || 0);
                        stats.total_points_scored += points;
                        console.log(`Team ${teamId} as team1 scored ${points} points in match ${match.match_id}, total: ${stats.total_points_scored}`);
                    } else {
                        const points = (match.set1_team2 || 0) + (match.set2_team2 || 0) + (match.set3_team2 || 0);
                        stats.total_points_scored += points;
                        console.log(`Team ${teamId} as team2 scored ${points} points in match ${match.match_id}, total: ${stats.total_points_scored}`);
                    }
                }
            });
            
            //  (3-1-0 system)
            stats.points = (stats.wins * 3) + (stats.draws * 1);
            
            console.log(`Final stats for team ${teamId}:`, stats);
            return stats;
        }
        
        // 
        function rankTeamsInGroup(standingsUpdates) {
            console.log('=== RANKING TEAMS IN GROUP ===');
            console.log('Teams before ranking:', standingsUpdates);
            
            // 
            standingsUpdates.sort((a, b) => {
                //  1:  (  )
                if (b.points !== a.points) {
                    return b.points - a.points;
                }
                
                //  2:  (  )
                if (b.total_points_scored !== a.total_points_scored) {
                    return b.total_points_scored - a.total_points_scored;
                }
                
                //  3:  (  )
                return b.wins - a.wins;
            });
            
            // 
            standingsUpdates.forEach((standing, index) => {
                standing.rank_in_group = index + 1;
                standing.qualified = index < 2; //  1-2 
                console.log(`Team ${standing.team_id}: rank=${standing.rank_in_group}, qualified=${standing.qualified}, points=${standing.points}`);
                
                // Debug  points
                console.log(` POINTS DEBUG - rankTeamsInGroup:`);
                console.log(`  - Team: ${standing.team_id}`);
                console.log(`  - Points: ${standing.points} (type: ${typeof standing.points})`);
                console.log(`  - Wins: ${standing.wins}, Draws: ${standing.draws}`);
                console.log(`  - Calculated points: ${(standing.wins * 3) + (standing.draws * 1)}`);
            });
            
            console.log('Teams after ranking:', standingsUpdates);
        }
        
        //  standings  Google Sheets
        async function updateStandingsInSheets(standingsData) {
            try {
                console.log('=== UPDATE STANDINGS IN SHEETS DEBUG ===');
                console.log('Standings data to update:', standingsData);
                console.log('Google Apps Script URL:', GOOGLE_APPS_SCRIPT_URL);
                
                if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    throw new Error('Google Apps Script URL ');
                }
                
                //  URL parameters  GET request
                const params = new URLSearchParams({
                    action: 'updateStandings',
                    team_id: standingsData.team_id,
                    matches_played: standingsData.matches_played || 0,
                    wins: standingsData.wins || 0,
                    draws: standingsData.draws || 0,
                    losses: standingsData.losses || 0,
                    points: standingsData.points || 0,
                    total_points_scored: standingsData.total_points_scored || 0,
                    rank_in_group: standingsData.rank_in_group || 1,
                    qualified: standingsData.qualified || false
                });
                
                console.log('URL Parameters being sent:', Object.fromEntries(params));
                console.log(' POINTS DEBUG - Frontend:');
                console.log('  - Original standingsData.points:', standingsData.points);
                console.log('  - Type:', typeof standingsData.points);
                console.log('  - URL param points:', params.get('points'));
                console.log('  - Rank value:', standingsData.rank_in_group);
                
                const requestUrl = `${GOOGLE_APPS_SCRIPT_URL}?${params.toString()}`;
                console.log('Request URL:', requestUrl);
                
                const response = await fetch(requestUrl, {
                    method: 'GET'
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Response error text:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Standings update result:', result);
                
                if (result.status !== 'success') {
                    throw new Error(result.message || 'Failed to update standings');
                }
                
                return result;
                
            } catch (error) {
                console.error('Error updating standings in Google Sheets:', error);
                throw error;
            }
        }

        //  Google Sheets
        async function updateMatchInSheets(matchData) {
            try {
                console.log('=== UPDATE MATCH DEBUG ===');
                console.log('Google Apps Script URL:', GOOGLE_APPS_SCRIPT_URL);
                console.log('Match data to update:', matchData);
                
                //  URL
                if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    throw new Error('Google Apps Script URL ');
                }
                
                //  URL parameters  GET request
                const params = new URLSearchParams({
                    action: 'updateMatch',
                    matchId: matchData.matchId,
                    team1: matchData.team1 || matchData['Team 1'] || '',
                    team2: matchData.team2 || matchData['Team 2'] || '',
                    set1T1: matchData['Set1 T1'] || '',
                    set1T2: matchData['Set1 T2'] || '',
                    set2T1: matchData['Set2 T1'] || '',
                    set2T2: matchData['Set2 T2'] || '',
                    set3T1: matchData['Set3 T1'] || '',
                    set3T2: matchData['Set3 T2'] || '',
                    winnerId: matchData['Winner ID'] || '',
                    court: matchData['Court'] || '',
                    status: matchData['Status'] || ''
                });
                
                console.log('URL Parameters debug:', {
                    'Winner ID': matchData['Winner ID'],
                    winnerId: matchData['Winner ID'] || '',
                    allParams: Object.fromEntries(params)
                });
                
                const requestUrl = `${GOOGLE_APPS_SCRIPT_URL}?${params.toString()}`;
                console.log('Request URL:', requestUrl);
                
                const response = await fetch(requestUrl, {
                    method: 'GET'
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Update result:', result);

                if (result.status === 'success') {
                    return { success: true, message: result.message };
                } else {
                    return { success: false, message: result.message };
                }

            } catch (error) {
                console.error('=== UPDATE ERROR ===');
                console.error('Error updating match in Google Sheets:', error);
                console.error('Error name:', error.name);
                console.error('Error message:', error.message);
                
                return { success: false, message: error.message };
            }
        }

        async function saveMatchScore() {
            if (!window.currentEditMatch) return;
            
            console.log('=== SAVE MATCH SCORE DEBUG ===');
            console.log('Is editing existing match:', window.currentEditMatch.isEdit);
            console.log('Current edit match data:', window.currentEditMatch);

            const sets = [
                {
                    team1: parseInt(document.getElementById('set1Team1').value) || 0,
                    team2: parseInt(document.getElementById('set1Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set2Team1').value) || 0,
                    team2: parseInt(document.getElementById('set2Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set3Team1').value) || 0,
                    team2: parseInt(document.getElementById('set3Team2').value) || 0
                }
            ];

            // Validate scores
            let team1Sets = 0;
            let team2Sets = 0;
            const score1 = [];
            const score2 = [];

            let isValid = true;
            let hasValidSets = false;

            sets.forEach((set, index) => {
                if (set.team1 > 0 || set.team2 > 0) {
                    hasValidSets = true;
                    score1.push(set.team1);
                    score2.push(set.team2);
                    
                    if (set.team1 > set.team2) team1Sets++;
                    else if (set.team2 > set.team1) team2Sets++;
                    
                    // Validate badminton scoring rules
                    if (Math.max(set.team1, set.team2) < 21 && Math.abs(set.team1 - set.team2) < 2) {
                        if (Math.max(set.team1, set.team2) < 20) {
                            isValid = false;
                        }
                    }
                }
            });

            if (!hasValidSets) {
                alert(' 1 ');
                return;
            }

            // 
            const isRoundRobin = window.currentEditMatch && window.currentEditMatch.round === '';
            console.log('=== ROUND VALIDATION DEBUG ===');
            console.log('currentEditMatch:', window.currentEditMatch);
            console.log('match round:', window.currentEditMatch ? window.currentEditMatch.round : 'undefined');
            console.log('isRoundRobin:', isRoundRobin);
            console.log('team1Sets:', team1Sets, 'team2Sets:', team2Sets);
            
            // Debug: 
            if (window.currentEditMatch && window.currentEditMatch.originalMatch) {
                console.log('Original match data:', window.currentEditMatch.originalMatch);
                console.log('Original match round:', window.currentEditMatch.originalMatch.round);
            }
            
            if (isRoundRobin) {
                // :  2 
                // : 0-0 (), 1-0, 0-1, 1-1 ()
                // : 1-2, 2-1, 3-0 ( 2 )
                
                const totalSets = team1Sets + team2Sets;
                if (totalSets > 2) {
                    alert(' 2   2 ');
                    return;
                }
                if (totalSets === 0) {
                    alert(' 1 ');
                    return;
                }
            } else {
                // /:  2 
                console.log('Not round robin - checking knockout rules');
            if (team1Sets < 2 && team2Sets < 2) {
                    console.log('Knockout validation failed - need at least 2 sets');
                alert(' 2 ');
                return;
                }
            }


            //  ID 
            let winner;
            let winnerId = '';
            
            if (isRoundRobin) {
                if (team1Sets === 0 && team2Sets === 0) {
                    //  - 
                    winner = '';
                    winnerId = '';
                } else if (team1Sets === team2Sets) {
                    //  - 
                    winner = '';
                    winnerId = '';
                } else {
                    // 
                    winner = team1Sets > team2Sets ? window.currentEditMatch.team1 : window.currentEditMatch.team2;
                    winnerId = team1Sets > team2Sets ? window.currentEditMatch.team1Id : window.currentEditMatch.team2Id;
                }
            } else {
                winner = team1Sets > team2Sets ? window.currentEditMatch.team1 : window.currentEditMatch.team2;
                winnerId = team1Sets > team2Sets ? window.currentEditMatch.team1Id : window.currentEditMatch.team2Id;
            }

            //  Google Sheets
            const matchData = {
                matchId: window.currentEditMatch.matchId,
                'Set1 T1': sets[0].team1,
                'Set1 T2': sets[0].team2,
                'Set2 T1': sets[1].team1,
                'Set2 T2': sets[1].team2,
                'Set3 T1': sets[2].team1,
                'Set3 T2': sets[2].team2,
                'Winner ID': winnerId,
                'Court': '',
                'Status': 'completed'
            };
            
            console.log('Prepared match data:', matchData);
            console.log('Winner ID debug:', {
                winner: winner,
                winnerId: winnerId,
                team1Sets: team1Sets,
                team2Sets: team2Sets,
                team1Id: window.currentEditMatch.team1Id,
                team2Id: window.currentEditMatch.team2Id
            });

            // 
            const saveBtn = document.querySelector('.btn-save');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '...';
            saveBtn.disabled = true;
            
            //  Progress Bar
            showSaveProgress(0, '...');

            try {
                //  Google Sheets
                showSaveProgress(20, '...');
                const result = await updateMatchInSheets(matchData);
                
                if (result.success) {
                    showSaveProgress(40, '');
                    let resultText;
                    if (isRoundRobin) {
                        if (team1Sets === 0 && team2Sets === 0) {
                            resultText = ': ';
                        } else if (team1Sets === team2Sets) {
                            resultText = `: ${team1Sets}-${team2Sets} ()`;
                        } else {
                            resultText = `: ${team1Sets}-${team2Sets}`;
                        }
                    } else {
                        resultText = `: ${team1Sets}-${team2Sets}`;
                    }
                    
                    //  Standings 
                    if (isRoundRobin) {
                        showSaveProgress(50, '...');
                        console.log('=== TRIGGERING STANDINGS UPDATE ===');
                        console.log('Match data for standings:', matchData);
                        console.log('Category for standings:', window.currentEditMatch.category);
                        console.log('Updating standings for round robin match...');
                        try {
                            //  Google Sheets
                            const categoryName = getCategoryDisplayName(window.currentEditMatch.category);
                            console.log(' Converting category:', window.currentEditMatch.category, '->', categoryName);
                            await updateStandingsAfterMatch(matchData, categoryName);
                            showSaveProgress(80, '');
                            console.log(' Standings updated successfully');
                        } catch (standingsError) {
                            console.error(' Error updating standings:', standingsError);
                            //   error  console
                        }
                    } else {
                        console.log('Not a round robin match, skipping standings update');
                    }
                    
                    updateProgressToTarget(100, '!');
                    
                    //  100%  Progress Bar
                    setTimeout(() => {
                        hideSaveProgress();
                        alert(` !\n\n: ${window.currentEditMatch.matchId}\n${resultText}\n\n Google Sheets ${isRoundRobin ? '\n ' : ''}`);
            closeScoreModal();
                    }, 1000);
            
                    //  cache 
                    const category = document.getElementById('adminCategorySelect').value;
                    if (category) {
                        clearCategoryCache(category);
                        console.log('Cache cleared for category:', category);
                    }
                    
                    // 
                    showSaveProgress(90, '...');
                    const matchesList = document.getElementById('adminMatchesList');
                    matchesList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
                    
                    //  0.5 
                    setTimeout(async () => {
                        console.log('Auto-refreshing admin matches after save...');
            loadAdminMatches();
                        
                        //  3 
                        await updateFinalsMatches(window.currentEditMatch.matchId);
                        
                        //  Progress Bar ()
                        updateProgressBar();
                        // 
                        if (allMatchesData) {
                            allMatchesData = await calculateAllMatchesStats();
                            // 
                            const allMatchesTable = document.getElementById('allMatchesTable');
                            if (allMatchesTable) {
                                filterAllMatches();
                            }
                        }
                        
                        //  Progress Bar 
                        setTimeout(() => {
                            hideSaveProgress();
                        }, 500);
                    }, 500);
                } else {
                    hideSaveProgress();
                    alert(` \n\n: ${result.message}\n\n`);
                }
            } catch (error) {
                console.error('Error saving match score:', error);
                hideSaveProgress();
                alert(` \n\n: ${error.message}\n\n`);
            } finally {
                // 
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }

        async function loadCategory(cat, fromRefresh = false) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 
            const categoryBtn = document.querySelector(`[onclick="loadCategory('${cat}')"]`);
            if (categoryBtn) {
                categoryBtn.classList.add('active');
            }
            
            currentCategory = cat;
            
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
            
            try {
                //  Google Sheets  Mock Data
                const categoryData = await getCategoryData(cat);
                const categoryName = getCategoryName(cat);
                const stats = getCategoryStats(categoryData);
                showCategory(cat, categoryName, stats);
            } catch (error) {
                console.error('Error loading category:', error);
                contentArea.innerHTML = `
                    <div style="padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;"></div>
                        <h3 style="color: #f44336; margin-bottom: 10px;"> Google Sheets </h3>
                        <p style="color: #666; margin-bottom: 20px;"> URL  Google Apps Script</p>
                        <button class="btn" onclick="loadCategory('${cat}')" style="margin-right: 10px;"> </button>
                        <button class="btn" onclick="showCategoryView()" style="background: #f44336;"> </button>
                    </div>
                `;
            }
        }

        // 
        function getCategoryName(category) {
            const names = {
                'A': ' A',
                'B': ' B',
                'C-B': ' C-B',
                'C-C': ' C-C',
                'D': ' D',
                '': '',
                '': ''
            };
            return names[category] || category;
        }

        // 
        function getCategoryStats(categoryData) {
            if (!categoryData) return '...';
            
            const teamCount = categoryData.groups ? 
                categoryData.groups.reduce((total, group) => total + group.teams.length, 0) : 0;
            const matchCount = categoryData.groups ? 
                categoryData.groups.reduce((total, group) => total + group.matches.length, 0) : 0;
            const knockoutCount = categoryData.knockoutMatches ? categoryData.knockoutMatches.length : 0;
            const finalsCount = categoryData.finals ? categoryData.finals.length : 0;
            const groupCount = categoryData.groups ? categoryData.groups.length : 0;
            
            return `${teamCount}   ${groupCount}   ${matchCount + knockoutCount + finalsCount} `;
        }

        // 


        //  Cache 
        let categoryCache = {
            'A': { data: null, lastUpdated: null, isLoaded: false },
            'B': { data: null, lastUpdated: null, isLoaded: false },
            'C-B': { data: null, lastUpdated: null, isLoaded: false },
            'C-C': { data: null, lastUpdated: null, isLoaded: false },
            'D': { data: null, lastUpdated: null, isLoaded: false },
            '': { data: null, lastUpdated: null, isLoaded: false },
            '': { data: null, lastUpdated: null, isLoaded: false }
        };

        //  Google Sheets  Cache
        async function loadCategoryDataFromSheets(category) {
            try {
                if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    console.log('Google Apps Script URL not configured, using mock data for', category);
                    return null;
                }

                //  cache
                if (categoryCache[category] && categoryCache[category].isLoaded && categoryCache[category].lastUpdated) {
                    const now = Date.now();
                    const cacheExpiry = 5 * 60 * 1000; // 5 
                    if (now - categoryCache[category].lastUpdated < cacheExpiry) {
                        console.log('Using cached data from Google Sheets for', category);
                        return categoryCache[category].data;
                    }
                }

                console.log('Loading data from Google Sheets for', category);
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(getCategoryName(category))}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    //  categoryCache[category] 
                    if (!categoryCache[category]) {
                        categoryCache[category] = { data: null, lastUpdated: null, isLoaded: false };
                    }
                    categoryCache[category].data = result.data;
                    categoryCache[category].lastUpdated = Date.now();
                    categoryCache[category].isLoaded = true;
                    console.log('Data loaded successfully from Google Sheets for', category);
                    return result.data;
                } else {
                    throw new Error(result.message || 'Failed to load data');
                }
            } catch (error) {
                console.error('Error loading data from Google Sheets for', category, ':', error);
                return null;
            }
        }

        //  Cache
        function clearCategoryCache(category = null) {
            if (category) {
                categoryCache[category] = { data: null, lastUpdated: null, isLoaded: false };
                console.log(`Cache cleared for category: ${category}`);
            } else {
                Object.keys(categoryCache).forEach(cat => {
                    categoryCache[cat] = { data: null, lastUpdated: null, isLoaded: false };
                });
                console.log('All cache cleared');
            }
        }

        //  Google Sheets API
        async function testGoogleSheetsAPI() {
            console.log(' Testing Google Sheets API...');
            
            try {
                // 
                console.log('1. Testing basic connection...');
                const testResponse = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                const testResult = await testResponse.json();
                console.log(' Basic connection test:', testResult);
                
                // 
                const categories = [' A', ' B', ' C-B', ' C-C', ' D', '', ''];
                
                for (const category of categories) {
                    console.log(`\n2. Testing category: ${category}`);
                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(category)}`);
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            console.log(` Category ${category} data loaded:`, result);
                            console.log(`   - Teams: ${result.counts?.teams || 0}`);
                            console.log(`   - Matches: ${result.counts?.matches || 0}`);
                            console.log(`   - Standings: ${result.counts?.standings || 0}`);
                            console.log(`   - Draw History: ${result.counts?.drawHistory || 0}`);
                        } else {
                            console.log(` Category ${category} returned error:`, result.message);
                        }
                    } catch (error) {
                        console.error(` Error testing category ${category}:`, error);
                    }
                }
                
                // 
                console.log('\n3. Testing getAllData...');
                try {
                    const allDataResponse = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getAllData`);
                    const allDataResult = await allDataResponse.json();
                    console.log(' All data test:', allDataResult);
                } catch (error) {
                    console.error(' Error testing getAllData:', error);
                }
                
                console.log('\n Google Sheets API testing completed!');
                
            } catch (error) {
                console.error(' Google Sheets API testing failed:', error);
            }
        }

        // 
        function checkForErrors() {
            console.log(' Checking for common errors...');
            let errorCount = 0;
            
            //  Google Apps Script URL
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                console.warn(' Google Apps Script URL not configured');
                errorCount++;
            }
            
            //  Google Sheets URL
            if (!GOOGLE_SHEETS_URL) {
                console.warn(' Google Sheets URL not configured');
                errorCount++;
            }
            
            //  localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log(' localStorage is working');
            } catch (error) {
                console.error(' localStorage error:', error);
                errorCount++;
            }
            
            //  fetch API
            if (typeof fetch === 'undefined') {
                console.error(' Fetch API not available');
                errorCount++;
            } else {
                console.log(' Fetch API is available');
            }
            
            //  console
            if (typeof console === 'undefined') {
                console.error(' Console not available');
                errorCount++;
            } else {
                console.log(' Console is available');
            }
            
            if (errorCount === 0) {
                console.log(' No errors found! System is ready.');
            } else {
                console.log(` Found ${errorCount} potential issues.`);
            }
            
            return errorCount === 0;
        }

        function showCategory(categoryKey, categoryName, stats) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="bracket-container">
                    <div class="bracket-header">
                        <h2 class="bracket-title">${categoryName}</h2>
                        <div class="bracket-stats">${stats}</div>
                    </div>
                    <div class="tabs-container">
                        <div class="tabs-nav">
                            <button class="tab-btn active" onclick="switchTab('${categoryKey}', 'round-robin')"> </button>
                            <button class="tab-btn" onclick="switchTab('${categoryKey}', 'knockout')"> </button>
                            <button class="tab-btn" onclick="switchTab('${categoryKey}', 'finals')"> </button>
                        </div>
                        <div class="tab-content" id="tabContent">
                            <div class="loading"><div class="loading-spinner"></div><div>...</div></div>
                        </div>
                    </div>
                </div>
            `;
            
            // 
            setTimeout(async () => {
                try {
                    const content = await getContent(categoryKey, 'round-robin');
                    const tabContent = document.getElementById('tabContent');
                    if (tabContent) {
                        tabContent.innerHTML = content;
                    }
                } catch (error) {
                    console.error('Error loading initial content:', error);
                    const tabContent = document.getElementById('tabContent');
                    if (tabContent) {
                        tabContent.innerHTML = '<div class="error"></div>';
                    }
                }
            }, 100);
        }

        async function switchTab(category, tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            const tabContent = document.getElementById('tabContent');
            tabContent.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
            
            try {
                const content = await getContent(category, tab);
                tabContent.innerHTML = content;
            } catch (error) {
                console.error('Error loading tab content:', error);
                tabContent.innerHTML = '<div class="error"></div>';
            }
        }

        async function getContent(category, tab) {
            const categoryData = await getCategoryData(category);
            
            if (tab === 'round-robin') {
                return generateRoundRobinContent(categoryData);
            } else if (tab === 'knockout') {
                return generateKnockoutContent(categoryData);
            } else if (tab === 'finals') {
                return generateFinalsContent(categoryData);
            }
        }

        async function getCategoryData(category) {
            try {
                //  Google Sheets 
                const sheetsData = await loadCategoryDataFromSheets(category);
                if (sheetsData) {
                    const convertedData = convertSheetsDataToDisplayFormat(sheetsData, category);
                    if (convertedData) {
                        return convertedData;
                    }
                }

                //  Google Sheets 
                console.error('Cannot connect to Google Sheets for category:', category);
                throw new Error(' Google Sheets   URL  Google Apps Script');
            } catch (error) {
                console.error('Error loading category data:', error);
                throw new Error(' Google Sheets   URL  Google Apps Script');
            }
        }

        //  Google Sheets  Display
        function convertSheetsDataToDisplayFormat(sheetsData, category) {
            if (!sheetsData) {
                throw new Error(' Google Sheets   URL  Google Apps Script');
            }

            const teams = sheetsData.teams || [];
            const matches = sheetsData.matches || [];
            const standings = sheetsData.standings || [];
            const drawHistory = sheetsData.drawHistory || [];

            // 
            return convertToDisplayFormat(teams, matches, standings, drawHistory, category);
        }

        //  category name  key
        function getCategoryKey(categoryName) {
            const categoryMap = {
                ' A': 'A',
                ' B': 'B', 
                ' C-B': 'C-B',
                ' C-C': 'C-C',
                ' D': 'D',
                '': '',
                '': ''
            };
            return categoryMap[categoryName] || categoryName;
        }
        
        //  category key  display name
        function getCategoryDisplayName(categoryKey) {
            const categoryMap = {
                'A': ' A',
                'B': ' B', 
                'C-B': ' C-B',
                'C-C': ' C-C',
                'D': ' D',
                '': '',
                '': ''
            };
            return categoryMap[categoryKey] || categoryKey;
        }

        //  Google Sheets
        async function getTeamsData() {
            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getTeams`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                if (result.status === 'success') {
                    return result.data;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error fetching teams data:', error);
                throw error;
            }
        }

        //  standings  Google Sheets
        async function getStandingsData() {
            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getStandings`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                if (result.status === 'success') {
                    return result.data;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error fetching standings data:', error);
                throw error;
            }
        }

        //  Google Sheets  Display
        function convertToDisplayFormat(teams, matches, standings, drawHistory, category) {
            console.log('Converting data for category:', category);
            console.log('Teams:', teams);
            console.log('Matches:', matches);
            console.log('Standings:', standings);
            console.log('Draw History:', drawHistory);
            
            //  round_type
            const roundRobinMatches = matches.filter(m => m.round_type === '');
            const knockoutMatches = matches.filter(m => m.round_type === '4' || m.round_type === '8');
            const finalsMatches = matches.filter(m => m.round_type === '' || m.round_type === '3');
            
            console.log('Round Robin Matches:', roundRobinMatches);
            console.log('Knockout Matches:', knockoutMatches);
            console.log('Finals Matches:', finalsMatches);

            //  groups  standings
            const groups = {};
            standings.forEach(standing => {
                if (!groups[standing.group_name]) {
                    groups[standing.group_name] = {
                        name: standing.group_name,
                        teams: [],
                        matches: []
                    };
                }
                groups[standing.group_name].teams.push({
                    rank: standing.rank_in_group,
                    name: standing.team_name,
                    matches: standing.matches_played,
                    wins: standing.wins,
                    draws: standing.draws || 0,
                    losses: standing.losses || 0,
                    points: standing.points,
                    totalPoints: standing.total_points_scored || 0,
                    qualified: standing.qualified
                });
            });

            // 
            Object.keys(groups).forEach(groupName => {
                const groupMatches = roundRobinMatches.filter(m => {
                    // 
                    const team1InGroup = standings.find(s => s.team_id === m.team1_id && s.group_name === groupName);
                    const team2InGroup = standings.find(s => s.team_id === m.team2_id && s.group_name === groupName);
                    return team1InGroup && team2InGroup;
                });

                groups[groupName].matches = groupMatches.map(m => {
                    const convertedMatch = {
                        id: m.match_id,
                        team1: m.team1_name,
                        team2: m.team2_name,
                        team1_id: m.team1_id,  //  team1_id
                        team2_id: m.team2_id,  //  team2_id
                        round: '',  //  round
                        category: category,  //  category
                        score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                        score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                        sets1: (m.set1_team1 > m.set1_team2 ? 1 : 0) + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                        sets2: (m.set1_team2 > m.set1_team1 ? 1 : 0) + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                        completed: m.match_status === 'completed'
                    };
                    console.log('Converting round robin match:', m.match_id, '->', convertedMatch);
                    return convertedMatch;
                });
            });

            //  knockout matches
            const knockoutFormatted = knockoutMatches.map(m => ({
                id: m.match_id,
                team1: m.team1_name,
                team2: m.team2_name,
                team1_id: m.team1_id,  //  team1_id
                team2_id: m.team2_id,  //  team2_id
                round: m.round_type,  //  round
                category: category,  //  category
                score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                sets1: (m.set1_team1 > m.set1_team2 ? 1 : 0) + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                sets2: (m.set1_team2 > m.set1_team1 ? 1 : 0) + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                completed: m.match_status === 'completed'
            }));

            //  finals matches
            const finalsFormatted = finalsMatches.map(m => ({
                id: m.match_id,
                type: m.round_type === '' ? 'championship' : 'third-place',
                team1: m.team1_name,
                team2: m.team2_name,
                team1_id: m.team1_id,  //  team1_id
                team2_id: m.team2_id,  //  team2_id
                round: m.round_type,  //  round
                category: category,  //  category
                score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                sets1: (m.set1_team1 > m.set1_team2 ? 1 : 0) + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                sets2: (m.set1_team2 > m.set1_team1 ? 1 : 0) + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                completed: m.match_status === 'completed'
            }));

            return {
                groups: Object.values(groups),
                knockoutMatches: knockoutFormatted,
                finals: finalsFormatted
            };
        }

        //  Mock Data (Fallback)
        //  Mock Data   Google Sheets 
        function getMockCategoryData(category) {
            throw new Error('Mock Data   Google Sheets');
            const data = {
                'A': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '+Alai', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M001', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M002', team1: '-', team2: '+Alai', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M003', team1: '-', team2: '+Alai', score1: [16, 19], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M004', team1: '-', team2: '-', score1: [12, 18], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M005', team1: '-', team2: '-', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true },
                                { id: 'M006', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M007', team1: '-', team2: '-', score1: [21, 19, 21], score2: [18, 21, 16], sets1: 2, sets2: 1, completed: true },
                        { id: 'M008', team1: '-', team2: '+Alai', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M009', type: 'championship', team1: '-', team2: '-', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M010', type: 'third-place', team1: '-', team2: '+Alai', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'B': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '- 1000', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M011', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M012', team1: '-', team2: '- 1000', score1: [21, 21], score2: [14, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M013', team1: '-', team2: '- 1000', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M014', team1: '-', team2: '-', score1: [15, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M015', team1: '-', team2: '-', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true },
                                { id: 'M016', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 3',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M017', team1: '-', team2: '-', score1: [21, 18], score2: [19, 21], sets1: 1, sets2: 2, completed: true },
                                { id: 'M018', team1: '-', team2: '-', score1: [19, 16], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M019', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 4',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M020', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M021', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M022', team1: '-', team2: '-', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M023', team1: '-', team2: '-', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M024', team1: '-', team2: '-', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M025', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M026', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M027', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M028', team1: '8', team2: '8', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M029', type: 'championship', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M030', type: 'third-place', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                },
                'C-B': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 3, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: '-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: '-', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: '-', matches: 3, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M031', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M032', team1: '-', team2: '-', score1: [21, 21], score2: [15, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M033', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M034', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M035', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M036', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 3, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: '-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: '-', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: '-', matches: 3, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M037', team1: '-', team2: '-', score1: [18, 16], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M038', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M039', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M040', team1: '-', team2: '-', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M041', team1: '-', team2: '-', score1: [21, 21], score2: [14, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M042', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 3',
                            teams: [
                                { rank: 1, name: '-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '1000-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: '-', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: '-', matches: 3, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M043', team1: '-', team2: '1000-', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M044', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M045', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M046', team1: '1000-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M047', team1: '1000-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M048', team1: '-', team2: '-', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: ' 4',
                            teams: [
                                { rank: 1, name: '-', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: '-', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: '-', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: '-', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M049', team1: '-', team2: '-', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M050', team1: '-', team2: '-', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M051', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M052', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M053', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M054', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M055', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M056', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M057', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M058', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M059', team1: '-', team2: '-', score1: [21, 16, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M060', team1: '-', team2: '1000-', score1: [21, 18, 21], score2: [17, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M061', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M062', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M063', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M064', team1: '8', team2: '8', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M065', type: 'championship', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M066', type: 'third-place', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                },
                'C-C': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: '-', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: '-', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: '-', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M067', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M068', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M069', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M070', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M071', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M072', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M073', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M074', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M075', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M076', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 5, wins: 5, points: 15, qualified: true },
                                { rank: 2, name: '-', matches: 5, wins: 4, points: 12, qualified: true },
                                { rank: 3, name: '-', matches: 5, wins: 3, points: 9, qualified: false },
                                { rank: 4, name: '-', matches: 5, wins: 2, points: 6, qualified: false },
                                { rank: 5, name: '-', matches: 5, wins: 1, points: 3, qualified: false },
                                { rank: 6, name: '-', matches: 5, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M077', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M078', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M079', team1: '-', team2: '-', score1: [21, 21], score2: [15, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M080', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M081', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M082', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M083', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M084', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M085', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M086', team1: '-', team2: '-', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M087', team1: '-', team2: '-', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M088', team1: '-', team2: '-', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true },
                                { id: 'M089', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M090', team1: '-', team2: '-', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M091', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M092', team1: '-', team2: '-', score1: [21, 19, 21], score2: [18, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M093', team1: '-', team2: '-', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M094', type: 'championship', team1: '-', team2: '-', score1: [21, 18, 21], score2: [19, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M095', type: 'third-place', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'D': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: '-', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: '-', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: '-', matches: 4, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M096', team1: '-', team2: '-', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M097', team1: '-', team2: '-', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M098', team1: '-', team2: '-', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M099', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M100', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M101', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M102', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M103', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M104', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M105', team1: '-', team2: '-', score1: [19, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: '-', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: '-', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: '-', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M106', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M107', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M108', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M109', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M110', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M111', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M112', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M113', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M114', team1: '-', team2: '-', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true },
                                { id: 'M115', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M116', team1: '-', team2: '-', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M117', team1: '-', team2: '-', score1: [21, 16, 21], score2: [18, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M118', type: 'championship', team1: '-', team2: '-', score1: [21, 19, 21], score2: [18, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M119', type: 'third-place', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                '': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: '-', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: '-', matches: 3, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M120', team1: '-', team2: '-', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M121', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M122', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M123', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M124', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M125', team1: '-', team2: '-', score1: [19, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: '-', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: '-', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: '-', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: '-', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M126', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M127', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M128', team1: '-', team2: '-', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M129', team1: '-', team2: '-', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M130', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M131', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M132', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M133', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M134', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M135', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M136', team1: '-', team2: '-', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M137', team1: '-', team2: '-', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M138', type: 'championship', team1: '-', team2: '-', score1: [21, 19, 21], score2: [18, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M139', type: 'third-place', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                '': {
                    groups: [
                        {
                            name: ' 1',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M140', team1: '-', team2: '-', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M141', team1: '-', team2: '-', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M142', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 2',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M143', team1: '-', team2: '-', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M144', team1: '-', team2: '-', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M145', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 3',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M146', team1: '-', team2: '-', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M147', team1: '-', team2: '-', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M148', team1: '-', team2: '-', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: ' 4',
                            teams: [
                                { rank: 1, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 2, name: '-', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: '-', matches: 2, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M149', team1: '-', team2: '-', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M150', team1: '-', team2: '-', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M151', team1: '-', team2: '-', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M152', team1: '-', team2: '-', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M153', team1: '-', team2: '-', score1: [21, 16, 21], score2: [18, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M154', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M155', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M156', team1: '-', team2: '-', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M157', team1: '8', team2: '8', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M158', type: 'championship', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M159', type: 'third-place', team1: '', team2: '', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                }
            };
            
            return data[category] || { groups: [], knockoutMatches: [], finals: [] };
        }

        function generateRoundRobinContent(data) {
            console.log('Generating round robin content with data:', data);
            
            if (!data || !data.groups) {
                console.error('Invalid data structure:', data);
                return '<div class="error"></div>';
            }
            
            let content = '<div class="groups-container">';
            
            //  (Standings Table)
            data.groups.forEach(group => {
                content += `
                    <div class="group-card">
                        <div class="group-title">${group.name}</div>
                        <div class="standings-table">
                            <div class="table-header">
                                <span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span>
                            </div>`;
                            
                group.teams.forEach(team => {
                    content += `
                        <div class="team-row">
                            <span class="rank">${team.rank}</span>
                            <span class="team-name">${team.name}</span>
                            <span>${team.matches}</span>
                            <span>${team.wins}</span>
                            <span>${team.draws || 0}</span>
                            <span>${team.losses || 0}</span>
                            <span class="points">${team.points}</span>
                            <span class="total-points">${team.totalPoints || 0}</span>
                        </div>`;
                });
                
                content += '</div></div>';
            });
            
            content += '</div>';
            
            if (data.groups[0] && data.groups[0].matches) {
                content += `
                    <div class="round-robin-matches">
                        <h4 class="matches-section-title"></h4>`;
                        
                data.groups.forEach(group => {
                    if (group.matches && group.matches.length > 0) {
                        content += `
                            <div class="group-matches">
                                <div class="group-matches-title">${group.name}</div>`;
                                
                        group.matches.forEach(match => {
                            content += `
                                <div class="round-robin-match-card ${match.completed ? 'completed' : ''}">
                                    <div class="rr-match-header">
                                        <span>${match.id}</span>
                                        <span>${match.completed ? '' : ''}</span>
                                    </div>
                                    <div class="rr-match-teams">
                                        <div class="rr-team">
                                            <span class="rr-team-name">${match.team1}</span>
                                            <div class="score-display">`;
                                            
                            if (match.completed && match.score1 && match.score1.length > 0) {
                                match.score1.forEach((score, index) => {
                                    const isWin = match.score2[index] && score > match.score2[index];
                                    content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                                });
                                content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                            } else {
                                content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                            }
                            
                            content += `
                                            </div>
                                        </div>
                                        <div class="rr-vs">VS</div>
                                        <div class="rr-team">
                                            <span class="rr-team-name">${match.team2}</span>
                                            <div class="score-display">`;
                                            
                            if (match.completed && match.score2 && match.score2.length > 0) {
                                match.score2.forEach((score, index) => {
                                    const isWin = match.score1[index] && score > match.score1[index];
                                    content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                                });
                                content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                            } else {
                                content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                            }
                            
                            content += `
                                            </div>
                                        </div>
                                    </div>
                                </div>`;
                        });
                        
                        content += '</div>';
                    }
                });
                
                content += '</div>';
            }
            
            return content;
        }

        function generateKnockoutContent(data) {
            console.log('Generating knockout content with data:', data);
            
            if (!data || !data.knockoutMatches) {
                console.error('Invalid data structure for knockout:', data);
                return '<div class="error"></div>';
            }
            
            let content = `
                <div class="knockout-section">
                    <h4 class="section-title"> ${data.knockoutMatches.length >= 4 ? '8' : data.knockoutMatches.length * 2} </h4>
                    <div class="matches-grid">`;
                    
            const round8Matches = data.knockoutMatches.slice(0, 4);
            round8Matches.forEach(match => {
                content += `
                    <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                        <div class="match-header">
                            <span>${match.id}</span>
                            <span>${match.completed ? '' : ''}</span>
                        </div>
                        <div class="match-teams">
                            <div class="team">
                                <span class="team-name">${match.team1}</span>
                                <div class="score-display">`;
                                
                if (match.completed && match.score1 && match.score1.length > 0) {
                    match.score1.forEach((score, index) => {
                        const isWin = match.score2[index] && score > match.score2[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                </div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="team">
                                <span class="team-name">${match.team2}</span>
                                <div class="score-display">`;
                                
                if (match.completed && match.score2 && match.score2.length > 0) {
                    match.score2.forEach((score, index) => {
                        const isWin = match.score1[index] && score > match.score1[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
            
            content += '</div>';
            
            // Add round 4 teams if exists
            const round4Matches = data.knockoutMatches.slice(4);
            if (round4Matches.length > 0) {
                content += `
                    <h4 class="section-title"> 4  ()</h4>
                    <div class="matches-grid">`;
                    
                round4Matches.forEach(match => {
                    content += `
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? '' : ''}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score1 && match.score1.length > 0) {
                        match.score1.forEach((score, index) => {
                            const isWin = match.score2[index] && score > match.score2[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score2 && match.score2.length > 0) {
                        match.score2.forEach((score, index) => {
                            const isWin = match.score1[index] && score > match.score1[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                
                content += '</div>';
            }
            
            content += '</div>';
            return content;
        }

        function generateFinalsContent(data) {
            console.log('Generating finals content with data:', data);
            
            if (!data || !data.finals) {
                console.error('Invalid data structure for finals:', data);
                return '<div class="error"></div>';
            }
            
            let content = '<div class="finals-section">';
            
            data.finals.forEach(match => {
                const matchClass = match.type === 'championship' ? 'championship' : 'third-place';
                const matchLabel = match.type === 'championship' ? ' ' : '  3';
                
                content += `
                    <div class="final-match ${matchClass}">
                        <div class="match-label">${matchLabel}</div>
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? '' : ''}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                if (match.completed && match.score1 && match.score1.length > 0) {
                    match.score1.forEach((score, index) => {
                        const isWin = match.score2[index] && score > match.score2[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    if (match.score1.length === 2) {
                        content += `<span class="set-score">-</span>`;
                    }
                    content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                if (match.completed && match.score2 && match.score2.length > 0) {
                    match.score2.forEach((score, index) => {
                        const isWin = match.score1[index] && score > match.score1[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    if (match.score2.length === 2) {
                        content += `<span class="set-score">-</span>`;
                    }
                    content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
            
            content += '</div>';
            return content;
        }

        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminPassword').focus();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === '987') {
                isAdminMode = true;
                closeAdminModal();
                showAdminPanel();
            } else {
                alert('');
                document.getElementById('adminPassword').value = '';
            }
        }

        function showAdminPanel() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Hide navigation views and container
            document.getElementById('categoryView').style.display = 'none';
            document.getElementById('teamSearchView').style.display = 'none';
            document.querySelector('.nav-container').style.display = 'none';
            
            // Show admin content
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="admin-container">
                    <div class="admin-header">
                        <h2 class="admin-title"> Admin Panel</h2>
                        <div class="admin-stats"> MN Tournament</div>
                        <button class="admin-logout-btn" onclick="logoutAdmin()"></button>
                    </div>
                    <div class="admin-tabs-container">
                        <div class="admin-tabs-nav">
                            <button class="admin-tab-btn active" onclick="switchAdminTab('match-management')"> </button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('all-matches')"> </button>
                            <!-- <button class="admin-tab-btn" onclick="switchAdminTab('draw-system')"> </button> -->
                            <button class="admin-tab-btn" onclick="switchAdminTab('settings')"> </button>
                        </div>
                        <div class="admin-tab-content" id="adminTabContent">
                            <div class="loading"><div class="loading-spinner"></div><div>...</div></div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load default tab content
            setTimeout(() => {
                switchAdminTab('match-management');
            }, 100);
        }

        function logoutAdmin() {
            isAdminMode = false;
            
            // Show navigation container back
            document.querySelector('.nav-container').style.display = 'block';
            
            showCategoryView();
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="welcome-screen">
                    <div class="welcome-icon"></div>
                    <div class="welcome-title"></div>
                    <div class="welcome-text">
                        
                        <br><br>
                         
                    </div>
                </div>
            `;
        }

        async function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // If called from onclick event, use event.target
            if (event && event.target) {
            event.target.classList.add('active');
            } else {
                // If called programmatically, find the correct tab button
                const tabButtons = document.querySelectorAll('.admin-tab-btn');
                tabButtons.forEach(btn => {
                    if (btn.textContent.includes(' ') && tab === 'match-management') {
                        btn.classList.add('active');
                    } else if (btn.textContent.includes(' ') && tab === 'all-matches') {
                        btn.classList.add('active');
                    } else if (btn.textContent.includes(' ') && tab === 'settings') {
                        btn.classList.add('active');
                    }
                });
            }
            
            const tabContent = document.getElementById('adminTabContent');
            tabContent.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
            
            try {
                const content = await getAdminTabContent(tab);
                tabContent.innerHTML = content;
                
                // Update data stats when opening settings tab
                if (tab === 'settings') {
                    setTimeout(() => {
                        updateDataStats();
                    }, 100);
                }
            } catch (error) {
                console.error('Error loading tab content:', error);
                tabContent.innerHTML = '<div class="error-message"></div>';
            }
        }

        async function getAdminTabContent(tab) {
            switch(tab) {
                case 'match-management':
                    return generateMatchManagementContent();
                case 'all-matches':
                    // Initialize data when opening this tab
                    allMatchesData = await calculateAllMatchesStats();
                    const content = await generateAllMatchesContent();
                    //  Progress Bar  ()
                    updateProgressBar();
                    return content;
                case 'draw-system':
                    // 
                    return '<div class="admin-placeholder"></div>';
                case 'settings':
                    return generateSettingsContent();
                default:
                    return '<div class="admin-placeholder"></div>';
            }
        }

        function generateMatchManagementContent() {
            return `
                <div class="match-management-container">
                    <div class="match-management-header">
                        <h3> </h3>
                        <p></p>
                    </div>
                    
                    <div class="selectors-container">
                        <div class="category-selector">
                            <label for="adminCategorySelect">:</label>
                            <select id="adminCategorySelect" class="admin-select" onchange="loadAdminMatches()">
                                <option value=""></option>
                                <option value="A"> A</option>
                                <option value="B"> B</option>
                                <option value="C-B"> C-B</option>
                                <option value="C-C"> C-C</option>
                                <option value="D"> D</option>
                                <option value=""></option>
                                <option value=""></option>
                            </select>
                        </div>
                        
                        <div class="round-selector">
                            <label for="adminRoundSelect">:</label>
                            <select id="adminRoundSelect" class="admin-select" onchange="filterMatchesByRound()">
                                <option value=""></option>
                                <option value=""> (Round Robin)</option>
                                <option value=" 8 "> 8 </option>
                                <option value=" 4 "> 4  ()</option>
                                <option value=""></option>
                                <option value=" 3"> 3</option>
                            </select>
                        </div>
                    </div>
                    
                    
                    <div id="adminMatchesList" class="admin-matches-list">
                        <div class="no-selection"></div>
                    </div>
                </div>
            `;
        }

        async function generateAllMatchesContent() {
            // 
            const allMatchesData = await calculateAllMatchesStats();
            
            return `
                <div class="all-matches-container">
                    <div class="all-matches-header">
                        <h3> </h3>
                        <div class="matches-summary">
                            <div class="summary-item">
                                <span class="summary-label">:</span>
                                <span class="summary-value">${allMatchesData.total}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">:</span>
                                <span class="summary-value">${allMatchesData.completed}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">:</span>
                                <span class="summary-value">${allMatchesData.pending}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-progress-container">
                        <div class="admin-progress-label"></div>
                        <div class="admin-progress-bar">
                            <div class="admin-progress-fill" id="adminProgressFill" style="width: 0%"></div>
                        </div>
                        <div class="admin-progress-text" id="adminProgressText">0% (0/159 )</div>
                    </div>
                    
                    <div class="all-matches-filters">
                        <div class="filter-group">
                            <label for="allMatchesCategoryFilter">:</label>
                            <select id="allMatchesCategoryFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value=""></option>
                                <option value="A"> A</option>
                                <option value="B"> B</option>
                                <option value="C-B"> C-B</option>
                                <option value="C-C"> C-C</option>
                                <option value="D"> D</option>
                                <option value=""></option>
                                <option value=""></option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="allMatchesRoundFilter">:</label>
                            <select id="allMatchesRoundFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value=""></option>
                                <option value=""></option>
                                <option value=" 8 "> 8 </option>
                                <option value=" 4 "> 4 </option>
                                <option value=""></option>
                                <option value=" 3"> 3</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="allMatchesStatusFilter">:</label>
                            <select id="allMatchesStatusFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value=""></option>
                                <option value="completed"></option>
                                <option value="pending"></option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="allMatchesTable" class="all-matches-table">
                        ${generateAllMatchesTable(allMatchesData.matches)}
                    </div>
                </div>
            `;
        }

        async function calculateAllMatchesStats() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', '', ''];
            let allMatches = [];
            let completedCount = 0;
            
            for (const category of categories) {
                try {
                    const categoryData = await getCategoryData(category);
                
                // 
                categoryData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        const matchData = {
                            ...match,
                            category,
                            round: '',
                            group: group.name,
                            roundSort: 1
                        };
                        allMatches.push(matchData);
                        if (match.completed) completedCount++;
                    });
                });
                
                // 
                categoryData.knockoutMatches.forEach((match, index) => {
                    const totalKnockout = categoryData.knockoutMatches.length;
                    let roundName = ' 8 ';
                    let roundSort = 2;
                    
                    if (totalKnockout >= 4) {
                        if (index >= 4) {
                            roundName = ' 4 ';
                            roundSort = 3;
                        }
                    } else {
                        roundName = ' 4 ';
                        roundSort = 3;
                    }
                    
                    const matchData = {
                        ...match,
                        category,
                        round: roundName,
                        group: null,
                        roundSort
                    };
                    allMatches.push(matchData);
                    if (match.completed) completedCount++;
                });
                
                // 
                categoryData.finals.forEach(match => {
                    const roundName = match.type === 'championship' ? '' : ' 3';
                    const roundSort = match.type === 'championship' ? 4 : 5;
                    
                    const matchData = {
                        ...match,
                        category,
                        round: roundName,
                        group: null,
                        roundSort
                    };
                    allMatches.push(matchData);
                    if (match.completed) completedCount++;
                });
                } catch (error) {
                    console.error(`Error loading data for category ${category}:`, error);
                }
            }
            
            //  category  match ID
            allMatches.sort((a, b) => {
                const categoryOrder = ['A', 'B', 'C-B', 'C-C', 'D', '', ''];
                const catA = categoryOrder.indexOf(a.category);
                const catB = categoryOrder.indexOf(b.category);
                
                if (catA !== catB) return catA - catB;
                return a.id.localeCompare(b.id);
            });
            
            return {
                matches: allMatches,
                completed: completedCount,
                total: allMatches.length,
                pending: allMatches.length - completedCount
            };
        }

        function generateAllMatchesTable(matches) {
            return `
                <div class="matches-table-container">
                    <div class="matches-table-header">
                        <div class="table-stats"> ${matches.length}   ${allMatchesData ? allMatchesData.total : 159} </div>
                    </div>
                    <div class="matches-table-scroll">
                        <table class="matches-table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th> 1</th>
                                    <th> 2</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                ${matches.map(match => generateMatchTableRow(match)).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ===================== Draw System (Manual) =====================
        let drawOverrides = {};
        let drawHistory = [];

        function loadDrawPersistence() {
            try {
                const o = localStorage.getItem('mn_draw_overrides');
                const h = localStorage.getItem('mn_draw_history');
                drawOverrides = o ? JSON.parse(o) : {};
                drawHistory = h ? JSON.parse(h) : [];
            } catch(e) {
                drawOverrides = {};
                drawHistory = [];
            }
        }

        function saveDrawPersistence() {
            localStorage.setItem('mn_draw_overrides', JSON.stringify(drawOverrides));
            localStorage.setItem('mn_draw_history', JSON.stringify(drawHistory));
        }

        function applyDrawOverridesToData(data) {
            if (!data) return;
            if (data.knockoutMatches) {
                data.knockoutMatches = data.knockoutMatches.map(m => {
                    const o = drawOverrides[m.id];
                    if (o) {
                        return { ...m, team1: o.team1 || m.team1, team2: o.team2 || m.team2 };
                    }
                    return m;
                });
            }
            if (data.finals) {
                data.finals = data.finals.map(m => {
                    const o = drawOverrides[m.id];
                    if (o) {
                        return { ...m, team1: o.team1 || m.team1, team2: o.team2 || m.team2 };
                    }
                    return m;
                });
            }
        }

        async function generateDrawSystemContent() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', '', ''];
            const options = categories.map(c => `<option value="${c}"> ${c}</option>`).join('');
            
            //  datalist  ()
            const datalist = '';

            return `
                <div class="draw-container">
                    <div class="draw-header">
                        <h3>  ()</h3>
                        <p> </p>
                        <div class="draw-info">
                            <p><strong>:</strong>  3 </p>
                            <p>  = 2  4  ()</p>
                            <p>  3 = 2  4  ()</p>
                            <p><strong> :</strong>  dropdown </p>
                        </div>
                    </div>
                    <div class="selectors-container">
                        <div class="category-selector">
                            <label for="drawCategorySelect">:</label>
                            <select id="drawCategorySelect" class="admin-select" onchange="renderDrawMatches()">
                                <option value=""></option>
                                ${options}
                            </select>
                        </div>
                    </div>

                    <div id="drawMatchesArea" class="draw-matches-area">
                        <div class="admin-placeholder"></div>
                    </div>

                    <div class="draw-history">
                        <h4>  (${drawHistory.length})</h4>
                        <div id="drawHistoryTable">${generateDrawHistoryTable()}</div>
                    </div>

                    <datalist id="teamNamesList">${datalist}</datalist>
                </div>
            `;
        }

        function generateDrawHistoryTable() {
            if (!drawHistory || drawHistory.length === 0) {
                return '<div class="admin-placeholder"></div>';
            }
            const rows = drawHistory.slice().reverse().map(h => `
                <tr>
                    <td>${h.date}</td>
                    <td> ${h.category}</td>
                    <td>${h.round}</td>
                    <td>${h.matchId}</td>
                    <td>${h.team1}</td>
                    <td>${h.team2}</td>
                    <td>${h.drawnBy || '-'}</td>
                    <td>${h.notes || ''}</td>
                </tr>
            `).join('');
            return `
                <div class="matches-table-scroll">
                    <table class="matches-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th>Match ID</th>
                                <th> 1</th>
                                <th> 2</th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `;
        }

        async function getWaitingDrawMatches(categoryKey) {
            const data = await getCategoryData(categoryKey);
            const waiting = [];
            const isPlaceholder = (name) => !name || name.includes('') || name.includes('') || name === 'TBD';
            
            //  ( 8   4 ) 
            data.knockoutMatches.forEach((m, idx) => {
                let round = data.knockoutMatches.length >= 4 && idx < 4 ? ' 8 ' : ' 4 ';
                if (isPlaceholder(m.team1) || isPlaceholder(m.team2)) {
                    waiting.push({ ...m, round });
                }
            });
            
            //  3  4 
            //  1 () = 2  4 
            //  3 ( 3) = 2  4 
            
            return waiting;
        }

        async function renderDrawMatches() {
            const cat = document.getElementById('drawCategorySelect').value;
            const area = document.getElementById('drawMatchesArea');
            if (!cat) {
                area.innerHTML = '<div class="admin-placeholder"></div>';
                //  datalist 
                const teamNamesList = document.getElementById('teamNamesList');
                if (teamNamesList) {
                    teamNamesList.innerHTML = '';
                }
                return;
            }
            
            //  loading
            area.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>...</div></div>';
            
            try {
                const matches = await getWaitingDrawMatches(cat);
                if (matches.length === 0) {
                    area.innerHTML = '<div class="admin-placeholder"></div>';
                    return;
                }
                
                // 
                const categoryTeams = await getTeamsByCategory(cat);
                const teamDatalist = categoryTeams.map(team => `<option value="${team}"></option>`).join('');
                
                //  datalist 
                const teamNamesList = document.getElementById('teamNamesList');
                if (teamNamesList) {
                    teamNamesList.innerHTML = teamDatalist;
                }
            const cards = matches.map(m => `
                <div class="match-card pending">
                    <div class="match-header">
                        <span>${m.id}</span>
                        <span>${m.round}</span>
                    </div>
                    <div class="match-teams">
                        <div class="team">
                            <span class="team-name"> 1</span>
                            <input list="teamNamesList" class="admin-search-input" id="draw_${m.id}_t1" placeholder="${m.team1 || ''}">
                        </div>
                        <div class="rr-vs">VS</div>
                        <div class="team">
                            <span class="team-name"> 2</span>
                            <input list="teamNamesList" class="admin-search-input" id="draw_${m.id}_t2" placeholder="${m.team2 || ''}">
                        </div>
                    </div>
                    <div class="match-actions" style="margin-top: 10px;">
                        <button class="table-btn-record" onclick="applyDrawForMatch('${cat}','${m.round}','${m.id}')"></button>
                    </div>
                </div>
            `).join('');
            area.innerHTML = `<div class="matches-grid">${cards}</div>`;
            } catch (error) {
                console.error('Error loading draw matches:', error);
                area.innerHTML = '<div class="error"></div>';
            }
        }

        async function applyDrawForMatch(categoryKey, roundText, matchId) {
            const t1 = (document.getElementById(`draw_${matchId}_t1`).value || '').trim();
            const t2 = (document.getElementById(`draw_${matchId}_t2`).value || '').trim();
            if (!t1 || !t2) {
                alert('');
                return;
            }
            
            try {
                //  Google Sheets
                const matchData = {
                    matchId: matchId,
                    team1: t1,
                    team2: t2
                };
                
                const result = await updateMatchInSheets(matchData);
                
                if (result.success) {
                    //  local storage
                    drawOverrides[matchId] = { team1: t1, team2: t2 };
                    drawHistory.push({
                        date: new Date().toLocaleString(),
                        category: categoryKey,
                        round: roundText,
                        matchId,
                        team1: t1,
                        team2: t2,
                        drawnBy: 'admin',
                        notes: ''
                    });
                    saveDrawPersistence();
                    
                    alert(`  ${matchId} \n\n 1: ${t1}\n 2: ${t2}\n\n Google Sheets `);
                    
                    // 
                    await renderDrawMatches();
                } else {
                    alert(` \n\n: ${result.message}`);
                }
            } catch (error) {
                console.error('Error applying draw:', error);
                alert(` \n\n: ${error.message}`);
            }
        }

        // 
        async function getTeamsByCategory(categoryKey) {
            try {
                console.log('Getting teams for category:', categoryKey);
                
                //  Google Sheets
                const teamsData = await getTeamsData();
                
                // 
                const categoryTeams = teamsData
                    .filter(team => team.category === categoryKey)
                    .map(team => team.team_name);
                
                console.log(`Found ${categoryTeams.length} teams for category ${categoryKey}:`, categoryTeams);
                return categoryTeams;
                
            } catch (error) {
                console.error('Error getting teams by category:', error);
                throw new Error(' Google Sheets   URL  Google Apps Script');
            }
        }

        //  3 
        async function updateFinalsMatches(completedMatchId) {
            try {
                console.log('=== UPDATE FINALS MATCHES ===');
                console.log('Completed match ID:', completedMatchId);
                
                // 
                const completedMatch = await findMatchByIdFromSheets(completedMatchId);
                if (!completedMatch) {
                    console.log('Completed match not found');
                    return;
                }
                
                console.log('Completed match:', completedMatch);
                
                //  4 
                if (completedMatch.round !== ' 4 ') {
                    console.log('Not a quarter-final match, skipping finals update');
                    return;
                }
                
                //  4 
                const categoryData = await getCategoryData(completedMatch.category);
                const quarterFinals = categoryData.knockoutMatches.filter(m => {
                    const round = categoryData.knockoutMatches.length >= 4 && 
                                 categoryData.knockoutMatches.indexOf(m) < 4 ? ' 8 ' : ' 4 ';
                    return round === ' 4 ';
                });
                
                console.log('Quarter finals:', quarterFinals);
                
                //  4 
                const allQuarterFinalsCompleted = quarterFinals.every(match => match.completed);
                
                if (!allQuarterFinalsCompleted) {
                    console.log('Not all quarter finals completed yet');
                    return;
                }
                
                //  4 
                const winners = quarterFinals.filter(match => {
                    if (!match.completed) return false;
                    return match.sets1 > match.sets2;
                });
                
                const losers = quarterFinals.filter(match => {
                    if (!match.completed) return false;
                    return match.sets1 < match.sets2;
                });
                
                console.log('Winners:', winners);
                console.log('Losers:', losers);
                
                //  (2  4 )
                if (winners.length >= 2) {
                    const championshipMatch = categoryData.finals.find(m => m.type === 'championship');
                    if (championshipMatch) {
                        const championshipData = {
                            matchId: championshipMatch.id,
                            team1: winners[0].team1,
                            team2: winners[1].team1
                        };
                        
                        console.log('Updating championship match:', championshipData);
                        await updateMatchInSheets(championshipData);
                    }
                }
                
                //  3 (2  4 )
                if (losers.length >= 2) {
                    const thirdPlaceMatch = categoryData.finals.find(m => m.type === 'third_place');
                    if (thirdPlaceMatch) {
                        const thirdPlaceData = {
                            matchId: thirdPlaceMatch.id,
                            team1: losers[0].team1,
                            team2: losers[1].team1
                        };
                        
                        console.log('Updating third place match:', thirdPlaceData);
                        await updateMatchInSheets(thirdPlaceData);
                    }
                }
                
                console.log('Finals matches updated successfully');
                
            } catch (error) {
                console.error('Error updating finals matches:', error);
            }
        }

        // ===================== Settings System =====================
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1xtwqAxLOdKJknKxxYCNQ14Vm2inMIfuKg5Xddsy69rw/edit?usp=sharing';
        const GOOGLE_SHEETS_ID = '1xtwqAxLOdKJknKxxYCNQ14Vm2inMIfuKg5Xddsy69rw';
        
        // Google Apps Script Web App URL -  Deploy
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzDb84dpt5-VnRVb90ObvHnp8NkCdYl3KeeaSVWmn0-v_nc1ikG2maq0AswYFN7dz4PEw/exec';

        function generateSettingsContent() {
            return `
                <div class="settings-container">
                    <div class="settings-header">
                        <h3> </h3>
                        <p></p>
                    </div>
                    
                    <div class="settings-sections">
                        <!-- Data Management Section -->
                        <div class="settings-section">
                            <h4> </h4>
                            <div class="settings-actions">
                                <div class="action-group">
                                    <label>:</label>
                                    <button class="danger-btn" onclick="showResetModal('system')"> </button>
                                    <small> (: 567)</small>
                                </div>
                                <div class="action-group">
                                    <label>:</label>
                                    <button class="warning-btn" onclick="showResetModal('draw')"> </button>
                                    <small> (: 567)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Testing Section -->
                        <div class="settings-section">
                            <h4> </h4>
                            <div class="settings-actions">
                                <div class="action-group">
                                    <label> Google Sheets API:</label>
                                    <button class="btn" onclick="testGoogleSheetsAPI()">  Google Sheets API</button>
                                    <small> Google Sheets</small>
                                </div>
                                <div class="action-group">
                                    <label> Cache :</label>
                                    <button class="btn" onclick="clearCategoryCache()">  Cache </button>
                                    <small> Cache  Google Sheets</small>
                                </div>
                                <div class="action-group">
                                    <label>:</label>
                                    <button class="btn" onclick="checkForErrors()"> </button>
                                    <small></small>
                                </div>
                            </div>
                        </div>

                        <!-- Google Sheets Section -->
                        <div class="settings-section">
                            <h4> Google Sheets</h4>
                            <div class="sheets-info">
                                <div class="info-item">
                                    <label>Google Sheets URL:</label>
                                    <a href="${GOOGLE_SHEETS_URL}" target="_blank" class="sheets-link">${GOOGLE_SHEETS_URL}</a>
                                </div>
                                <div class="info-item">
                                    <label>Apps Script URL:</label>
                                    <div class="url-input-container">
                                        <input type="text" id="appsScriptUrl" class="url-input" 
                                               placeholder=" Web App URL  Apps Script" 
                                               value="${GOOGLE_APPS_SCRIPT_URL}">
                                        <button class="small-btn" onclick="updateAppsScriptUrl()"></button>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <label>:</label>
                                    <span id="sheetsStatus" class="status-indicator"> ...</span>
                                </div>
                            </div>
                            <div class="settings-actions">
                                <button class="primary-btn" onclick="testGoogleSheetsConnection()"> </button>
                                <button class="secondary-btn" onclick="openGoogleSheets()">  Google Sheets</button>
                                <button class="secondary-btn" onclick="showSetupInstructions()"> </button>
                            </div>
                        </div>

                        <!-- System Info Section -->
                        <div class="settings-section">
                            <h4> </h4>
                            <div class="system-info">
                                <div class="info-item">
                                    <label>:</label>
                                    <span>MN Tournament 2025 v1.0</span>
                                </div>
                                <div class="info-item">
                                    <label>:</label>
                                    <span id="dataStats">...</span>
                                </div>
                                <div class="info-item">
                                    <label>:</label>
                                    <span id="drawStats">...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reset Confirmation Modal -->
                <div class="modal" id="resetModal">
                    <div class="modal-content">
                        <h3 id="resetModalTitle"></h3>
                        <p id="resetModalMessage">?</p>
                        <div class="password-section">
                            <label for="resetPassword">:</label>
                            <input type="password" id="resetPassword" placeholder="" maxlength="3">
                        </div>
                        <div class="modal-buttons">
                            <button class="modal-btn btn-cancel" onclick="closeResetModal()"></button>
                            <button class="modal-btn btn-danger" onclick="confirmReset()"></button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showResetModal(type) {
            const modal = document.getElementById('resetModal');
            const title = document.getElementById('resetModalTitle');
            const message = document.getElementById('resetModalMessage');
            
            if (type === 'system') {
                title.textContent = ' ';
                message.textContent = ' ';
            } else if (type === 'draw') {
                title.textContent = ' ';
                message.textContent = '';
            }
            
            modal.dataset.resetType = type;
            modal.style.display = 'block';
            document.getElementById('resetPassword').focus();
        }

        function closeResetModal() {
            document.getElementById('resetModal').style.display = 'none';
            document.getElementById('resetPassword').value = '';
        }

        function confirmReset() {
            const password = document.getElementById('resetPassword').value;
            const resetType = document.getElementById('resetModal').dataset.resetType;
            
            if (password !== '567') {
                alert('');
                return;
            }
            
            if (resetType === 'system') {
                resetAllSystem();
            } else if (resetType === 'draw') {
                resetDrawSystem();
            }
            
            closeResetModal();
        }

        function resetAllSystem() {
            if (confirm(' ?\n\n!')) {
                // Clear all localStorage data
                localStorage.clear();
                
                // Reset global variables
                drawOverrides = {};
                drawHistory = [];
                currentAdminMatches = [];
                allMatchesData = null;
                
                alert(' \n\n');
                
                // Refresh the page to reset everything
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }

        function resetDrawSystem() {
            if (confirm(' ?\n\n!')) {
                // Clear only draw-related data
                localStorage.removeItem('mn_draw_overrides');
                localStorage.removeItem('mn_draw_history');
                
                // Reset draw variables
                drawOverrides = {};
                drawHistory = [];
                
                alert(' \n\n');
                
                // Refresh draw system if it's currently open
                if (document.getElementById('drawMatchesArea')) {
                    renderDrawMatches();
                }
            }
        }

        async function testGoogleSheetsConnection() {
            const statusElement = document.getElementById('sheetsStatus');
            statusElement.innerHTML = ' ...';
            
            try {
                //  URL 
                if (GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    statusElement.innerHTML = '  URL';
                    statusElement.className = 'status-indicator warning';
                    alert('  Google Apps Script URL !\n\n1. Deploy Google Apps Script  Web App\n2.  Web App URL\n3.  GOOGLE_APPS_SCRIPT_URL ');
                    return;
                }
                
                //  Google Apps Script
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    statusElement.innerHTML = ' ';
                    statusElement.className = 'status-indicator success';
                    alert('  Google Sheets !\n\n');
                } else {
                    throw new Error(result.message || 'Unknown error');
                }
                
            } catch (error) {
                console.error('Google Sheets connection test failed:', error);
                statusElement.innerHTML = ' ';
                statusElement.className = 'status-indicator error';
                alert(`  Google Sheets !\n\n: ${error.message}\n\n:\n1. Google Apps Script  Deploy \n2. URL \n3.  "Who has access: Anyone"`);
            }
        }

        function openGoogleSheets() {
            window.open(GOOGLE_SHEETS_URL, '_blank');
        }

        function updateAppsScriptUrl() {
            const urlInput = document.getElementById('appsScriptUrl');
            const newUrl = urlInput.value.trim();
            
            if (!newUrl) {
                alert(' Apps Script URL');
                return;
            }
            
            if (newUrl === 'YOUR_WEB_APP_URL_HERE') {
                alert(' URL  Google Apps Script');
                return;
            }
            
            //  URL  ()
            //  localStorage
            localStorage.setItem('mn_apps_script_url', newUrl);
            
            alert('  Apps Script URL !\n\n Refresh ');
        }

        function showSetupInstructions() {
            const instructions = `
  Google Apps Script:

1.  Google Sheets:
   ${GOOGLE_SHEETS_URL}

2.  Extensions > Apps Script

3. :
   google_apps_script.js

4.  Deploy > New deployment
   - Type: Web app
   - Execute as: Me
   - Who has access: Anyone

5.  Web App URL 

6.  ""

 :
- google_apps_script.js ( Apps Script)
- GOOGLE_APPS_SCRIPT_SETUP.md ()
            `;
            
            alert(instructions);
        }

        function updateDataStats() {
            const dataStats = document.getElementById('dataStats');
            const drawStats = document.getElementById('drawStats');
            
            if (dataStats) {
                const totalMatches = 159;
                const completedMatches = calculateCompletedMatches();
                dataStats.textContent = ` ${completedMatches}/${totalMatches} `;
            }
            
            if (drawStats) {
                const totalDraws = Object.keys(drawOverrides).length;
                const totalHistory = drawHistory.length;
                drawStats.textContent = ` ${totalDraws} ,  ${totalHistory} `;
            }
        }

        function calculateCompletedMatches() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', '', ''];
            let completed = 0;
            
            categories.forEach(category => {
                const categoryData = getCategoryData(category);
                
                // Count completed matches in groups
                categoryData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        if (match.completed) completed++;
                    });
                });
                
                // Count completed knockout matches
                categoryData.knockoutMatches.forEach(match => {
                    if (match.completed) completed++;
                });
                
                // Count completed finals
                categoryData.finals.forEach(match => {
                    if (match.completed) completed++;
                });
            });
            
            return completed;
        }

        function generateMatchTableRow(match) {
            const statusClass = match.completed ? 'completed' : 'pending';
            const roundText = match.group ? `${match.round} (${match.group})` : match.round;
            
            let scoreDisplay = '-';
            if (match.completed && match.score1 && match.score2) {
                const scores = match.score1.map((s1, i) => `${s1}-${match.score2[i]}`).join(', ');
                scoreDisplay = `${scores} (${match.sets1}-${match.sets2})`;
            }
            
            return `
                <tr class="match-row ${statusClass}">
                    <td class="match-category"> ${match.category}</td>
                    <td class="match-round">${roundText}</td>
                    <td class="team-name">${match.team1}</td>
                    <td class="team-name">${match.team2}</td>
                    <td class="match-score">${scoreDisplay}</td>
                </tr>
            `;
        }

        let allMatchesData = null; // 

        async function filterAllMatches() {
            if (!allMatchesData) {
                allMatchesData = await calculateAllMatchesStats();
            }
            
            const categoryFilter = document.getElementById('allMatchesCategoryFilter').value;
            const roundFilter = document.getElementById('allMatchesRoundFilter').value;
            const statusFilter = document.getElementById('allMatchesStatusFilter').value;
            
            let filteredMatches = allMatchesData.matches;
            
            if (categoryFilter) {
                filteredMatches = filteredMatches.filter(match => match.category === categoryFilter);
            }
            
            if (roundFilter) {
                filteredMatches = filteredMatches.filter(match => match.round === roundFilter);
            }
            
            if (statusFilter === 'completed') {
                filteredMatches = filteredMatches.filter(match => match.completed);
            } else if (statusFilter === 'pending') {
                filteredMatches = filteredMatches.filter(match => !match.completed);
            }
            
            document.getElementById('allMatchesTable').innerHTML = generateAllMatchesTable(filteredMatches);
            
            //  Progress Bar 
            //  
            if (!categoryFilter && !roundFilter) {
                updateProgressBar();
            } else {
                updateProgressBar(categoryFilter, roundFilter);
            }
        }

        // 
        async function testConnection() {
            try {
                console.log('Testing connection to:', GOOGLE_APPS_SCRIPT_URL);
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                const result = await response.json();
                console.log('Connection test result:', result);
                return result.status === 'success';
            } catch (error) {
                console.error('Connection test failed:', error);
                return false;
            }
        }

        async function refreshData() {
            console.log('=== REFRESH DEBUG START ===');
            console.log('Current category:', currentCategory);
            console.log('Google Apps Script URL:', GOOGLE_APPS_SCRIPT_URL);
            
            if (!currentCategory) {
                console.log('No category selected for refresh');
                alert(' ');
                return;
            }
            
            // 
            console.log('Testing connection...');
            const connectionOk = await testConnection();
            if (!connectionOk) {
                alert('  Google Apps Script \n\n:\n \n Google Apps Script URL\n  Web App');
                return;
            }
            console.log('Connection test passed');
            
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalContent = refreshBtn.innerHTML;
            
            try {
                // 
                refreshBtn.innerHTML = '';
                refreshBtn.disabled = true;
                refreshBtn.title = '...';
                refreshBtn.className = 'refresh-btn loading';
                
                // 
                console.log('Clearing cache for category:', currentCategory);
                clearCategoryCache(currentCategory);
                
                // 
                console.log('Refreshing data for category:', currentCategory);
                console.log('Calling loadCategory with fromRefresh=true');
                await loadCategory(currentCategory, true);
                console.log('loadCategory completed successfully');
                
                //  Progress Bar
                if (allMatchesData) {
                    allMatchesData = await calculateAllMatchesStats();
                    updateProgressBar();
                    // 
                    const allMatchesTable = document.getElementById('allMatchesTable');
                    if (allMatchesTable) {
                        filterAllMatches();
                    }
                }
                
                // 
                refreshBtn.innerHTML = '';
                refreshBtn.title = '!';
                refreshBtn.className = 'refresh-btn success';
                
                //  2 
                setTimeout(() => {
                    refreshBtn.innerHTML = originalContent;
                    refreshBtn.disabled = false;
                    refreshBtn.title = '';
                    refreshBtn.className = 'refresh-btn';
                }, 2000);
                
            } catch (error) {
                console.error('=== REFRESH ERROR ===');
                console.error('Error refreshing data:', error);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                
                // 
                refreshBtn.innerHTML = '';
                refreshBtn.title = '!';
                refreshBtn.className = 'refresh-btn error';
                
                // 
                let errorMessage = ' \n\n';
                if (error.message.includes('fetch')) {
                    errorMessage += ' \n';
                    errorMessage += '  Google Apps Script URL\n';
                } else if (error.message.includes('JSON')) {
                    errorMessage += ' \n';
                    errorMessage += '  Google Sheets\n';
                } else {
                    errorMessage += ` : ${error.message}\n`;
                }
                errorMessage += '\n';
                
                alert(errorMessage);
                
                //  3 
                setTimeout(() => {
                    refreshBtn.innerHTML = originalContent;
                    refreshBtn.disabled = false;
                    refreshBtn.title = '';
                    refreshBtn.className = 'refresh-btn';
                }, 3000);
            }
        }

        //  Progress Bar
        async function updateProgressBar(categoryFilter = '', roundFilter = '') {
            try {
                console.log('Updating progress bar...', { categoryFilter, roundFilter });
                
                if (!allMatchesData) {
                    allMatchesData = await calculateAllMatchesStats();
                }
                
                //  Admin Progress Bar
                const adminProgressFill = document.getElementById('adminProgressFill');
                const adminProgressText = document.getElementById('adminProgressText');
                
                if (adminProgressFill && adminProgressText) {
                    // Default:  ( )
                    if (!categoryFilter && !roundFilter) {
                        const completed = allMatchesData.completed;
                        const total = allMatchesData.total;
                        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                        
                        console.log(`Overall Progress (All Rounds): ${completed}/${total} (${percentage}%)`);
                        
                        adminProgressFill.style.width = `${percentage}%`;
                        adminProgressText.textContent = ` (): ${percentage}% (${completed}/${total} )`;
                    } else {
                        //  
                        let filteredMatches = allMatchesData.matches;
                        
                        if (categoryFilter) {
                            filteredMatches = filteredMatches.filter(match => match.category === categoryFilter);
                        }
                        
                        if (roundFilter) {
                            filteredMatches = filteredMatches.filter(match => match.round === roundFilter);
                        }
                        
                        const completed = filteredMatches.filter(match => match.completed).length;
                        const total = filteredMatches.length;
                        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                        
                        console.log(`Filtered Progress: ${completed}/${total} (${percentage}%)`);
                        
                        adminProgressFill.style.width = `${percentage}%`;
                        
                        // 
                        let progressText = `${percentage}% (${completed}/${total} )`;
                        if (categoryFilter && roundFilter) {
                            const categoryName = getCategoryName(categoryFilter);
                            progressText = ` ${categoryName} ${roundFilter}: ${progressText}`;
                        } else if (categoryFilter) {
                            const categoryName = getCategoryName(categoryFilter);
                            progressText = ` ${categoryName} (): ${progressText}`;
                        } else if (roundFilter) {
                            progressText = ` ${roundFilter}: ${progressText}`;
                        }
                        
                        adminProgressText.textContent = progressText;
                    }
                }
            } catch (error) {
                console.error('Error updating progress bar:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            //  Progress Bar 
            updateProgressBar();
            
            // 
            setTimeout(async () => {
                allMatchesData = await calculateAllMatchesStats();
                // 
                const allMatchesTable = document.getElementById('allMatchesTable');
                if (allMatchesTable) {
                    filterAllMatches();
                }
            }, 1000);
            
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });
            
            // Add event listener for reset password Enter key
            document.addEventListener('keypress', function(e) {
                if (e.target && e.target.id === 'resetPassword' && e.key === 'Enter') {
                    confirmReset();
                }
            });
            
            document.getElementById('adminModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAdminModal();
                }
            });
            
            document.getElementById('scoreModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeScoreModal();
                }
            });
            
            // Add event listener for reset modal
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'resetModal') {
                    closeResetModal();
                }
            });
            
        });
    </script>
</body>
</html>
</html>
