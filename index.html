<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MN Badminton Tournament 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 768px;
            }
            
            .header h1 {
                font-size: 28px;
            }
            
            .header .subtitle {
                font-size: 16px;
            }
            
            .admin-btn {
                top: 25px;
                right: 30px;
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .category-btn {
                padding: 20px;
            }
            
            .category-name {
                font-size: 18px;
            }
            
            .category-info {
                font-size: 14px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                max-width: 1024px;
            }
            
            .header {
                padding: 30px;
            }
            
            .nav-container {
                padding: 30px;
            }
            
            .content-area {
                padding: 30px;
            }
            
            .category-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
            
            .category-btn {
                padding: 24px;
            }
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .admin-btn {
            position: absolute;
            top: 50px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-container {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .nav-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .category-btn {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-btn.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-color: #0056b3;
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .category-info {
            font-size: 12px;
            opacity: 0.7;
        }

        .status-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .content-area {
            padding: 20px;
            min-height: 400px;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }

        .welcome-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .welcome-text {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bracket-container {
            padding: 0;
        }

        .bracket-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
        }

        .bracket-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .bracket-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            background: rgba(0, 123, 255, 0.1);
            color: #007bff;
        }

        .tab-btn.active {
            background: white;
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab-content {
            padding: 20px;
            min-height: 400px;
        }

        .groups-container {
            padding: 0;
            display: grid;
            gap: 20px;
        }

        .group-card {
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        .group-title {
            background: #343a40;
            color: white;
            padding: 12px 15px;
            font-weight: 600;
            text-align: center;
        }

        .standings-table {
            background: white;
        }

        .table-header {
            display: grid;
            grid-template-columns: 40px 1fr 40px 40px 50px;
            gap: 10px;
            padding: 10px 15px;
            background: #e9ecef;
            font-weight: 600;
            font-size: 12px;
            color: #495057;
        }

        .team-row {
            display: grid;
            grid-template-columns: 40px 1fr 40px 40px 50px;
            gap: 10px;
            padding: 12px 15px;
            border-bottom: 1px solid #f1f3f4;
            align-items: center;
        }

        .team-row.qualified {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }

        .rank {
            font-weight: 600;
            color: #666;
        }

        .team-name {
            font-size: 14px;
            color: #333;
        }

        .points {
            font-weight: 600;
            color: #007bff;
        }

        .round-robin-matches {
            padding: 20px 0;
            border-top: 1px solid #e9ecef;
            background: #fafafa;
            margin: -20px;
            margin-top: 20px;
        }

        .matches-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 0 20px 15px 20px;
        }

        .group-matches {
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .group-matches-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #343a40;
            color: white;
            border-radius: 6px;
            text-align: center;
        }

        .round-robin-match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .round-robin-match-card.completed {
            border-color: #28a745;
        }

        .rr-match-header {
            background: #f8f9fa;
            padding: 6px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #666;
        }

        .round-robin-match-card.completed .rr-match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .rr-match-teams {
            padding: 12px;
        }

        .rr-team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .rr-team:last-child {
            border-bottom: none;
        }

        .rr-team-name {
            font-size: 13px;
            color: #333;
            flex: 1;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .set-score {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .set-score.set-win {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .total-sets {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            margin-left: 2px;
        }

        .total-sets.match-win {
            background: #28a745;
            color: white;
        }

        .rr-vs {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 3px 0;
            font-size: 10px;
        }

        .knockout-section {
            padding: 20px 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .matches-grid {
            display: grid;
            gap: 10px;
        }

        .match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .match-card.completed {
            border-color: #28a745;
        }

        .match-card.pending {
            border-color: #ffc107;
        }

        .match-header {
            background: #f8f9fa;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #666;
        }

        .match-card.completed .match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .match-teams {
            padding: 15px;
        }

        .team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .team:last-child {
            border-bottom: none;
        }

        .team-score {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .team-score.winner {
            background: #d4edda;
            color: #155724;
        }

        .vs {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 5px 0;
            font-size: 12px;
        }

        .finals-section {
            padding: 20px 0;
        }

        .finals-container {
            display: grid;
            gap: 20px;
        }

        .final-match {
            text-align: center;
        }

        .match-label {
            background: #343a40;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .championship .match-label {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #333;
        }

        .third-place .match-label {
            background: #cd7f32;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .password-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-login {
            background: #007bff;
            color: white;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .refresh-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        .refresh-btn {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .refresh-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.4);
        }

        .refresh-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
        }

        .refresh-btn.loading {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            animation: pulse 1s infinite;
        }

        .refresh-btn.success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .refresh-btn.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }

        .nav-tab-btn {
            flex: 1;
            padding: 10px 15px;
            background: none;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab-btn.active {
            background: white;
            color: #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-view {
            transition: all 0.3s ease;
        }

        .team-search-container {
            padding: 10px 0;
        }

        .team-search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .team-search-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .team-search-results {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .team-result-item {
            padding: 12px 16px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .team-result-item:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }

        .team-result-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .team-result-info {
            font-size: 12px;
            color: #666;
        }

        .team-matches-container {
            padding: 20px;
        }

        .team-matches-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
            border-radius: 12px 12px 0 0;
        }

        .team-matches-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .team-matches-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .team-match-section {
            margin-bottom: 25px;
        }

        .team-match-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .admin-container {
            padding: 0;
        }

        .admin-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin: -20px -20px 20px -20px;
            position: relative;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .admin-stats {
            font-size: 14px;
            opacity: 0.9;
        }

        .admin-logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .admin-tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-tabs-nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .admin-tab-btn {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .admin-tab-btn:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .admin-tab-btn.active {
            background: white;
            color: #dc3545;
            border-bottom-color: #dc3545;
        }

        .admin-tab-content {
            padding: 20px;
            min-height: 400px;
        }

        .admin-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 16px;
        }

        /* Settings Styles */
        .settings-container {
            padding: 20px;
        }

        .settings-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .settings-header h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .settings-section h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        .settings-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .action-group label {
            font-weight: 600;
            color: #333;
        }

        .action-group small {
            color: #666;
            font-size: 12px;
        }

        .danger-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 200px;
        }

        .danger-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .warning-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 200px;
        }

        .warning-btn:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .primary-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .primary-btn:hover {
            background: #0056b3;
        }

        .secondary-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            background: #545b62;
        }

        .sheets-info, .system-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-item label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }

        .sheets-link {
            color: #007bff;
            text-decoration: none;
            word-break: break-all;
            font-size: 12px;
        }

        .sheets-link:hover {
            text-decoration: underline;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-indicator.success {
            background: #d4edda;
            color: #155724;
        }

        .password-section {
            margin: 20px 0;
        }

        .password-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .password-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .url-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .url-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            font-family: monospace;
        }

        .url-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .small-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }

        .small-btn:hover {
            background: #218838;
        }

        .status-indicator.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-indicator.error {
            background: #f8d7da;
            color: #721c24;
        }

        .error {
            padding: 20px;
            background: #f8d7da;
            color: #721c24;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .match-management-container {
            padding: 0;
        }

        .match-management-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .match-management-header h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 8px;
        }

        .match-management-header p {
            color: #666;
            margin: 0;
        }

        .category-selector {
            margin-bottom: 25px;
        }

        .selectors-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .round-selector {
            margin-bottom: 0;
        }

        .category-selector label,
        .round-selector label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .team-search-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .team-search-section label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .admin-search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .admin-search-input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .admin-search-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .clear-search-btn {
            position: absolute;
            right: 12px;
            background: #6c757d;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .clear-search-btn:hover {
            opacity: 1;
        }

        .search-hint {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }

        .search-no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .no-results-text {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .no-results-hint {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
        }

        .admin-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .admin-select:focus {
            outline: none;
            border-color: #dc3545;
        }

        .admin-matches-list {
            border: 2px solid #f1f3f4;
            border-radius: 8px;
            min-height: 300px;
        }

        .no-selection {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #666;
            font-style: italic;
        }

        .all-matches-container {
            padding: 0;
        }

        .all-matches-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .all-matches-header h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
        }

        .matches-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .summary-label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .summary-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .all-matches-content {
            background: #f8f9fa;
            padding: 40px 20px;
            border-radius: 8px;
            text-align: center;
            color: #666;
        }

        .all-matches-filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .matches-table-container {
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            overflow: hidden;
        }

        .matches-table-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .table-stats {
            font-weight: 600;
            color: #495057;
        }

        .matches-table-scroll {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .matches-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .matches-table th {
            background: #343a40;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .matches-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .match-row.completed {
            background: rgba(40, 167, 69, 0.05);
        }

        .match-row.pending {
            background: rgba(255, 193, 7, 0.05);
        }

        .match-id {
            font-weight: 700;
            color: #007bff;
        }

        .match-category {
            font-weight: 600;
        }

        .match-round {
            color: #666;
            font-size: 12px;
        }

        .team-name {
            font-weight: 500;
        }

        .match-score {
            font-family: monospace;
            font-size: 12px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .table-btn-record {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }

        .table-btn-edit {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }

        .table-btn-record:hover {
            background: #218838;
        }

        .table-btn-edit:hover {
            background: #e0a800;
        }

        /* Tablet and Desktop Responsive Styles */
        @media (min-width: 768px) {
            .selectors-container {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 30px;
            }
            
            .admin-tabs-nav {
                flex-wrap: wrap;
            }
            
            .admin-tab-btn {
                padding: 18px 15px;
                font-size: 14px;
            }
            
            .admin-matches-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .all-matches-filters {
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
            }
            
            .matches-table {
                font-size: 15px;
            }
            
            .matches-table th,
            .matches-table td {
                padding: 15px 12px;
            }
            
            .score-modal-content {
                max-width: 600px;
            }
            
            .sets-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .admin-container {
                padding: 0;
            }
            
            .admin-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .admin-tab-content {
                padding: 30px;
            }
            
            .admin-matches-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .matches-table-scroll {
                max-height: 500px;
            }
            
            .all-matches-filters {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .score-modal-content {
                max-width: 700px;
            }
        }

        /* Team Search and Matches Responsive */
        @media (min-width: 768px) {
            .team-search-results {
                max-height: 250px;
            }
            
            .team-result-item {
                padding: 15px 20px;
            }
            
            .team-matches-container {
                padding: 0;
            }
            
            .team-matches-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .team-match-section {
                margin-bottom: 30px;
            }
            
            .match-card {
                margin-bottom: 12px;
            }
            
            .round-robin-match-card {
                margin-bottom: 10px;
            }
        }

        @media (min-width: 1024px) {
            .team-search-input {
                font-size: 18px;
                padding: 15px 20px;
            }
            
            .team-result-item {
                padding: 18px 24px;
            }
            
            .team-result-name {
                font-size: 16px;
            }
            
            .team-result-info {
                font-size: 14px;
            }
            
            .matches-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        /* Bracket Display Responsive */
        @media (min-width: 768px) {
            .bracket-header {
                padding: 30px;
                margin: -30px -30px 30px -30px;
            }
            
            .bracket-title {
                font-size: 28px;
            }
            
            .bracket-stats {
                font-size: 16px;
            }
            
            .tabs-nav {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                padding: 18px 15px;
                font-size: 15px;
            }
            
            .tab-content {
                padding: 30px;
            }
            
            .groups-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
            
            .standings-table {
                font-size: 15px;
            }
            
            .team-row {
                padding: 15px;
            }
        }

        @media (min-width: 1024px) {
            .groups-container {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
            
            .finals-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 30px;
            }
            
            .knockout-section .matches-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile Landscape Orientation */
        @media (max-width: 767px) and (orientation: landscape) {
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .header .subtitle {
                font-size: 12px;
            }
            
            .admin-btn {
                top: 15px;
                right: 20px;
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .nav-container {
                padding: 15px 20px;
            }
            
            .nav-title {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .category-btn {
                padding: 12px;
            }
            
            .category-name {
                font-size: 14px;
            }
            
            .category-info {
                font-size: 11px;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .bracket-header {
                padding: 15px;
                margin: -15px -15px 15px -15px;
            }
            
            .bracket-title {
                font-size: 20px;
            }
            
            .bracket-stats {
                font-size: 12px;
            }
            
            .tab-btn {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .admin-header {
                padding: 15px;
                margin: -15px -15px 15px -15px;
            }
            
            .admin-title {
                font-size: 20px;
            }
            
            .admin-stats {
                font-size: 12px;
            }
            
            .admin-tab-btn {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .admin-tab-content {
                padding: 15px;
            }
            
            .selectors-container {
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .admin-select {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .team-search-input {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .matches-table {
                font-size: 12px;
            }
            
            .matches-table th,
            .matches-table td {
                padding: 8px 6px;
            }
            
            .match-id {
                font-size: 11px;
            }
            
            .team-name {
                font-size: 12px;
            }
            
            .match-score {
                font-size: 10px;
            }
            
            .table-btn-record,
            .table-btn-edit {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .score-modal-content {
                width: 98%;
                max-width: none;
                margin: 1%;
            }
            
            .sets-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .set-column h4 {
                font-size: 12px;
            }
            
            .score-input {
                width: 50px;
                padding: 6px;
                font-size: 14px;
            }
        }

        .admin-matches-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .admin-matches-header h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 18px;
        }

        .matches-stats {
            font-size: 14px;
            color: #666;
        }

        .admin-matches-grid {
            padding: 20px;
            display: grid;
            gap: 15px;
        }

        .admin-match-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .admin-match-card.completed {
            border-color: #28a745;
        }

        .admin-match-card.pending {
            border-color: #ffc107;
        }

        .admin-match-header {
            background: #f8f9fa;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .admin-match-card.completed .admin-match-header {
            background: rgba(40, 167, 69, 0.1);
        }

        .admin-match-card.pending .admin-match-header {
            background: rgba(255, 193, 7, 0.1);
        }

        .match-id {
            font-weight: 700;
            color: #333;
        }

        .match-round {
            color: #666;
        }

        .match-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .match-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .match-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .admin-match-teams {
            padding: 15px;
        }

        .admin-team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .team-score-display {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .score-badge {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .sets-badge {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            margin-left: 2px;
        }

        .score-placeholder {
            color: #999;
            font-style: italic;
            font-size: 12px;
        }

        .vs-divider {
            text-align: center;
            font-weight: 600;
            color: #666;
            padding: 5px 0;
            font-size: 12px;
        }

        .admin-match-actions {
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .admin-btn-record {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .admin-btn-record:hover {
            background: #218838;
        }

        .admin-btn-edit {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .admin-btn-edit:hover {
            background: #e0a800;
        }

        .score-modal-content {
            max-width: 500px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .score-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .score-modal-header h3 {
            margin: 0;
            color: #333;
        }

        .modal-close-btn {
            background: #6c757d;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .match-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .match-id-display {
            font-size: 18px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 8px;
        }

        .match-teams-display {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .vs-text {
            margin: 0 10px;
            color: #666;
        }

        .match-round-display {
            font-size: 14px;
            color: #666;
        }

        .score-form {
            margin-bottom: 20px;
        }

        .sets-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .set-column {
            text-align: center;
        }

        .set-column h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .score-inputs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
        }

        .score-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .score-divider {
            font-weight: 600;
            color: #666;
        }

        .score-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .sets-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .team-sets {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sets-count {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .sets-vs {
            color: #666;
            font-weight: 600;
        }

        .winner-display {
            text-align: center;
            font-weight: 600;
            padding: 8px;
            border-radius: 6px;
            background: #e9ecef;
            color: #495057;
        }

        .winner-display.has-winner {
            background: #d4edda;
            color: #155724;
        }

        .shuttlecock-cost {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .shuttlecock-cost label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .shuttlecock-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .shuttlecock-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #ffc107;
            border-radius: 6px;
            text-align: center;
            font-size: 16px;
        }

        .cost-display {
            color: #856404;
            font-weight: 600;
        }

        .score-modal-footer {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 2px solid #f1f3f4;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="admin-btn" onclick="openAdminModal()">👤 Admin</button>
            <h1>🏸 MN Badminton Tournament</h1>
            <div class="subtitle">77 ทีม • 7 ประเภท • 159 แมท</div>
        </div>

        <div class="nav-container">
            <div class="nav-title">เลือกประเภทการแข่งขัน</div>
            <div class="nav-tabs">
                <button class="nav-tab-btn active" onclick="showCategoryView()">🏆 ประเภท</button>
                <button class="nav-tab-btn" onclick="showTeamSearchView()">🔍 ค้นหาทีม</button>
            </div>
            <div id="categoryView" class="nav-view">
                <div class="category-grid">
                    <div class="category-btn" onclick="loadCategory('A')">
                        <div class="category-name">มือ A</div>
                        <div class="category-info">6 ทีม • 2 สาย</div>
                        <div class="status-badge">6</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('B')">
                        <div class="category-name">มือ B</div>
                        <div class="category-info">12 ทีม • 4 สาย</div>
                        <div class="status-badge">12</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('C-B')">
                        <div class="category-name">มือ C-B</div>
                        <div class="category-info">17 ทีม • 4 สาย</div>
                        <div class="status-badge">17</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('C-C')">
                        <div class="category-name">มือ C-C</div>
                        <div class="category-info">11 ทีม • 2 สาย</div>
                        <div class="status-badge">11</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('D')">
                        <div class="category-name">มือ D</div>
                        <div class="category-info">10 ทีม • 2 สาย</div>
                        <div class="status-badge">10</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('ใหม่')">
                        <div class="category-name">มือใหม่</div>
                        <div class="category-info">9 ทีม • 2 สาย</div>
                        <div class="status-badge">9</div>
                    </div>
                    
                    <div class="category-btn" onclick="loadCategory('ผสม')" style="grid-column: 1 / -1;">
                        <div class="category-name">มือผสม</div>
                        <div class="category-info">12 ทีม • 4 สาย</div>
                        <div class="status-badge">12</div>
                    </div>
                </div>
            </div>
            <div id="teamSearchView" class="nav-view" style="display: none;">
                <div class="team-search-container">
                    <input type="text" id="teamSearchInput" class="team-search-input" placeholder="พิมพ์ชื่อทีม (เช่น เอก-ชัย)" oninput="searchTeams()">
                    <div id="teamSearchResults" class="team-search-results"></div>
                </div>
            </div>
        </div>

        <div class="content-area" id="contentArea">
            <div class="welcome-screen">
                <div class="welcome-icon">🏸</div>
                <div class="welcome-title">ยินดีต้อนรับสู่การแข่งขัน</div>
                <div class="welcome-text">
                    เลือกประเภทการแข่งขันด้านบนเพื่อดูผลการแข่งขันและตารางการแข่งขัน
                    <br><br>
                    📱 แอปนี้ออกแบบมาเพื่อการใช้งานบนมือถือ
                </div>
            </div>
        </div>

        <div class="refresh-container">
            <button class="refresh-btn" onclick="refreshData()" title="รีเฟรชข้อมูล">🔄</button>
        </div>
    </div>

    <div class="modal" id="adminModal">
        <div class="modal-content">
            <h3>🔒 เข้าสู่ระบบ Admin</h3>
            <input type="password" class="password-input" id="adminPassword" placeholder="รหัสผ่าน Admin" maxlength="3">
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" onclick="closeAdminModal()">ยกเลิก</button>
                <button class="modal-btn btn-login" onclick="adminLogin()">เข้าสู่ระบบ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="scoreModal">
        <div class="modal-content score-modal-content">
            <div class="score-modal-header">
                <h3 id="scoreModalTitle">📝 บันทึกผลการแข่งขัน</h3>
                <button class="modal-close-btn" onclick="closeScoreModal()">✕</button>
            </div>
            <div class="score-modal-body">
                <div class="match-info">
                    <div class="match-id-display" id="matchIdDisplay">M001</div>
                    <div class="match-teams-display">
                        <span id="team1Display">ทีม 1</span>
                        <span class="vs-text">VS</span>
                        <span id="team2Display">ทีม 2</span>
                    </div>
                    <div class="match-round-display" id="matchRoundDisplay">รอบแรก</div>
                </div>
                
                <div class="score-form">
                    <div class="sets-grid">
                        <div class="set-column">
                            <h4>เซ็ต 1</h4>
                            <div class="score-inputs">
                                <input type="number" id="set1Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set1Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                        <div class="set-column">
                            <h4>เซ็ต 2</h4>
                            <div class="score-inputs">
                                <input type="number" id="set2Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set2Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                        <div class="set-column">
                            <h4>เซ็ต 3</h4>
                            <div class="score-inputs">
                                <input type="number" id="set3Team1" class="score-input" min="0" max="30" placeholder="0">
                                <span class="score-divider">-</span>
                                <input type="number" id="set3Team2" class="score-input" min="0" max="30" placeholder="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="score-summary">
                        <div class="sets-summary">
                            <div class="team-sets">
                                <span id="team1Name">ทีม 1</span>
                                <span class="sets-count" id="team1Sets">0</span>
                            </div>
                            <div class="sets-vs">เซ็ต</div>
                            <div class="team-sets">
                                <span class="sets-count" id="team2Sets">0</span>
                                <span id="team2Name">ทีม 2</span>
                            </div>
                        </div>
                        <div class="winner-display" id="winnerDisplay"></div>
                    </div>

                    <div class="shuttlecock-cost">
                        <label for="shuttlecockCount">จำนวนลูกแบด:</label>
                        <div class="shuttlecock-input-group">
                            <input type="number" id="shuttlecockCount" class="shuttlecock-input" min="0" value="1">
                            <span class="cost-display">ค่าใช้จ่าย: <span id="totalCost">40</span> บาท/ทีม</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="score-modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeScoreModal()">ยกเลิก</button>
                <button class="modal-btn btn-save" onclick="saveMatchScore()">บันทึกผล</button>
            </div>
        </div>
    </div>

    <script>
        let currentCategory = null;
        let isAdminMode = false;
        let allTeams = []; // เก็บข้อมูลทีมทั้งหมด
        
        // Initialize global variables
        window.currentEditMatch = null;
        let currentAdminMatches = []; // เก็บแมททั้งหมดของประเภทที่เลือก

        // สร้างรายการทีมทั้งหมดจากข้อมูล mock
        function initializeTeamsList() {
            allTeams = [];
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            
            categories.forEach(category => {
                const categoryData = getCategoryData(category);
                if (categoryData.groups) {
                    categoryData.groups.forEach(group => {
                        group.teams.forEach(team => {
                            allTeams.push({
                                name: team.name,
                                category: category,
                                group: group.name,
                                rank: team.rank,
                                points: team.points,
                                qualified: team.qualified
                            });
                        });
                    });
                }
            });
        }

        function showCategoryView() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.nav-tab-btn').classList.add('active');
            
            document.getElementById('categoryView').style.display = 'block';
            document.getElementById('teamSearchView').style.display = 'none';
        }

        function showTeamSearchView() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.nav-tab-btn')[1].classList.add('active');
            
            document.getElementById('categoryView').style.display = 'none';
            document.getElementById('teamSearchView').style.display = 'block';
            
            // Reset content area to welcome screen
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="welcome-screen">
                    <div class="welcome-icon">🔍</div>
                    <div class="welcome-title">ค้นหาทีมที่ต้องการ</div>
                    <div class="welcome-text">
                        พิมพ์ชื่อทีมในช่องค้นหาด้านบนเพื่อดูผลการแข่งขันและตารางแมทของทีมนั้น
                        <br><br>
                        📋 แสดงแมทจากรอบแรกจนถึงชิงชนะเลิศ<br>
                        📊 แสดงสถิติการแข่งขันของทีม
                    </div>
                </div>
            `;
            
            // Initialize teams list if not done
            if (allTeams.length === 0) {
                initializeTeamsList();
            }
        }

        function searchTeams() {
            const searchTerm = document.getElementById('teamSearchInput').value.toLowerCase().trim();
            const resultsContainer = document.getElementById('teamSearchResults');
            
            if (searchTerm.length < 2) {
                resultsContainer.innerHTML = '';
                return;
            }
            
            const filteredTeams = allTeams.filter(team => 
                team.name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredTeams.length === 0) {
                resultsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">ไม่พบทีมที่ค้นหา</div>';
                return;
            }
            
            resultsContainer.innerHTML = filteredTeams.map(team => `
                <div class="team-result-item" onclick="showTeamMatches('${team.name}', '${team.category}')">
                    <div class="team-result-name">${team.name}</div>
                    <div class="team-result-info">มือ ${team.category} • ${team.group} • อันดับ ${team.rank} • ${team.points} คะแนน ${team.qualified ? '• เข้ารอบ' : ''}</div>
                </div>
            `).join('');
        }

        function showTeamMatches(teamName, category) {
            const categoryData = getCategoryData(category);
            const teamMatches = [];
            
            // หาแมทจากรอบแรก
            categoryData.groups.forEach(group => {
                if (group.matches) {
                    group.matches.forEach(match => {
                        if (match.team1 === teamName || match.team2 === teamName) {
                            teamMatches.push({
                                ...match,
                                round: 'รอบแรก',
                                group: group.name
                            });
                        }
                    });
                }
            });
            
            // หาแมทจากน็อกเอาท์
            categoryData.knockoutMatches.forEach(match => {
                if (match.team1 === teamName || match.team2 === teamName) {
                    teamMatches.push({
                        ...match,
                        round: 'น็อกเอาท์',
                        group: null
                    });
                }
            });
            
            // หาแมทจากชิงชนะเลิศ
            categoryData.finals.forEach(match => {
                if (match.team1 === teamName || match.team2 === teamName) {
                    teamMatches.push({
                        ...match,
                        round: match.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3',
                        group: null
                    });
                }
            });
            
            // นับสถิติ
            const totalMatches = teamMatches.length;
            const completedMatches = teamMatches.filter(m => m.completed).length;
            const wins = teamMatches.filter(m => {
                if (!m.completed) return false;
                return (m.team1 === teamName && m.sets1 > m.sets2) || 
                       (m.team2 === teamName && m.sets2 > m.sets1);
            }).length;
            
            // แสดงผล
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="team-matches-container">
                    <div class="team-matches-header">
                        <h2 class="team-matches-title">${teamName}</h2>
                        <div class="team-matches-stats">มือ ${category} • ${totalMatches} แมท • ชนะ ${wins} แมท • เสร็จแล้ว ${completedMatches}/${totalMatches}</div>
                    </div>
                    ${generateTeamMatchesContent(teamMatches, teamName)}
                </div>
            `;
        }

        function generateTeamMatchesContent(matches, teamName) {
            const groupedMatches = {};
            
            matches.forEach(match => {
                const roundKey = match.round + (match.group ? ` (${match.group})` : '');
                if (!groupedMatches[roundKey]) {
                    groupedMatches[roundKey] = [];
                }
                groupedMatches[roundKey].push(match);
            });
            
            let content = '';
            
            Object.keys(groupedMatches).forEach(roundKey => {
                content += `
                    <div class="team-match-section">
                        <div class="team-match-section-title">${roundKey}</div>
                        <div class="matches-grid">`;
                        
                groupedMatches[roundKey].forEach(match => {
                    const isTeam1 = match.team1 === teamName;
                    const opponent = isTeam1 ? match.team2 : match.team1;
                    const teamSets = isTeam1 ? match.sets1 : match.sets2;
                    const opponentSets = isTeam1 ? match.sets2 : match.sets1;
                    const teamScore = isTeam1 ? match.score1 : match.score2;
                    const opponentScore = isTeam1 ? match.score2 : match.score1;
                    
                    const isWinner = match.completed && teamSets > opponentSets;
                    const isLoser = match.completed && teamSets < opponentSets;
                    
                    content += `
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? (isWinner ? 'ชนะ' : 'แพ้') : 'รอการแข่งขัน'}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team" style="${isTeam1 ? 'background: rgba(0, 123, 255, 0.1);' : ''}">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score1 && match.score1.length > 0) {
                        match.score1.forEach((score, index) => {
                            const isWin = match.score2[index] && score > match.score2[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team" style="${!isTeam1 ? 'background: rgba(0, 123, 255, 0.1);' : ''}">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score2 && match.score2.length > 0) {
                        match.score2.forEach((score, index) => {
                            const isWin = match.score1[index] && score > match.score1[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                
                content += '</div></div>';
            });
            
            return content;
        }

        function loadAdminMatches() {
            const category = document.getElementById('adminCategorySelect').value;
            const matchesList = document.getElementById('adminMatchesList');
            
            if (!category) {
                matchesList.innerHTML = '<div class="no-selection">เลือกประเภทการแข่งขันเพื่อดูรายการแมท</div>';
                currentAdminMatches = [];
                return;
            }
            
            const categoryData = getCategoryData(category);
            currentAdminMatches = [];
            
            // รวบรวมแมทรอบแรก
            categoryData.groups.forEach(group => {
                group.matches.forEach(match => {
                    currentAdminMatches.push({
                        ...match,
                        round: 'รอบแรก',
                        group: group.name
                    });
                });
            });
            
            // รวบรวมแมทน็อกเอาท์ - แยกเป็นรอบ 8 ทีม และ 4 ทีม
            categoryData.knockoutMatches.forEach((match, index) => {
                let roundName = 'รอบ 8 ทีม';
                
                // กำหนดรอบตามจำนวนแมทและลำดับ
                const totalKnockout = categoryData.knockoutMatches.length;
                if (totalKnockout >= 4) {
                    // ถ้ามี 4 แมทขึ้นไป แมท 4 อันแรกเป็นรอบ 8 ทีม
                    if (index >= 4) {
                        roundName = 'รอบ 4 ทีม';
                    }
                } else {
                    // ถ้าน้อยกว่า 4 แมท เป็นรอบ 4 ทีม
                    roundName = 'รอบ 4 ทีม';
                }
                
                currentAdminMatches.push({
                    ...match,
                    round: roundName,
                    group: null
                });
            });
            
            // รวบรวมแมทชิงชนะเลิศ
            categoryData.finals.forEach(match => {
                currentAdminMatches.push({
                    ...match,
                    round: match.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3',
                    group: null
                });
            });
            
            // Reset round selector
            document.getElementById('adminRoundSelect').value = '';
            
            // แสดงรายการแมททั้งหมด
            displayFilteredMatches(currentAdminMatches, category);
        }

        function filterMatchesByRound() {
            const selectedRound = document.getElementById('adminRoundSelect').value;
            const category = document.getElementById('adminCategorySelect').value;
            
            if (!category || currentAdminMatches.length === 0) {
                return;
            }
            
            let filteredMatches = currentAdminMatches;
            
            if (selectedRound) {
                filteredMatches = currentAdminMatches.filter(match => match.round === selectedRound);
            }
            
            displayFilteredMatches(filteredMatches, category);
        }

        function searchAdminMatches() {
            const searchTerm = document.getElementById('adminTeamSearch').value.toLowerCase().trim();
            
            if (searchTerm.length === 0) {
                // ถ้าไม่มีการค้นหา แสดงตาม dropdown ที่เลือกไว้
                const category = document.getElementById('adminCategorySelect').value;
                if (category) {
                    loadAdminMatches();
                } else {
                    document.getElementById('adminMatchesList').innerHTML = '<div class="no-selection">เลือกประเภทการแข่งขันหรือค้นหาชื่อทีมเพื่อดูรายการแมท</div>';
                }
                return;
            }
            
            if (searchTerm.length < 2) {
                return;
            }
            
            // ค้นหาแมทจากทุกประเภท
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            let searchResults = [];
            
            categories.forEach(category => {
                const categoryData = getCategoryData(category);
                
                // ค้นหาจากรอบแรก
                categoryData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        if (match.team1.toLowerCase().includes(searchTerm) || 
                            match.team2.toLowerCase().includes(searchTerm)) {
                            searchResults.push({
                                ...match,
                                category,
                                round: 'รอบแรก',
                                group: group.name
                            });
                        }
                    });
                });
                
                // ค้นหาจากรอบน็อกเอาท์
                categoryData.knockoutMatches.forEach((match, index) => {
                    if (match.team1.toLowerCase().includes(searchTerm) || 
                        match.team2.toLowerCase().includes(searchTerm)) {
                        const totalKnockout = categoryData.knockoutMatches.length;
                        let roundName = 'รอบ 8 ทีม';
                        
                        if (totalKnockout >= 4) {
                            if (index >= 4) {
                                roundName = 'รอบ 4 ทีม';
                            }
                        } else {
                            roundName = 'รอบ 4 ทีม';
                        }
                        
                        searchResults.push({
                            ...match,
                            category,
                            round: roundName,
                            group: null
                        });
                    }
                });
                
                // ค้นหาจากรอบชิงชนะเลิศ
                categoryData.finals.forEach(match => {
                    if (match.team1.toLowerCase().includes(searchTerm) || 
                        match.team2.toLowerCase().includes(searchTerm)) {
                        searchResults.push({
                            ...match,
                            category,
                            round: match.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3',
                            group: null
                        });
                    }
                });
            });
            
            // แสดงผลการค้นหา
            if (searchResults.length === 0) {
                document.getElementById('adminMatchesList').innerHTML = `
                    <div class="search-no-results">
                        <div class="no-results-icon">🔍</div>
                        <div class="no-results-text">ไม่พบแมทที่มีทีม "${document.getElementById('adminTeamSearch').value}"</div>
                        <div class="no-results-hint">ลองค้นหาด้วยชื่อที่สั้นกว่า เช่น "เอก" หรือ "ชัย"</div>
                    </div>
                `;
            } else {
                // เรียงตาม Match ID
                searchResults.sort((a, b) => a.id.localeCompare(b.id));
                
                document.getElementById('adminMatchesList').innerHTML = `
                    <div class="admin-matches-header">
                        <h4>ผลการค้นหา "${document.getElementById('adminTeamSearch').value}"</h4>
                        <div class="matches-stats">
                            พบ ${searchResults.length} แมท • 
                            เสร็จแล้ว ${searchResults.filter(m => m.completed).length} แมท • 
                            คงเหลือ ${searchResults.filter(m => !m.completed).length} แมท
                        </div>
                    </div>
                    <div class="admin-matches-grid">
                        ${searchResults.map(match => generateAdminMatchCard(match)).join('')}
                    </div>
                `;
            }
        }

        function clearAdminSearch() {
            document.getElementById('adminTeamSearch').value = '';
            
            // กลับไปแสดงตาม dropdown ที่เลือกไว้
            const category = document.getElementById('adminCategorySelect').value;
            if (category) {
                loadAdminMatches();
            } else {
                document.getElementById('adminMatchesList').innerHTML = '<div class="no-selection">เลือกประเภทการแข่งขันหรือค้นหาชื่อทีมเพื่อดูรายการแมท</div>';
            }
        }

        function displayFilteredMatches(matches, category) {
            const matchesList = document.getElementById('adminMatchesList');
            
            const completedCount = matches.filter(m => m.completed).length;
            const pendingCount = matches.filter(m => !m.completed).length;
            
            matchesList.innerHTML = `
                <div class="admin-matches-header">
                    <h4>รายการแมท มือ ${category}</h4>
                    <div class="matches-stats">
                        แสดง ${matches.length} แมท • 
                        เสร็จแล้ว ${completedCount} แมท • 
                        คงเหลือ ${pendingCount} แมท
                    </div>
                </div>
                <div class="admin-matches-grid">
                    ${matches.map(match => generateAdminMatchCard(match)).join('')}
                </div>
            `;
        }

        function generateAdminMatchCard(match) {
            const statusClass = match.completed ? 'completed' : 'pending';
            const statusText = match.completed ? 'เสร็จแล้ว' : 'รอบันทึกผล';
            const roundText = match.group ? `${match.round} (${match.group})` : match.round;
            
            console.log('Generating card for match:', match.id, 'completed:', match.completed);
            
            return `
                <div class="admin-match-card ${statusClass}">
                    <div class="admin-match-header">
                        <span class="match-id">${match.id}</span>
                        <span class="match-round">${roundText}</span>
                        <span class="match-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="admin-match-teams">
                        <div class="admin-team">
                            <span class="team-name">${match.team1}</span>
                            <div class="team-score-display">
                                ${match.completed && match.score1 ? 
                                    match.score1.map(score => `<span class="score-badge">${score}</span>`).join('') + 
                                    `<span class="sets-badge">(${match.sets1})</span>` :
                                    '<span class="score-placeholder">- -</span>'
                                }
                            </div>
                        </div>
                        <div class="vs-divider">VS</div>
                        <div class="admin-team">
                            <span class="team-name">${match.team2}</span>
                            <div class="team-score-display">
                                ${match.completed && match.score2 ? 
                                    match.score2.map(score => `<span class="score-badge">${score}</span>`).join('') + 
                                    `<span class="sets-badge">(${match.sets2})</span>` :
                                    '<span class="score-placeholder">- -</span>'
                                }
                            </div>
                        </div>
                    </div>
                    <div class="admin-match-actions">
                        ${match.completed ? 
                            `<button class="admin-btn-edit" onclick="editMatchHandler('${match.id}')">แก้ไขผล</button>` :
                            `<button class="admin-btn-record" onclick="recordMatchHandler('${match.id}')">บันทึกผล</button>`
                        }
                    </div>
                </div>
            `;
        }

        // Separate handler functions to avoid quote escaping issues
        function recordMatchHandler(matchId) {
            console.log('Record match handler called for:', matchId);
            recordMatch(matchId);
        }

        function editMatchHandler(matchId) {
            console.log('Edit match handler called for:', matchId);
            editMatch(matchId);
        }

        // Test function to verify if functions exist
        function testAdminFunctions() {
            console.log('Testing admin functions...');
            console.log('recordMatch function exists:', typeof recordMatch === 'function');
            console.log('editMatch function exists:', typeof editMatch === 'function');
            console.log('findMatchById function exists:', typeof findMatchById === 'function');
            console.log('openScoreModal function exists:', typeof openScoreModal === 'function');
        }

        function recordMatch(matchId) {
            openScoreModal(matchId, false);
        }

        function editMatch(matchId) {
            openScoreModal(matchId, true);
        }

        function openScoreModal(matchId, isEdit) {
            console.log('Opening score modal for:', matchId, 'isEdit:', isEdit);
            
            const match = findMatchById(matchId);
            console.log('Found match:', match);
            
            if (!match) {
                alert('ไม่พบข้อมูลแมท: ' + matchId);
                return;
            }

            // Set modal title
            document.getElementById('scoreModalTitle').textContent = isEdit ? '✏️ แก้ไขผลการแข่งขัน' : '📝 บันทึกผลการแข่งขัน';

            // Set match info
            document.getElementById('matchIdDisplay').textContent = matchId;
            document.getElementById('team1Display').textContent = match.team1;
            document.getElementById('team2Display').textContent = match.team2;
            document.getElementById('matchRoundDisplay').textContent = match.round || 'รอบแรก';
            
            // Set team names in summary
            document.getElementById('team1Name').textContent = match.team1;
            document.getElementById('team2Name').textContent = match.team2;

            // Fill existing scores if editing
            if (isEdit && match.completed) {
                console.log('Filling existing scores:', match.score1, match.score2);
                fillExistingScores(match);
            } else {
                clearScoreInputs();
            }

            // Store current match data
            window.currentEditMatch = { matchId, isEdit, originalMatch: match };
            console.log('Stored current match:', window.currentEditMatch);

            // Show modal
            document.getElementById('scoreModal').style.display = 'block';

            // Add event listeners for real-time calculation
            addScoreInputListeners();
        }

        function findMatchById(matchId) {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            
            for (const category of categories) {
                const categoryData = getCategoryData(category);
                
                // Search in round robin matches
                for (const group of categoryData.groups) {
                    if (group.matches) {
                        const match = group.matches.find(m => m.id === matchId);
                        if (match) {
                            return { 
                                ...match, 
                                category, 
                                round: 'รอบแรก', 
                                group: group.name,
                                // Ensure arrays exist
                                score1: match.score1 || [],
                                score2: match.score2 || [],
                                sets1: match.sets1 || 0,
                                sets2: match.sets2 || 0,
                                completed: match.completed || false
                            };
                        }
                    }
                }
                
                // Search in knockout matches
                if (categoryData.knockoutMatches) {
                    const knockoutMatch = categoryData.knockoutMatches.find(m => m.id === matchId);
                    if (knockoutMatch) {
                        return { 
                            ...knockoutMatch, 
                            category, 
                            round: 'น็อกเอาท์',
                            score1: knockoutMatch.score1 || [],
                            score2: knockoutMatch.score2 || [],
                            sets1: knockoutMatch.sets1 || 0,
                            sets2: knockoutMatch.sets2 || 0,
                            completed: knockoutMatch.completed || false
                        };
                    }
                }
                
                // Search in finals
                if (categoryData.finals) {
                    const finalMatch = categoryData.finals.find(m => m.id === matchId);
                    if (finalMatch) {
                        return { 
                            ...finalMatch, 
                            category, 
                            round: finalMatch.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3',
                            score1: finalMatch.score1 || [],
                            score2: finalMatch.score2 || [],
                            sets1: finalMatch.sets1 || 0,
                            sets2: finalMatch.sets2 || 0,
                            completed: finalMatch.completed || false
                        };
                    }
                }
            }
            
            return null;
        }

        function fillExistingScores(match) {
            console.log('Filling existing scores for match:', match);
            
            if (match.score1 && match.score1.length > 0) {
                document.getElementById('set1Team1').value = match.score1[0] || '';
                document.getElementById('set1Team2').value = match.score2[0] || '';
            }
            if (match.score1 && match.score1.length > 1) {
                document.getElementById('set2Team1').value = match.score1[1] || '';
                document.getElementById('set2Team2').value = match.score2[1] || '';
            }
            if (match.score1 && match.score1.length > 2) {
                document.getElementById('set3Team1').value = match.score1[2] || '';
                document.getElementById('set3Team2').value = match.score2[2] || '';
            }
            
            // Set shuttlecock count (mock default)
            document.getElementById('shuttlecockCount').value = 1;
            updateCostDisplay();
            
            // Set the existing sets count directly from match data
            document.getElementById('team1Sets').textContent = match.sets1 || 0;
            document.getElementById('team2Sets').textContent = match.sets2 || 0;
            
            // Update winner display
            const winnerDisplay = document.getElementById('winnerDisplay');
            if (match.sets1 > match.sets2) {
                winnerDisplay.textContent = `🏆 ${match.team1} ชนะ`;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (match.sets2 > match.sets1) {
                winnerDisplay.textContent = `🏆 ${match.team2} ชนะ`;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (match.sets1 === match.sets2 && match.sets1 > 0) {
                winnerDisplay.textContent = '🤝 เสมอ';
                winnerDisplay.className = 'winner-display';
            } else {
                winnerDisplay.textContent = 'ยังไม่มีผู้ชนะ';
                winnerDisplay.className = 'winner-display';
            }
            
            console.log('Filled scores - Team1 sets:', match.sets1, 'Team2 sets:', match.sets2);
        }

        function clearScoreInputs() {
            document.getElementById('set1Team1').value = '';
            document.getElementById('set1Team2').value = '';
            document.getElementById('set2Team1').value = '';
            document.getElementById('set2Team2').value = '';
            document.getElementById('set3Team1').value = '';
            document.getElementById('set3Team2').value = '';
            document.getElementById('shuttlecockCount').value = 1;
            
            // Reset score summary
            document.getElementById('team1Sets').textContent = '0';
            document.getElementById('team2Sets').textContent = '0';
            
            const winnerDisplay = document.getElementById('winnerDisplay');
            winnerDisplay.textContent = 'ยังไม่มีผู้ชนะ';
            winnerDisplay.className = 'winner-display';
            
            updateCostDisplay();
        }

        function addScoreInputListeners() {
            // Remove existing listeners first to prevent duplicates
            const scoreInputs = document.querySelectorAll('.score-input');
            scoreInputs.forEach(input => {
                input.removeEventListener('input', updateScoreSummary);
                input.addEventListener('input', updateScoreSummary);
            });
            
            const shuttlecockInput = document.getElementById('shuttlecockCount');
            if (shuttlecockInput) {
                shuttlecockInput.removeEventListener('input', updateCostDisplay);
                shuttlecockInput.addEventListener('input', updateCostDisplay);
            }
            
            console.log('Score input listeners added');
        }

        function updateScoreSummary() {
            // Check if currentEditMatch exists
            if (!window.currentEditMatch || !window.currentEditMatch.originalMatch) {
                console.log('currentEditMatch not available yet, skipping update');
                return;
            }
            
            const sets = [
                {
                    team1: parseInt(document.getElementById('set1Team1').value) || 0,
                    team2: parseInt(document.getElementById('set1Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set2Team1').value) || 0,
                    team2: parseInt(document.getElementById('set2Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set3Team1').value) || 0,
                    team2: parseInt(document.getElementById('set3Team2').value) || 0
                }
            ];

            let team1Sets = 0;
            let team2Sets = 0;

            sets.forEach(set => {
                if (set.team1 > 0 || set.team2 > 0) {
                    if (set.team1 > set.team2) team1Sets++;
                    else if (set.team2 > set.team1) team2Sets++;
                }
            });

            document.getElementById('team1Sets').textContent = team1Sets;
            document.getElementById('team2Sets').textContent = team2Sets;

            const winnerDisplay = document.getElementById('winnerDisplay');
            const match = window.currentEditMatch.originalMatch;
            
            if (team1Sets > team2Sets && team1Sets >= 2) {
                winnerDisplay.textContent = `🏆 ${match.team1} ชนะ`;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (team2Sets > team1Sets && team2Sets >= 2) {
                winnerDisplay.textContent = `🏆 ${match.team2} ชนะ`;
                winnerDisplay.className = 'winner-display has-winner';
            } else if (team1Sets === team2Sets && team1Sets > 0) {
                winnerDisplay.textContent = '🤝 เสมอ';
                winnerDisplay.className = 'winner-display';
            } else {
                winnerDisplay.textContent = 'ยังไม่มีผู้ชนะ';
                winnerDisplay.className = 'winner-display';
            }
        }

        function updateCostDisplay() {
            const count = parseInt(document.getElementById('shuttlecockCount').value) || 0;
            const cost = count * 40; // 80 บาทหารครึ่ง = 40 บาท/ทีม
            document.getElementById('totalCost').textContent = cost;
        }

        function closeScoreModal() {
            document.getElementById('scoreModal').style.display = 'none';
            window.currentEditMatch = null;
        }

        function saveMatchScore() {
            if (!window.currentEditMatch) return;

            const sets = [
                {
                    team1: parseInt(document.getElementById('set1Team1').value) || 0,
                    team2: parseInt(document.getElementById('set1Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set2Team1').value) || 0,
                    team2: parseInt(document.getElementById('set2Team2').value) || 0
                },
                {
                    team1: parseInt(document.getElementById('set3Team1').value) || 0,
                    team2: parseInt(document.getElementById('set3Team2').value) || 0
                }
            ];

            // Validate scores
            let team1Sets = 0;
            let team2Sets = 0;
            const score1 = [];
            const score2 = [];

            let isValid = true;
            let hasValidSets = false;

            sets.forEach((set, index) => {
                if (set.team1 > 0 || set.team2 > 0) {
                    hasValidSets = true;
                    score1.push(set.team1);
                    score2.push(set.team2);
                    
                    if (set.team1 > set.team2) team1Sets++;
                    else if (set.team2 > set.team1) team2Sets++;
                    
                    // Validate badminton scoring rules
                    if (Math.max(set.team1, set.team2) < 21 && Math.abs(set.team1 - set.team2) < 2) {
                        if (Math.max(set.team1, set.team2) < 20) {
                            isValid = false;
                        }
                    }
                }
            });

            if (!hasValidSets) {
                alert('กรุณาใส่คะแนนอย่างน้อย 1 เซ็ต');
                return;
            }

            if (team1Sets < 2 && team2Sets < 2) {
                alert('ต้องมีทีมใดทีมหนึ่งชนะอย่างน้อย 2 เซ็ต');
                return;
            }

            const shuttlecockCount = parseInt(document.getElementById('shuttlecockCount').value) || 0;
            const costPerTeam = shuttlecockCount * 40;

            // Here would be the actual save to database
            alert(`บันทึกผลสำเร็จ!\n\nแมท: ${window.currentEditMatch.matchId}\nผลการแข่งขัน: ${team1Sets}-${team2Sets}\nค่าลูกแบด: ${costPerTeam} บาท/ทีม\n\n(การบันทึกจริงจะเชื่อมต่อ Google Sheets)`);

            closeScoreModal();
            
            // Refresh the matches list
            loadAdminMatches();
        }

        async function loadCategory(cat, fromRefresh = false) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // หาปุ่มที่ถูกต้องสำหรับประเภทนี้
            const categoryBtn = document.querySelector(`[onclick="loadCategory('${cat}')"]`);
            if (categoryBtn) {
                categoryBtn.classList.add('active');
            }
            
            currentCategory = cat;
            
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>กำลังโหลดข้อมูล...</div></div>';
            
            try {
                // ดึงข้อมูลจาก Google Sheets หรือ Mock Data
                const categoryData = await getCategoryData(cat);
                const categoryName = getCategoryName(cat);
                const stats = getCategoryStats(categoryData);
                showCategory(cat, categoryName, stats);
            } catch (error) {
                console.error('Error loading category:', error);
                // Fallback to hardcoded stats if data loading fails
                if (cat === 'A') {
                    showCategory('A', 'มือ A', '6 ทีม • 2 สาย • 10 แมท');
                } else if (cat === 'B') {
                    showCategory('B', 'มือ B', '12 ทีม • 4 สาย • 20 แมท');
                } else if (cat === 'C-B') {
                    showCategory('C-B', 'มือ C-B', '17 ทีม • 4 สาย • 36 แมท');
                } else if (cat === 'C-C') {
                    showCategory('C-C', 'มือ C-C', '11 ทีม • 2 สาย • 29 แมท');
                } else if (cat === 'D') {
                    showCategory('D', 'มือ D', '10 ทีม • 2 สาย • 24 แมท');
                } else if (cat === 'ใหม่') {
                    showCategory('ใหม่', 'มือใหม่', '9 ทีม • 2 สาย • 20 แมท');
                } else if (cat === 'ผสม') {
                    showCategory('ผสม', 'มือผสม', '12 ทีม • 4 สาย • 20 แมท');
                }
            }
        }

        // ฟังก์ชันดึงชื่อประเภท
        function getCategoryName(category) {
            const names = {
                'A': 'มือ A',
                'B': 'มือ B',
                'C-B': 'มือ C-B',
                'C-C': 'มือ C-C',
                'D': 'มือ D',
                'ใหม่': 'มือใหม่',
                'ผสม': 'มือผสม'
            };
            return names[category] || category;
        }

        // ฟังก์ชันคำนวณสถิติ
        function getCategoryStats(categoryData) {
            if (!categoryData) return 'กำลังโหลด...';
            
            const teamCount = categoryData.groups ? 
                categoryData.groups.reduce((total, group) => total + group.teams.length, 0) : 0;
            const matchCount = categoryData.groups ? 
                categoryData.groups.reduce((total, group) => total + group.matches.length, 0) : 0;
            const knockoutCount = categoryData.knockoutMatches ? categoryData.knockoutMatches.length : 0;
            const finalsCount = categoryData.finals ? categoryData.finals.length : 0;
            const groupCount = categoryData.groups ? categoryData.groups.length : 0;
            
            return `${teamCount} ทีม • ${groupCount} สาย • ${matchCount + knockoutCount + finalsCount} แมท`;
        }

        // ฟังก์ชันทดสอบการแสดงผลแต่ละประเภท
        function testAllCategories() {
            console.log('🧪 Testing all categories...');
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            
            categories.forEach(category => {
                console.log(`\n📋 Testing category: ${category}`);
                try {
                    const mockData = getMockCategoryData(category);
                    console.log(`✅ Mock data loaded for ${category}:`, mockData);
                    
                    // ทดสอบการสร้าง content
                    const roundRobinContent = generateRoundRobinContent(mockData);
                    const knockoutContent = generateKnockoutContent(mockData);
                    const finalsContent = generateFinalsContent(mockData);
                    
                    console.log(`✅ Round Robin content generated for ${category}`);
                    console.log(`✅ Knockout content generated for ${category}`);
                    console.log(`✅ Finals content generated for ${category}`);
                    
                } catch (error) {
                    console.error(`❌ Error testing category ${category}:`, error);
                }
            });
            
            console.log('\n🎉 All categories tested successfully!');
        }

        // ฟังก์ชันตรวจสอบความสมบูรณ์ของ Mock Data
        function validateMockData() {
            console.log('🔍 Validating Mock Data...');
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            let allValid = true;
            
            categories.forEach(category => {
                console.log(`\n📋 Validating category: ${category}`);
                try {
                    const data = getMockCategoryData(category);
                    
                    // ตรวจสอบโครงสร้างข้อมูล
                    if (!data.groups || !Array.isArray(data.groups)) {
                        console.error(`❌ Invalid groups structure for ${category}`);
                        allValid = false;
                        return;
                    }
                    
                    if (!data.knockoutMatches || !Array.isArray(data.knockoutMatches)) {
                        console.error(`❌ Invalid knockoutMatches structure for ${category}`);
                        allValid = false;
                        return;
                    }
                    
                    if (!data.finals || !Array.isArray(data.finals)) {
                        console.error(`❌ Invalid finals structure for ${category}`);
                        allValid = false;
                        return;
                    }
                    
                    // ตรวจสอบข้อมูลในแต่ละกลุ่ม
                    data.groups.forEach((group, groupIndex) => {
                        if (!group.name || !group.teams || !group.matches) {
                            console.error(`❌ Invalid group structure for ${category}, group ${groupIndex}`);
                            allValid = false;
                        }
                        
                        // ตรวจสอบทีม
                        group.teams.forEach((team, teamIndex) => {
                            if (!team.name || typeof team.rank !== 'number' || typeof team.points !== 'number') {
                                console.error(`❌ Invalid team structure for ${category}, group ${groupIndex}, team ${teamIndex}`);
                                allValid = false;
                            }
                        });
                        
                        // ตรวจสอบแมท
                        group.matches.forEach((match, matchIndex) => {
                            if (!match.id || !match.team1 || !match.team2) {
                                console.error(`❌ Invalid match structure for ${category}, group ${groupIndex}, match ${matchIndex}`);
                                allValid = false;
                            }
                        });
                    });
                    
                    console.log(`✅ Category ${category} validation passed`);
                    
                } catch (error) {
                    console.error(`❌ Error validating category ${category}:`, error);
                    allValid = false;
                }
            });
            
            if (allValid) {
                console.log('\n🎉 All Mock Data validation passed!');
            } else {
                console.log('\n❌ Some Mock Data validation failed!');
            }
            
            return allValid;
        }

        // ระบบ Cache สำหรับข้อมูลแต่ละประเภท
        let categoryCache = {
            'A': { data: null, lastUpdated: null, isLoaded: false },
            'B': { data: null, lastUpdated: null, isLoaded: false },
            'C-B': { data: null, lastUpdated: null, isLoaded: false },
            'C-C': { data: null, lastUpdated: null, isLoaded: false },
            'D': { data: null, lastUpdated: null, isLoaded: false },
            'ใหม่': { data: null, lastUpdated: null, isLoaded: false },
            'ผสม': { data: null, lastUpdated: null, isLoaded: false }
        };

        // ฟังก์ชันดึงข้อมูลจาก Google Sheets พร้อม Cache
        async function loadCategoryDataFromSheets(category) {
            try {
                if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    console.log('Google Apps Script URL not configured, using mock data for', category);
                    return null;
                }

                // ตรวจสอบ cache
                if (categoryCache[category].isLoaded && categoryCache[category].lastUpdated) {
                    const now = Date.now();
                    const cacheExpiry = 5 * 60 * 1000; // 5 นาที
                    if (now - categoryCache[category].lastUpdated < cacheExpiry) {
                        console.log('Using cached data from Google Sheets for', category);
                        return categoryCache[category].data;
                    }
                }

                console.log('Loading data from Google Sheets for', category);
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(getCategoryName(category))}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    categoryCache[category].data = result.data;
                    categoryCache[category].lastUpdated = Date.now();
                    categoryCache[category].isLoaded = true;
                    console.log('Data loaded successfully from Google Sheets for', category);
                    return result.data;
                } else {
                    throw new Error(result.message || 'Failed to load data');
                }
            } catch (error) {
                console.error('Error loading data from Google Sheets for', category, ':', error);
                return null;
            }
        }

        // ฟังก์ชันล้าง Cache
        function clearCategoryCache(category = null) {
            if (category) {
                categoryCache[category] = { data: null, lastUpdated: null, isLoaded: false };
                console.log(`Cache cleared for category: ${category}`);
            } else {
                Object.keys(categoryCache).forEach(cat => {
                    categoryCache[cat] = { data: null, lastUpdated: null, isLoaded: false };
                });
                console.log('All cache cleared');
            }
        }

        // ฟังก์ชันทดสอบ Google Sheets API
        async function testGoogleSheetsAPI() {
            console.log('🔗 Testing Google Sheets API...');
            
            try {
                // ทดสอบการเชื่อมต่อพื้นฐาน
                console.log('1. Testing basic connection...');
                const testResponse = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                const testResult = await testResponse.json();
                console.log('✅ Basic connection test:', testResult);
                
                // ทดสอบการดึงข้อมูลแต่ละประเภท
                const categories = ['มือ A', 'มือ B', 'มือ C-B', 'มือ C-C', 'มือ D', 'มือใหม่', 'มือผสม'];
                
                for (const category of categories) {
                    console.log(`\n2. Testing category: ${category}`);
                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getCategoryData&category=${encodeURIComponent(category)}`);
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            console.log(`✅ Category ${category} data loaded:`, result);
                            console.log(`   - Teams: ${result.counts?.teams || 0}`);
                            console.log(`   - Matches: ${result.counts?.matches || 0}`);
                            console.log(`   - Standings: ${result.counts?.standings || 0}`);
                            console.log(`   - Draw History: ${result.counts?.drawHistory || 0}`);
                        } else {
                            console.log(`⚠️ Category ${category} returned error:`, result.message);
                        }
                    } catch (error) {
                        console.error(`❌ Error testing category ${category}:`, error);
                    }
                }
                
                // ทดสอบการดึงข้อมูลทั้งหมด
                console.log('\n3. Testing getAllData...');
                try {
                    const allDataResponse = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getAllData`);
                    const allDataResult = await allDataResponse.json();
                    console.log('✅ All data test:', allDataResult);
                } catch (error) {
                    console.error('❌ Error testing getAllData:', error);
                }
                
                console.log('\n🎉 Google Sheets API testing completed!');
                
            } catch (error) {
                console.error('❌ Google Sheets API testing failed:', error);
            }
        }

        // ฟังก์ชันตรวจสอบข้อผิดพลาดทั่วไป
        function checkForErrors() {
            console.log('🔧 Checking for common errors...');
            let errorCount = 0;
            
            // ตรวจสอบ Google Apps Script URL
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                console.warn('⚠️ Google Apps Script URL not configured');
                errorCount++;
            }
            
            // ตรวจสอบ Google Sheets URL
            if (!GOOGLE_SHEETS_URL) {
                console.warn('⚠️ Google Sheets URL not configured');
                errorCount++;
            }
            
            // ตรวจสอบ localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log('✅ localStorage is working');
            } catch (error) {
                console.error('❌ localStorage error:', error);
                errorCount++;
            }
            
            // ตรวจสอบ fetch API
            if (typeof fetch === 'undefined') {
                console.error('❌ Fetch API not available');
                errorCount++;
            } else {
                console.log('✅ Fetch API is available');
            }
            
            // ตรวจสอบ console
            if (typeof console === 'undefined') {
                console.error('❌ Console not available');
                errorCount++;
            } else {
                console.log('✅ Console is available');
            }
            
            if (errorCount === 0) {
                console.log('🎉 No errors found! System is ready.');
            } else {
                console.log(`⚠️ Found ${errorCount} potential issues.`);
            }
            
            return errorCount === 0;
        }

        function showCategory(categoryKey, categoryName, stats) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="bracket-container">
                    <div class="bracket-header">
                        <h2 class="bracket-title">${categoryName}</h2>
                        <div class="bracket-stats">${stats}</div>
                    </div>
                    <div class="tabs-container">
                        <div class="tabs-nav">
                            <button class="tab-btn active" onclick="switchTab('${categoryKey}', 'round-robin')">📋 รอบแรก</button>
                            <button class="tab-btn" onclick="switchTab('${categoryKey}', 'knockout')">⚔️ น็อกเอาท์</button>
                            <button class="tab-btn" onclick="switchTab('${categoryKey}', 'finals')">🏆 ชิงชนะเลิศ</button>
                        </div>
                        <div class="tab-content" id="tabContent">
                            <div class="loading"><div class="loading-spinner"></div><div>กำลังโหลดข้อมูล...</div></div>
                        </div>
                    </div>
                </div>
            `;
            
            // โหลดข้อมูลเริ่มต้นสำหรับแท็บแรก
            setTimeout(async () => {
                try {
                    const content = await getContent(categoryKey, 'round-robin');
                    const tabContent = document.getElementById('tabContent');
                    if (tabContent) {
                        tabContent.innerHTML = content;
                    }
                } catch (error) {
                    console.error('Error loading initial content:', error);
                    const tabContent = document.getElementById('tabContent');
                    if (tabContent) {
                        tabContent.innerHTML = '<div class="error">เกิดข้อผิดพลาดในการโหลดข้อมูล</div>';
                    }
                }
            }, 100);
        }

        async function switchTab(category, tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            const tabContent = document.getElementById('tabContent');
            tabContent.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>กำลังโหลดข้อมูล...</div></div>';
            
            try {
                const content = await getContent(category, tab);
                tabContent.innerHTML = content;
            } catch (error) {
                console.error('Error loading tab content:', error);
                tabContent.innerHTML = '<div class="error">เกิดข้อผิดพลาดในการโหลดข้อมูล</div>';
            }
        }

        async function getContent(category, tab) {
            const categoryData = await getCategoryData(category);
            
            if (tab === 'round-robin') {
                return generateRoundRobinContent(categoryData);
            } else if (tab === 'knockout') {
                return generateKnockoutContent(categoryData);
            } else if (tab === 'finals') {
                return generateFinalsContent(categoryData);
            }
        }

        async function getCategoryData(category) {
            try {
                // ลองดึงข้อมูลจาก Google Sheets ก่อน
                const sheetsData = await loadCategoryDataFromSheets(category);
                if (sheetsData) {
                    const convertedData = convertSheetsDataToDisplayFormat(sheetsData, category);
                    if (convertedData) {
                        return convertedData;
                    }
                }

                // ถ้าไม่สามารถดึงข้อมูลจาก Google Sheets ได้ ให้ใช้ Mock Data
                console.log('Using mock data for', category);
                return getMockCategoryData(category);
            } catch (error) {
                console.error('Error loading category data:', error);
                console.log('Falling back to mock data for', category);
                return getMockCategoryData(category);
            }
        }

        // ฟังก์ชันแปลงข้อมูลจาก Google Sheets เป็นรูปแบบ Display
        function convertSheetsDataToDisplayFormat(sheetsData, category) {
            if (!sheetsData) return getMockCategoryData(category);

            const teams = sheetsData.teams || [];
            const matches = sheetsData.matches || [];
            const standings = sheetsData.standings || [];
            const drawHistory = sheetsData.drawHistory || [];

            // แปลงข้อมูลให้ตรงกับรูปแบบเดิม
            return convertToDisplayFormat(teams, matches, standings, drawHistory, category);
        }

        // ฟังก์ชันแปลงข้อมูลจาก Google Sheets เป็นรูปแบบ Display
        function convertToDisplayFormat(teams, matches, standings, drawHistory, category) {
            console.log('Converting data for category:', category);
            console.log('Teams:', teams);
            console.log('Matches:', matches);
            console.log('Standings:', standings);
            console.log('Draw History:', drawHistory);
            
            // แยกแมทตาม round_type
            const roundRobinMatches = matches.filter(m => m.round_type === 'รอบแรก');
            const knockoutMatches = matches.filter(m => m.round_type === 'รอบ4ทีม' || m.round_type === 'รอบ8ทีม');
            const finalsMatches = matches.filter(m => m.round_type === 'ชิงชนะเลิศ' || m.round_type === 'ชิงอันดับ3');
            
            console.log('Round Robin Matches:', roundRobinMatches);
            console.log('Knockout Matches:', knockoutMatches);
            console.log('Finals Matches:', finalsMatches);

            // สร้าง groups จาก standings
            const groups = {};
            standings.forEach(standing => {
                if (!groups[standing.group_name]) {
                    groups[standing.group_name] = {
                        name: standing.group_name,
                        teams: [],
                        matches: []
                    };
                }
                groups[standing.group_name].teams.push({
                    rank: standing.rank_in_group,
                    name: standing.team_name,
                    matches: standing.matches_played,
                    wins: standing.wins,
                    points: standing.points,
                    qualified: standing.qualified
                });
            });

            // เพิ่มแมทรอบแรกในแต่ละกลุ่ม
            Object.keys(groups).forEach(groupName => {
                const groupMatches = roundRobinMatches.filter(m => {
                    // หาทีมที่อยู่ในกลุ่มนี้
                    const team1InGroup = standings.find(s => s.team_id === m.team1_id && s.group_name === groupName);
                    const team2InGroup = standings.find(s => s.team_id === m.team2_id && s.group_name === groupName);
                    return team1InGroup && team2InGroup;
                });

                groups[groupName].matches = groupMatches.map(m => ({
                    id: m.match_id,
                    team1: m.team1_name,
                    team2: m.team2_name,
                    score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                    score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                    sets1: m.set1_team1 > m.set1_team2 ? 1 : 0 + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                    sets2: m.set1_team2 > m.set1_team1 ? 1 : 0 + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                    completed: m.match_status === 'completed'
                }));
            });

            // แปลง knockout matches
            const knockoutFormatted = knockoutMatches.map(m => ({
                id: m.match_id,
                team1: m.team1_name,
                team2: m.team2_name,
                score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                sets1: m.set1_team1 > m.set1_team2 ? 1 : 0 + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                sets2: m.set1_team2 > m.set1_team1 ? 1 : 0 + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                completed: m.match_status === 'completed'
            }));

            // แปลง finals matches
            const finalsFormatted = finalsMatches.map(m => ({
                id: m.match_id,
                type: m.round_type === 'ชิงชนะเลิศ' ? 'championship' : 'third-place',
                team1: m.team1_name,
                team2: m.team2_name,
                score1: [m.set1_team1, m.set2_team1, m.set3_team1].filter(s => s > 0),
                score2: [m.set1_team2, m.set2_team2, m.set3_team2].filter(s => s > 0),
                sets1: m.set1_team1 > m.set1_team2 ? 1 : 0 + (m.set2_team1 > m.set2_team2 ? 1 : 0) + (m.set3_team1 > m.set3_team2 ? 1 : 0),
                sets2: m.set1_team2 > m.set1_team1 ? 1 : 0 + (m.set2_team2 > m.set2_team1 ? 1 : 0) + (m.set3_team2 > m.set3_team1 ? 1 : 0),
                completed: m.match_status === 'completed'
            }));

            return {
                groups: Object.values(groups),
                knockoutMatches: knockoutFormatted,
                finals: finalsFormatted
            };
        }

        // ฟังก์ชัน Mock Data (Fallback)
        function getMockCategoryData(category) {
            console.log('Using mock data for category:', category);
            const data = {
                'A': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'เอก-ชัย', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'ต้น+Alai', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'โค้ทนัท-โกอ๊อต', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M001', team1: 'เอก-ชัย', team2: 'โค้ทนัท-โกอ๊อต', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M002', team1: 'เอก-ชัย', team2: 'ต้น+Alai', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M003', team1: 'โค้ทนัท-โกอ๊อต', team2: 'ต้น+Alai', score1: [16, 19], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'โกอ้วน-นีล', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'กอล์ฟ-น็อต', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'เนส-ไปท์', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M004', team1: 'เนส-ไปท์', team2: 'โกอ้วน-นีล', score1: [12, 18], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M005', team1: 'เนส-ไปท์', team2: 'กอล์ฟ-น็อต', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true },
                                { id: 'M006', team1: 'โกอ้วน-นีล', team2: 'กอล์ฟ-น็อต', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M007', team1: 'เอก-ชัย', team2: 'กอล์ฟ-น็อต', score1: [21, 19, 21], score2: [18, 21, 16], sets1: 2, sets2: 1, completed: true },
                        { id: 'M008', team1: 'โกอ้วน-นีล', team2: 'ต้น+Alai', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M009', type: 'championship', team1: 'เอก-ชัย', team2: 'โกอ้วน-นีล', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M010', type: 'third-place', team1: 'กอล์ฟ-น็อต', team2: 'ต้น+Alai', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'B': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'ดี-นัท', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'โรบิ้น-เอกมุ่ย', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'ชัย-แบงค์ 1000', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M011', team1: 'ดี-นัท', team2: 'โรบิ้น-เอกมุ่ย', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M012', team1: 'ดี-นัท', team2: 'ชัย-แบงค์ 1000', score1: [21, 21], score2: [14, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M013', team1: 'โรบิ้น-เอกมุ่ย', team2: 'ชัย-แบงค์ 1000', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'บิว-อาร์ท', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'ไปท์-มุก', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'โค้ทนัท-บีม', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M014', team1: 'โค้ทนัท-บีม', team2: 'บิว-อาร์ท', score1: [15, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M015', team1: 'โค้ทนัท-บีม', team2: 'ไปท์-มุก', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true },
                                { id: 'M016', team1: 'บิว-อาร์ท', team2: 'ไปท์-มุก', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 3',
                            teams: [
                                { rank: 1, name: 'เติ้ง-โจน', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'ทอม-พี่หนุ่ม', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'พี่เหมี่ยว-อามอ', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M017', team1: 'พี่เหมี่ยว-อามอ', team2: 'เติ้ง-โจน', score1: [21, 18], score2: [19, 21], sets1: 1, sets2: 2, completed: true },
                                { id: 'M018', team1: 'พี่เหมี่ยว-อามอ', team2: 'ทอม-พี่หนุ่ม', score1: [19, 16], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M019', team1: 'เติ้ง-โจน', team2: 'ทอม-พี่หนุ่ม', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 4',
                            teams: [
                                { rank: 1, name: 'เอก-เตี้ย', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'เพียว-พี่ตู้', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'โก้-แต้ม', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M020', team1: 'เอก-เตี้ย', team2: 'เพียว-พี่ตู้', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M021', team1: 'เอก-เตี้ย', team2: 'โก้-แต้ม', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M022', team1: 'เพียว-พี่ตู้', team2: 'โก้-แต้ม', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M023', team1: 'ดี-นัท', team2: 'ไปท์-มุก', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M024', team1: 'บิว-อาร์ท', team2: 'โรบิ้น-เอกมุ่ย', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M025', team1: 'เติ้ง-โจน', team2: 'เพียว-พี่ตู้', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M026', team1: 'เอก-เตี้ย', team2: 'ทอม-พี่หนุ่ม', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M027', team1: 'ดี-นัท', team2: 'บิว-อาร์ท', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M028', team1: 'รอผลรอบ8ทีม', team2: 'รอผลรอบ8ทีม', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M029', type: 'championship', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M030', type: 'third-place', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                },
                'C-B': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'บิว-ชัย', matches: 3, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: 'โจน-มาร์ค', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: 'แชมป์-เหน่ง', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: 'โรบิ้น-หยาง', matches: 3, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M031', team1: 'บิว-ชัย', team2: 'โจน-มาร์ค', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M032', team1: 'บิว-ชัย', team2: 'แชมป์-เหน่ง', score1: [21, 21], score2: [15, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M033', team1: 'บิว-ชัย', team2: 'โรบิ้น-หยาง', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M034', team1: 'โจน-มาร์ค', team2: 'แชมป์-เหน่ง', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M035', team1: 'โจน-มาร์ค', team2: 'โรบิ้น-หยาง', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M036', team1: 'แชมป์-เหน่ง', team2: 'โรบิ้น-หยาง', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'เพียว-เนส', matches: 3, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: 'เตี้ย-อัพ', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: 'ทอม-จิ๊บ', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: 'พฤกษ์-หนุ่ม', matches: 3, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M037', team1: 'เตี้ย-อัพ', team2: 'เพียว-เนส', score1: [18, 16], score2: [21, 21], sets1: 0, sets2: 2, completed: true },
                                { id: 'M038', team1: 'เตี้ย-อัพ', team2: 'ทอม-จิ๊บ', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M039', team1: 'เตี้ย-อัพ', team2: 'พฤกษ์-หนุ่ม', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M040', team1: 'เพียว-เนส', team2: 'ทอม-จิ๊บ', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M041', team1: 'เพียว-เนส', team2: 'พฤกษ์-หนุ่ม', score1: [21, 21], score2: [14, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M042', team1: 'ทอม-จิ๊บ', team2: 'พฤกษ์-หนุ่ม', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 3',
                            teams: [
                                { rank: 1, name: 'สตีฟ-ฟลุ๊ค', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'แบงค์1000-โกกุ่ย', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: 'โกดุง-มุย', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: 'ชิ-พี่เอ๋', matches: 3, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M043', team1: 'สตีฟ-ฟลุ๊ค', team2: 'แบงค์1000-โกกุ่ย', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M044', team1: 'สตีฟ-ฟลุ๊ค', team2: 'โกดุง-มุย', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M045', team1: 'สตีฟ-ฟลุ๊ค', team2: 'ชิ-พี่เอ๋', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M046', team1: 'แบงค์1000-โกกุ่ย', team2: 'โกดุง-มุย', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M047', team1: 'แบงค์1000-โกกุ่ย', team2: 'ชิ-พี่เอ๋', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M048', team1: 'โกดุง-มุย', team2: 'ชิ-พี่เอ๋', score1: [18, 20], score2: [21, 22], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 4',
                            teams: [
                                { rank: 1, name: 'อาร์ท-พี่อู๊ด', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: 'น็อต-พี่ต๋อม', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: 'พี่อั๋น-ครูเล็ก', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: 'โชค-โอม', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: 'ชิฟ-ฟ้า', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M049', team1: 'อาร์ท-พี่อู๊ด', team2: 'น็อต-พี่ต๋อม', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M050', team1: 'อาร์ท-พี่อู๊ด', team2: 'พี่อั๋น-ครูเล็ก', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M051', team1: 'อาร์ท-พี่อู๊ด', team2: 'โชค-โอม', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M052', team1: 'อาร์ท-พี่อู๊ด', team2: 'ชิฟ-ฟ้า', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M053', team1: 'น็อต-พี่ต๋อม', team2: 'พี่อั๋น-ครูเล็ก', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M054', team1: 'น็อต-พี่ต๋อม', team2: 'โชค-โอม', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M055', team1: 'น็อต-พี่ต๋อม', team2: 'ชิฟ-ฟ้า', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M056', team1: 'พี่อั๋น-ครูเล็ก', team2: 'โชค-โอม', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M057', team1: 'พี่อั๋น-ครูเล็ก', team2: 'ชิฟ-ฟ้า', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M058', team1: 'โชค-โอม', team2: 'ชิฟ-ฟ้า', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M059', team1: 'บิว-ชัย', team2: 'น็อต-พี่ต๋อม', score1: [21, 16, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M060', team1: 'เพียว-เนส', team2: 'แบงค์1000-โกกุ่ย', score1: [21, 18, 21], score2: [17, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M061', team1: 'สตีฟ-ฟลุ๊ค', team2: 'เตี้ย-อัพ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M062', team1: 'อาร์ท-พี่อู๊ด', team2: 'โจน-มาร์ค', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M063', team1: 'บิว-ชัย', team2: 'เพียว-เนส', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M064', team1: 'รอผลรอบ8ทีม', team2: 'รอผลรอบ8ทีม', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M065', type: 'championship', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M066', type: 'third-place', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                },
                'C-C': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'อัพ-ชม', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: 'เจต-มาร์ค', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: 'หยาง-กวาง', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: 'นุช-ออย', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: 'หนึ่ง-ก๊อต', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M067', team1: 'อัพ-ชม', team2: 'เจต-มาร์ค', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M068', team1: 'อัพ-ชม', team2: 'หยาง-กวาง', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M069', team1: 'อัพ-ชม', team2: 'นุช-ออย', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M070', team1: 'อัพ-ชม', team2: 'หนึ่ง-ก๊อต', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M071', team1: 'เจต-มาร์ค', team2: 'หยาง-กวาง', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M072', team1: 'เจต-มาร์ค', team2: 'นุช-ออย', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M073', team1: 'เจต-มาร์ค', team2: 'หนึ่ง-ก๊อต', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M074', team1: 'หยาง-กวาง', team2: 'นุช-ออย', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M075', team1: 'หยาง-กวาง', team2: 'หนึ่ง-ก๊อต', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M076', team1: 'นุช-ออย', team2: 'หนึ่ง-ก๊อต', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'ต๋อม-พี่กิ่ง', matches: 5, wins: 5, points: 15, qualified: true },
                                { rank: 2, name: 'มุก-ต้อม', matches: 5, wins: 4, points: 12, qualified: true },
                                { rank: 3, name: 'น้าพจน์-อั๋น', matches: 5, wins: 3, points: 9, qualified: false },
                                { rank: 4, name: 'มิ้น-นิว', matches: 5, wins: 2, points: 6, qualified: false },
                                { rank: 5, name: 'บี-สา', matches: 5, wins: 1, points: 3, qualified: false },
                                { rank: 6, name: 'สตีฟ-พิม', matches: 5, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M077', team1: 'ต๋อม-พี่กิ่ง', team2: 'มุก-ต้อม', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M078', team1: 'ต๋อม-พี่กิ่ง', team2: 'น้าพจน์-อั๋น', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M079', team1: 'ต๋อม-พี่กิ่ง', team2: 'มิ้น-นิว', score1: [21, 21], score2: [15, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M080', team1: 'ต๋อม-พี่กิ่ง', team2: 'บี-สา', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M081', team1: 'ต๋อม-พี่กิ่ง', team2: 'สตีฟ-พิม', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M082', team1: 'มุก-ต้อม', team2: 'น้าพจน์-อั๋น', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M083', team1: 'มุก-ต้อม', team2: 'มิ้น-นิว', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M084', team1: 'มุก-ต้อม', team2: 'บี-สา', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M085', team1: 'มุก-ต้อม', team2: 'สตีฟ-พิม', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M086', team1: 'น้าพจน์-อั๋น', team2: 'มิ้น-นิว', score1: [21, 21], score2: [16, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M087', team1: 'น้าพจน์-อั๋น', team2: 'บี-สา', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M088', team1: 'น้าพจน์-อั๋น', team2: 'สตีฟ-พิม', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true },
                                { id: 'M089', team1: 'มิ้น-นิว', team2: 'บี-สา', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M090', team1: 'มิ้น-นิว', team2: 'สตีฟ-พิม', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M091', team1: 'บี-สา', team2: 'สตีฟ-พิม', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M092', team1: 'อัพ-ชม', team2: 'มุก-ต้อม', score1: [21, 19, 21], score2: [18, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M093', team1: 'ต๋อม-พี่กิ่ง', team2: 'เจต-มาร์ค', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M094', type: 'championship', team1: 'อัพ-ชม', team2: 'ต๋อม-พี่กิ่ง', score1: [21, 18, 21], score2: [19, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M095', type: 'third-place', team1: 'มุก-ต้อม', team2: 'เจต-มาร์ค', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'D': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'แหม่ม-นาวา', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 2, name: 'โอ็ค-ไอซ์', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: 'มาร์ค-ลิฟ', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: 'กุ่ย-กานต์', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: 'แอร์-ชิน', matches: 4, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M096', team1: 'แหม่ม-นาวา', team2: 'โอ็ค-ไอซ์', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M097', team1: 'แหม่ม-นาวา', team2: 'มาร์ค-ลิฟ', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M098', team1: 'แหม่ม-นาวา', team2: 'กุ่ย-กานต์', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M099', team1: 'แหม่ม-นาวา', team2: 'แอร์-ชิน', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M100', team1: 'โอ็ค-ไอซ์', team2: 'มาร์ค-ลิฟ', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M101', team1: 'โอ็ค-ไอซ์', team2: 'กุ่ย-กานต์', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M102', team1: 'โอ็ค-ไอซ์', team2: 'แอร์-ชิน', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M103', team1: 'มาร์ค-ลิฟ', team2: 'กุ่ย-กานต์', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M104', team1: 'มาร์ค-ลิฟ', team2: 'แอร์-ชิน', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M105', team1: 'กุ่ย-กานต์', team2: 'แอร์-ชิน', score1: [19, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'เช่-ฉัตร', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: 'บอล-ปาล์ม', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: 'กวาง-อิง', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: 'มุก-อาร์ม', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: 'ออม-นิว', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M106', team1: 'เช่-ฉัตร', team2: 'บอล-ปาล์ม', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M107', team1: 'เช่-ฉัตร', team2: 'กวาง-อิง', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M108', team1: 'เช่-ฉัตร', team2: 'มุก-อาร์ม', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M109', team1: 'เช่-ฉัตร', team2: 'ออม-นิว', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M110', team1: 'บอล-ปาล์ม', team2: 'กวาง-อิง', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M111', team1: 'บอล-ปาล์ม', team2: 'มุก-อาร์ม', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M112', team1: 'บอล-ปาล์ม', team2: 'ออม-นิว', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M113', team1: 'กวาง-อิง', team2: 'มุก-อาร์ม', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M114', team1: 'กวาง-อิง', team2: 'ออม-นิว', score1: [21, 21], score2: [17, 15], sets1: 2, sets2: 0, completed: true },
                                { id: 'M115', team1: 'มุก-อาร์ม', team2: 'ออม-นิว', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M116', team1: 'แหม่ม-นาวา', team2: 'บอล-ปาล์ม', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M117', team1: 'เช่-ฉัตร', team2: 'โอ็ค-ไอซ์', score1: [21, 16, 21], score2: [18, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M118', type: 'championship', team1: 'แหม่ม-นาวา', team2: 'เช่-ฉัตร', score1: [21, 19, 21], score2: [18, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M119', type: 'third-place', team1: 'บอล-ปาล์ม', team2: 'โอ็ค-ไอซ์', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'ใหม่': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'อุ๊-ลูกชาย', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'โดนัท-แอร์', matches: 3, wins: 2, points: 6, qualified: true },
                                { rank: 3, name: 'แอม-บอส', matches: 3, wins: 1, points: 3, qualified: false },
                                { rank: 4, name: 'นิวเยียร์-แองกี้เบิร์ด', matches: 3, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M120', team1: 'อุ๊-ลูกชาย', team2: 'โดนัท-แอร์', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M121', team1: 'อุ๊-ลูกชาย', team2: 'แอม-บอส', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M122', team1: 'อุ๊-ลูกชาย', team2: 'นิวเยียร์-แองกี้เบิร์ด', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M123', team1: 'โดนัท-แอร์', team2: 'แอม-บอส', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M124', team1: 'โดนัท-แอร์', team2: 'นิวเยียร์-แองกี้เบิร์ด', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M125', team1: 'แอม-บอส', team2: 'นิวเยียร์-แองกี้เบิร์ด', score1: [19, 17], score2: [21, 21], sets1: 0, sets2: 2, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'ตุ๊กติ๊ก-มะปราง', matches: 4, wins: 4, points: 12, qualified: true },
                                { rank: 2, name: 'กาน-มล', matches: 4, wins: 3, points: 9, qualified: true },
                                { rank: 3, name: 'โกริน-น้านก', matches: 4, wins: 2, points: 6, qualified: false },
                                { rank: 4, name: 'จำปูน-นิชา', matches: 4, wins: 1, points: 3, qualified: false },
                                { rank: 5, name: 'ปุ้ย-รัก', matches: 4, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M126', team1: 'ตุ๊กติ๊ก-มะปราง', team2: 'กาน-มล', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M127', team1: 'ตุ๊กติ๊ก-มะปราง', team2: 'โกริน-น้านก', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M128', team1: 'ตุ๊กติ๊ก-มะปราง', team2: 'จำปูน-นิชา', score1: [21, 21], score2: [15, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M129', team1: 'ตุ๊กติ๊ก-มะปราง', team2: 'ปุ้ย-รัก', score1: [21, 21], score2: [12, 14], sets1: 2, sets2: 0, completed: true },
                                { id: 'M130', team1: 'กาน-มล', team2: 'โกริน-น้านก', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true },
                                { id: 'M131', team1: 'กาน-มล', team2: 'จำปูน-นิชา', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M132', team1: 'กาน-มล', team2: 'ปุ้ย-รัก', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M133', team1: 'โกริน-น้านก', team2: 'จำปูน-นิชา', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M134', team1: 'โกริน-น้านก', team2: 'ปุ้ย-รัก', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M135', team1: 'จำปูน-นิชา', team2: 'ปุ้ย-รัก', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M136', team1: 'อุ๊-ลูกชาย', team2: 'กาน-มล', score1: [21, 17, 21], score2: [19, 21, 18], sets1: 2, sets2: 1, completed: true },
                        { id: 'M137', team1: 'ตุ๊กติ๊ก-มะปราง', team2: 'โดนัท-แอร์', score1: [21, 18, 21], score2: [16, 21, 19], sets1: 2, sets2: 1, completed: true }
                    ],
                    finals: [
                        { id: 'M138', type: 'championship', team1: 'อุ๊-ลูกชาย', team2: 'ตุ๊กติ๊ก-มะปราง', score1: [21, 19, 21], score2: [18, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M139', type: 'third-place', team1: 'กาน-มล', team2: 'โดนัท-แอร์', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                    ]
                },
                'ผสม': {
                    groups: [
                        {
                            name: 'สาย 1',
                            teams: [
                                { rank: 1, name: 'ชม-พี่ฮวด', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'เนส-บีม', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'นิกกี้-นิว', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M140', team1: 'ชม-พี่ฮวด', team2: 'เนส-บีม', score1: [21, 21], score2: [18, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M141', team1: 'ชม-พี่ฮวด', team2: 'นิกกี้-นิว', score1: [21, 21], score2: [16, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M142', team1: 'เนส-บีม', team2: 'นิกกี้-นิว', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 2',
                            teams: [
                                { rank: 1, name: 'แฟ้ม-มุก', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'ชิ-ฟาง', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'ชัย-คาเมล', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M143', team1: 'แฟ้ม-มุก', team2: 'ชิ-ฟาง', score1: [21, 21], score2: [17, 19], sets1: 2, sets2: 0, completed: true },
                                { id: 'M144', team1: 'แฟ้ม-มุก', team2: 'ชัย-คาเมล', score1: [21, 21], score2: [15, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M145', team1: 'ชิ-ฟาง', team2: 'ชัย-คาเมล', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 3',
                            teams: [
                                { rank: 1, name: 'กิ่ง-กาย', matches: 2, wins: 2, points: 6, qualified: true },
                                { rank: 2, name: 'โก้-ออม', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'วา-อาหมิง', matches: 2, wins: 0, points: 0, qualified: false }
                            ],
                            matches: [
                                { id: 'M146', team1: 'กิ่ง-กาย', team2: 'โก้-ออม', score1: [21, 21], score2: [19, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M147', team1: 'กิ่ง-กาย', team2: 'วา-อาหมิง', score1: [21, 21], score2: [16, 18], sets1: 2, sets2: 0, completed: true },
                                { id: 'M148', team1: 'โก้-ออม', team2: 'วา-อาหมิง', score1: [21, 21], score2: [18, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        },
                        {
                            name: 'สาย 4',
                            teams: [
                                { rank: 1, name: 'มล-นัท', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 2, name: 'เหว่ยฮั่น-ตุ๊กติ๊ก', matches: 2, wins: 1, points: 3, qualified: true },
                                { rank: 3, name: 'ป๊อป-ซัน', matches: 2, wins: 1, points: 3, qualified: false }
                            ],
                            matches: [
                                { id: 'M149', team1: 'มล-นัท', team2: 'เหว่ยฮั่น-ตุ๊กติ๊ก', score1: [21, 19], score2: [19, 21], sets1: 1, sets2: 1, completed: true },
                                { id: 'M150', team1: 'มล-นัท', team2: 'ป๊อป-ซัน', score1: [21, 21], score2: [18, 17], sets1: 2, sets2: 0, completed: true },
                                { id: 'M151', team1: 'เหว่ยฮั่น-ตุ๊กติ๊ก', team2: 'ป๊อป-ซัน', score1: [21, 21], score2: [19, 16], sets1: 2, sets2: 0, completed: true }
                            ]
                        }
                    ],
                    knockoutMatches: [
                        { id: 'M152', team1: 'ชม-พี่ฮวด', team2: 'ชิ-ฟาง', score1: [21, 18, 21], score2: [19, 21, 17], sets1: 2, sets2: 1, completed: true },
                        { id: 'M153', team1: 'แฟ้ม-มุก', team2: 'เนส-บีม', score1: [21, 16, 21], score2: [18, 21, 19], sets1: 2, sets2: 1, completed: true },
                        { id: 'M154', team1: 'กิ่ง-กาย', team2: 'เหว่ยฮั่น-ตุ๊กติ๊ก', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M155', team1: 'มล-นัท', team2: 'โก้-ออม', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M156', team1: 'ชม-พี่ฮวด', team2: 'แฟ้ม-มุก', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M157', team1: 'รอผลรอบ8ทีม', team2: 'รอผลรอบ8ทีม', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ],
                    finals: [
                        { id: 'M158', type: 'championship', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false },
                        { id: 'M159', type: 'third-place', team1: 'รอผลรองชนะเลิศ', team2: 'รอผลรองชนะเลิศ', score1: [], score2: [], sets1: 0, sets2: 0, completed: false }
                    ]
                }
            };
            
            return data[category] || { groups: [], knockoutMatches: [], finals: [] };
        }

        function generateRoundRobinContent(data) {
            console.log('Generating round robin content with data:', data);
            
            if (!data || !data.groups) {
                console.error('Invalid data structure:', data);
                return '<div class="error">ข้อมูลไม่ถูกต้อง</div>';
            }
            
            let content = '<div class="groups-container">';
            
            data.groups.forEach(group => {
                content += `
                    <div class="group-card">
                        <div class="group-title">${group.name}</div>
                        <div class="standings-table">
                            <div class="table-header">
                                <span>อันดับ</span><span>ทีม</span><span>แมท</span><span>ชนะ</span><span>คะแนน</span>
                            </div>`;
                            
                group.teams.forEach(team => {
                    content += `
                        <div class="team-row ${team.qualified ? 'qualified' : ''}">
                            <span class="rank">${team.rank}</span>
                            <span class="team-name">${team.name}</span>
                            <span>${team.matches}</span>
                            <span>${team.wins}</span>
                            <span class="points">${team.points}</span>
                        </div>`;
                });
                
                content += '</div></div>';
            });
            
            content += '</div>';
            
            if (data.groups[0] && data.groups[0].matches) {
                content += `
                    <div class="round-robin-matches">
                        <h4 class="matches-section-title">รายการแมทรอบแรก</h4>`;
                        
                data.groups.forEach(group => {
                    if (group.matches && group.matches.length > 0) {
                        content += `
                            <div class="group-matches">
                                <div class="group-matches-title">${group.name}</div>`;
                                
                        group.matches.forEach(match => {
                            content += `
                                <div class="round-robin-match-card ${match.completed ? 'completed' : ''}">
                                    <div class="rr-match-header">
                                        <span>${match.id}</span>
                                        <span>${match.completed ? 'เสร็จสิ้น' : 'รอการแข่งขัน'}</span>
                                    </div>
                                    <div class="rr-match-teams">
                                        <div class="rr-team">
                                            <span class="rr-team-name">${match.team1}</span>
                                            <div class="score-display">`;
                                            
                            if (match.completed && match.score1 && match.score1.length > 0) {
                                match.score1.forEach((score, index) => {
                                    const isWin = match.score2[index] && score > match.score2[index];
                                    content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                                });
                                content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                            } else {
                                content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                            }
                            
                            content += `
                                            </div>
                                        </div>
                                        <div class="rr-vs">VS</div>
                                        <div class="rr-team">
                                            <span class="rr-team-name">${match.team2}</span>
                                            <div class="score-display">`;
                                            
                            if (match.completed && match.score2 && match.score2.length > 0) {
                                match.score2.forEach((score, index) => {
                                    const isWin = match.score1[index] && score > match.score1[index];
                                    content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                                });
                                content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                            } else {
                                content += `<span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                            }
                            
                            content += `
                                            </div>
                                        </div>
                                    </div>
                                </div>`;
                        });
                        
                        content += '</div>';
                    }
                });
                
                content += '</div>';
            }
            
            return content;
        }

        function generateKnockoutContent(data) {
            console.log('Generating knockout content with data:', data);
            
            if (!data || !data.knockoutMatches) {
                console.error('Invalid data structure for knockout:', data);
                return '<div class="error">ข้อมูลไม่ถูกต้อง</div>';
            }
            
            let content = `
                <div class="knockout-section">
                    <h4 class="section-title">รอบ ${data.knockoutMatches.length >= 4 ? '8' : data.knockoutMatches.length * 2} ทีม</h4>
                    <div class="matches-grid">`;
                    
            const round8Matches = data.knockoutMatches.slice(0, 4);
            round8Matches.forEach(match => {
                content += `
                    <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                        <div class="match-header">
                            <span>${match.id}</span>
                            <span>${match.completed ? 'เสร็จสิ้น' : 'รอการแข่งขัน'}</span>
                        </div>
                        <div class="match-teams">
                            <div class="team">
                                <span class="team-name">${match.team1}</span>
                                <div class="score-display">`;
                                
                if (match.completed && match.score1 && match.score1.length > 0) {
                    match.score1.forEach((score, index) => {
                        const isWin = match.score2[index] && score > match.score2[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                </div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="team">
                                <span class="team-name">${match.team2}</span>
                                <div class="score-display">`;
                                
                if (match.completed && match.score2 && match.score2.length > 0) {
                    match.score2.forEach((score, index) => {
                        const isWin = match.score1[index] && score > match.score1[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
            
            content += '</div>';
            
            // Add round 4 teams if exists
            const round4Matches = data.knockoutMatches.slice(4);
            if (round4Matches.length > 0) {
                content += `
                    <h4 class="section-title">รอบ 4 ทีม (รองชนะเลิศ)</h4>
                    <div class="matches-grid">`;
                    
                round4Matches.forEach(match => {
                    content += `
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? 'เสร็จสิ้น' : 'รอการแข่งขัน'}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score1 && match.score1.length > 0) {
                        match.score1.forEach((score, index) => {
                            const isWin = match.score2[index] && score > match.score2[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                    if (match.completed && match.score2 && match.score2.length > 0) {
                        match.score2.forEach((score, index) => {
                            const isWin = match.score1[index] && score > match.score1[index];
                            content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                        });
                        content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                    } else {
                        content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                    }
                    
                    content += `
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                
                content += '</div>';
            }
            
            content += '</div>';
            return content;
        }

        function generateFinalsContent(data) {
            console.log('Generating finals content with data:', data);
            
            if (!data || !data.finals) {
                console.error('Invalid data structure for finals:', data);
                return '<div class="error">ข้อมูลไม่ถูกต้อง</div>';
            }
            
            let content = '<div class="finals-section">';
            
            data.finals.forEach(match => {
                const matchClass = match.type === 'championship' ? 'championship' : 'third-place';
                const matchLabel = match.type === 'championship' ? '🏆 ชิงชนะเลิศ' : '🥉 ชิงอันดับ 3';
                
                content += `
                    <div class="final-match ${matchClass}">
                        <div class="match-label">${matchLabel}</div>
                        <div class="match-card ${match.completed ? 'completed' : 'pending'}">
                            <div class="match-header">
                                <span>${match.id}</span>
                                <span>${match.completed ? 'เสร็จสิ้น' : 'รอผลรองชนะเลิศ'}</span>
                            </div>
                            <div class="match-teams">
                                <div class="team">
                                    <span class="team-name">${match.team1}</span>
                                    <div class="score-display">`;
                                    
                if (match.completed && match.score1 && match.score1.length > 0) {
                    match.score1.forEach((score, index) => {
                        const isWin = match.score2[index] && score > match.score2[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    if (match.score1.length === 2) {
                        content += `<span class="set-score">-</span>`;
                    }
                    content += `<span class="total-sets ${match.sets1 > match.sets2 ? 'match-win' : ''}">(${match.sets1})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                    </div>
                                </div>
                                <div class="vs">VS</div>
                                <div class="team">
                                    <span class="team-name">${match.team2}</span>
                                    <div class="score-display">`;
                                    
                if (match.completed && match.score2 && match.score2.length > 0) {
                    match.score2.forEach((score, index) => {
                        const isWin = match.score1[index] && score > match.score1[index];
                        content += `<span class="set-score ${isWin ? 'set-win' : ''}">${score}</span>`;
                    });
                    if (match.score2.length === 2) {
                        content += `<span class="set-score">-</span>`;
                    }
                    content += `<span class="total-sets ${match.sets2 > match.sets1 ? 'match-win' : ''}">(${match.sets2})</span>`;
                } else {
                    content += `<span class="set-score">-</span><span class="set-score">-</span><span class="set-score">-</span><span class="total-sets">(-)</span>`;
                }
                
                content += `
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
            
            content += '</div>';
            return content;
        }

        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminPassword').focus();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === '987') {
                isAdminMode = true;
                closeAdminModal();
                showAdminPanel();
            } else {
                alert('รหัสผ่านไม่ถูกต้อง');
                document.getElementById('adminPassword').value = '';
            }
        }

        function showAdminPanel() {
            document.querySelectorAll('.nav-tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Hide navigation views and container
            document.getElementById('categoryView').style.display = 'none';
            document.getElementById('teamSearchView').style.display = 'none';
            document.querySelector('.nav-container').style.display = 'none';
            
            // Show admin content
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="admin-container">
                    <div class="admin-header">
                        <h2 class="admin-title">🔧 Admin Panel</h2>
                        <div class="admin-stats">ระบบจัดการการแข่งขัน MN Tournament</div>
                        <button class="admin-logout-btn" onclick="logoutAdmin()">ออกจากระบบ</button>
                    </div>
                    <div class="admin-tabs-container">
                        <div class="admin-tabs-nav">
                            <button class="admin-tab-btn active" onclick="switchAdminTab('match-management')">📝 บันทึกผล</button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('all-matches')">📋 ตารางแมท</button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('draw-system')">🎲 จับฉลาก</button>
                            <button class="admin-tab-btn" onclick="switchAdminTab('settings')">⚙️ ตั้งค่า</button>
                        </div>
                        <div class="admin-tab-content" id="adminTabContent">
                            ${getAdminTabContent('match-management')}
                        </div>
                    </div>
                </div>
            `;
        }

        function logoutAdmin() {
            isAdminMode = false;
            
            // Show navigation container back
            document.querySelector('.nav-container').style.display = 'block';
            
            showCategoryView();
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="welcome-screen">
                    <div class="welcome-icon">🏸</div>
                    <div class="welcome-title">ยินดีต้อนรับสู่การแข่งขัน</div>
                    <div class="welcome-text">
                        เลือกประเภทการแข่งขันด้านบนเพื่อดูผลการแข่งขันและตารางการแข่งขัน
                        <br><br>
                        📱 แอปนี้ออกแบบมาเพื่อการใช้งานบนมือถือ
                    </div>
                </div>
            `;
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const tabContent = document.getElementById('adminTabContent');
            tabContent.innerHTML = getAdminTabContent(tab);
            
            // Update data stats when opening settings tab
            if (tab === 'settings') {
                setTimeout(() => {
                    updateDataStats();
                }, 100);
            }
        }

        function getAdminTabContent(tab) {
            switch(tab) {
                case 'match-management':
                    return generateMatchManagementContent();
                case 'all-matches':
                    // Initialize data when opening this tab
                    allMatchesData = calculateAllMatchesStats();
                    return generateAllMatchesContent();
                case 'draw-system':
                    return generateDrawSystemContent();
                case 'settings':
                    return generateSettingsContent();
                default:
                    return '<div class="admin-placeholder">เลือกแท็บด้านบน</div>';
            }
        }

        function generateMatchManagementContent() {
            return `
                <div class="match-management-container">
                    <div class="match-management-header">
                        <h3>📝 บันทึกผลการแข่งขัน</h3>
                        <p>เลือกประเภทและรอบการแข่งขันที่ต้องการบันทึกผล หรือค้นหาจากชื่อทีม</p>
                    </div>
                    
                    <div class="selectors-container">
                        <div class="category-selector">
                            <label for="adminCategorySelect">ประเภทการแข่งขัน:</label>
                            <select id="adminCategorySelect" class="admin-select" onchange="loadAdminMatches()">
                                <option value="">เลือกประเภท</option>
                                <option value="A">มือ A</option>
                                <option value="B">มือ B</option>
                                <option value="C-B">มือ C-B</option>
                                <option value="C-C">มือ C-C</option>
                                <option value="D">มือ D</option>
                                <option value="ใหม่">มือใหม่</option>
                                <option value="ผสม">มือผสม</option>
                            </select>
                        </div>
                        
                        <div class="round-selector">
                            <label for="adminRoundSelect">รอบการแข่งขัน:</label>
                            <select id="adminRoundSelect" class="admin-select" onchange="filterMatchesByRound()">
                                <option value="">ทุกรอบ</option>
                                <option value="รอบแรก">รอบแรก (Round Robin)</option>
                                <option value="รอบ 8 ทีม">รอบ 8 ทีม</option>
                                <option value="รอบ 4 ทีม">รอบ 4 ทีม (รองชนะเลิศ)</option>
                                <option value="ชิงชนะเลิศ">ชิงชนะเลิศ</option>
                                <option value="ชิงอันดับ 3">ชิงอันดับ 3</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="team-search-section">
                        <label for="adminTeamSearch">ค้นหาจากชื่อทีม:</label>
                        <div class="admin-search-container">
                            <input type="text" id="adminTeamSearch" class="admin-search-input" 
                                   placeholder="พิมพ์ชื่อทีม เช่น เอก-ชัย" 
                                   oninput="searchAdminMatches()">
                            <button class="clear-search-btn" onclick="clearAdminSearch()">✕</button>
                        </div>
                        <div class="search-hint">💡 พิมพ์ชื่อทีมเพื่อค้นหาแมทที่เกี่ยวข้องทั้งหมด</div>
                    </div>
                    
                    <div id="adminMatchesList" class="admin-matches-list">
                        <div class="no-selection">เลือกประเภทการแข่งขันหรือค้นหาชื่อทีมเพื่อดูรายการแมท</div>
                    </div>
                </div>
            `;
        }

        function generateAllMatchesContent() {
            // คำนวณสถิติทั้งหมด
            const allMatchesData = calculateAllMatchesStats();
            
            return `
                <div class="all-matches-container">
                    <div class="all-matches-header">
                        <h3>📋 ตารางแมททั้งหมด</h3>
                        <div class="matches-summary">
                            <div class="summary-item">
                                <span class="summary-label">แมททั้งหมด:</span>
                                <span class="summary-value">159</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">เสร็จแล้ว:</span>
                                <span class="summary-value">${allMatchesData.completed}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">คงเหลือ:</span>
                                <span class="summary-value">${allMatchesData.pending}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="all-matches-filters">
                        <div class="filter-group">
                            <label for="allMatchesCategoryFilter">กรองตามประเภท:</label>
                            <select id="allMatchesCategoryFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value="">ทุกประเภท</option>
                                <option value="A">มือ A</option>
                                <option value="B">มือ B</option>
                                <option value="C-B">มือ C-B</option>
                                <option value="C-C">มือ C-C</option>
                                <option value="D">มือ D</option>
                                <option value="ใหม่">มือใหม่</option>
                                <option value="ผสม">มือผสม</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="allMatchesRoundFilter">กรองตามรอบ:</label>
                            <select id="allMatchesRoundFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value="">ทุกรอบ</option>
                                <option value="รอบแรก">รอบแรก</option>
                                <option value="รอบ 8 ทีม">รอบ 8 ทีม</option>
                                <option value="รอบ 4 ทีม">รอบ 4 ทีม</option>
                                <option value="ชิงชนะเลิศ">ชิงชนะเลิศ</option>
                                <option value="ชิงอันดับ 3">ชิงอันดับ 3</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="allMatchesStatusFilter">กรองตามสถานะ:</label>
                            <select id="allMatchesStatusFilter" class="admin-select" onchange="filterAllMatches()">
                                <option value="">ทุกสถานะ</option>
                                <option value="completed">เสร็จแล้ว</option>
                                <option value="pending">รอการแข่งขัน</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="allMatchesTable" class="all-matches-table">
                        ${generateAllMatchesTable(allMatchesData.matches)}
                    </div>
                </div>
            `;
        }

        function calculateAllMatchesStats() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            let allMatches = [];
            let completedCount = 0;
            
            categories.forEach(category => {
                const categoryData = getCategoryData(category);
                
                // รอบแรก
                categoryData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        const matchData = {
                            ...match,
                            category,
                            round: 'รอบแรก',
                            group: group.name,
                            roundSort: 1
                        };
                        allMatches.push(matchData);
                        if (match.completed) completedCount++;
                    });
                });
                
                // รอบน็อกเอาท์
                categoryData.knockoutMatches.forEach((match, index) => {
                    const totalKnockout = categoryData.knockoutMatches.length;
                    let roundName = 'รอบ 8 ทีม';
                    let roundSort = 2;
                    
                    if (totalKnockout >= 4) {
                        if (index >= 4) {
                            roundName = 'รอบ 4 ทีม';
                            roundSort = 3;
                        }
                    } else {
                        roundName = 'รอบ 4 ทีม';
                        roundSort = 3;
                    }
                    
                    const matchData = {
                        ...match,
                        category,
                        round: roundName,
                        group: null,
                        roundSort
                    };
                    allMatches.push(matchData);
                    if (match.completed) completedCount++;
                });
                
                // ชิงชนะเลิศ
                categoryData.finals.forEach(match => {
                    const roundName = match.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3';
                    const roundSort = match.type === 'championship' ? 4 : 5;
                    
                    const matchData = {
                        ...match,
                        category,
                        round: roundName,
                        group: null,
                        roundSort
                    };
                    allMatches.push(matchData);
                    if (match.completed) completedCount++;
                });
            });
            
            // เรียงตาม category และ match ID
            allMatches.sort((a, b) => {
                const categoryOrder = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
                const catA = categoryOrder.indexOf(a.category);
                const catB = categoryOrder.indexOf(b.category);
                
                if (catA !== catB) return catA - catB;
                return a.id.localeCompare(b.id);
            });
            
            return {
                matches: allMatches,
                completed: completedCount,
                pending: 159 - completedCount
            };
        }

        function generateAllMatchesTable(matches) {
            return `
                <div class="matches-table-container">
                    <div class="matches-table-header">
                        <div class="table-stats">แสดง ${matches.length} แมท จากทั้งหมด 159 แมท</div>
                    </div>
                    <div class="matches-table-scroll">
                        <table class="matches-table">
                            <thead>
                                <tr>
                                    <th>Match ID</th>
                                    <th>ประเภท</th>
                                    <th>รอบ</th>
                                    <th>ทีม 1</th>
                                    <th>ทีม 2</th>
                                    <th>ผลการแข่งขัน</th>
                                    <th>สถานะ</th>
                                    <th>จัดการ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${matches.map(match => generateMatchTableRow(match)).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ===================== Draw System (Manual) =====================
        let drawOverrides = {};
        let drawHistory = [];

        function loadDrawPersistence() {
            try {
                const o = localStorage.getItem('mn_draw_overrides');
                const h = localStorage.getItem('mn_draw_history');
                drawOverrides = o ? JSON.parse(o) : {};
                drawHistory = h ? JSON.parse(h) : [];
            } catch(e) {
                drawOverrides = {};
                drawHistory = [];
            }
        }

        function saveDrawPersistence() {
            localStorage.setItem('mn_draw_overrides', JSON.stringify(drawOverrides));
            localStorage.setItem('mn_draw_history', JSON.stringify(drawHistory));
        }

        function applyDrawOverridesToData(data) {
            if (!data) return;
            if (data.knockoutMatches) {
                data.knockoutMatches = data.knockoutMatches.map(m => {
                    const o = drawOverrides[m.id];
                    if (o) {
                        return { ...m, team1: o.team1 || m.team1, team2: o.team2 || m.team2 };
                    }
                    return m;
                });
            }
            if (data.finals) {
                data.finals = data.finals.map(m => {
                    const o = drawOverrides[m.id];
                    if (o) {
                        return { ...m, team1: o.team1 || m.team1, team2: o.team2 || m.team2 };
                    }
                    return m;
                });
            }
        }

        function generateDrawSystemContent() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            const options = categories.map(c => `<option value="${c}">มือ ${c}</option>`).join('');
            const teamList = (allTeams || []).map(t => t.name);
            const datalist = teamList.map(n => `<option value="${n}"></option>`).join('');

            return `
                <div class="draw-container">
                    <div class="draw-header">
                        <h3>🎲 ระบบจับฉลาก (บันทึกจากการจับแมนน่วล)</h3>
                        <p>เลือกประเภทและกรอกคู่ประกบของแมทที่รอจับฉลาก จากนั้นกดบันทึก</p>
                    </div>
                    <div class="selectors-container">
                        <div class="category-selector">
                            <label for="drawCategorySelect">ประเภทการแข่งขัน:</label>
                            <select id="drawCategorySelect" class="admin-select" onchange="renderDrawMatches()">
                                <option value="">เลือกประเภท</option>
                                ${options}
                            </select>
                        </div>
                    </div>

                    <div id="drawMatchesArea" class="draw-matches-area">
                        <div class="admin-placeholder">เลือกประเภทเพื่อแสดงรายการแมทที่รอจับฉลาก</div>
                    </div>

                    <div class="draw-history">
                        <h4>🗂 ประวัติการจับฉลาก (${drawHistory.length})</h4>
                        <div id="drawHistoryTable">${generateDrawHistoryTable()}</div>
                    </div>

                    <datalist id="teamNamesList">${datalist}</datalist>
                </div>
            `;
        }

        function generateDrawHistoryTable() {
            if (!drawHistory || drawHistory.length === 0) {
                return '<div class="admin-placeholder">ยังไม่มีประวัติการจับฉลาก</div>';
            }
            const rows = drawHistory.slice().reverse().map(h => `
                <tr>
                    <td>${h.date}</td>
                    <td>มือ ${h.category}</td>
                    <td>${h.round}</td>
                    <td>${h.matchId}</td>
                    <td>${h.team1}</td>
                    <td>${h.team2}</td>
                    <td>${h.drawnBy || '-'}</td>
                    <td>${h.notes || ''}</td>
                </tr>
            `).join('');
            return `
                <div class="matches-table-scroll">
                    <table class="matches-table">
                        <thead>
                            <tr>
                                <th>วันที่</th>
                                <th>ประเภท</th>
                                <th>รอบ</th>
                                <th>Match ID</th>
                                <th>ทีม 1</th>
                                <th>ทีม 2</th>
                                <th>ผู้บันทึก</th>
                                <th>หมายเหตุ</th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `;
        }

        function getWaitingDrawMatches(categoryKey) {
            const data = getCategoryData(categoryKey);
            const waiting = [];
            const isPlaceholder = (name) => !name || name.includes('รอผล') || name.includes('รอจับฉลาก') || name === 'TBD';
            data.knockoutMatches.forEach((m, idx) => {
                let round = data.knockoutMatches.length >= 4 && idx < 4 ? 'รอบ 8 ทีม' : 'รอบ 4 ทีม';
                if (isPlaceholder(m.team1) || isPlaceholder(m.team2)) {
                    waiting.push({ ...m, round });
                }
            });
            data.finals.forEach(m => {
                const round = m.type === 'championship' ? 'ชิงชนะเลิศ' : 'ชิงอันดับ 3';
                if (isPlaceholder(m.team1) || isPlaceholder(m.team2)) {
                    waiting.push({ ...m, round });
                }
            });
            return waiting;
        }

        function renderDrawMatches() {
            const cat = document.getElementById('drawCategorySelect').value;
            const area = document.getElementById('drawMatchesArea');
            if (!cat) {
                area.innerHTML = '<div class="admin-placeholder">เลือกประเภทเพื่อแสดงรายการแมทที่รอจับฉลาก</div>';
                return;
            }
            const matches = getWaitingDrawMatches(cat);
            if (matches.length === 0) {
                area.innerHTML = '<div class="admin-placeholder">ไม่มีแมทที่รอจับฉลากในประเภทนี้</div>';
                return;
            }
            const cards = matches.map(m => `
                <div class="match-card pending">
                    <div class="match-header">
                        <span>${m.id}</span>
                        <span>${m.round}</span>
                    </div>
                    <div class="match-teams">
                        <div class="team">
                            <span class="team-name">ทีม 1</span>
                            <input list="teamNamesList" class="admin-search-input" id="draw_${m.id}_t1" placeholder="${m.team1 || 'พิมพ์ชื่อทีม'}">
                        </div>
                        <div class="rr-vs">VS</div>
                        <div class="team">
                            <span class="team-name">ทีม 2</span>
                            <input list="teamNamesList" class="admin-search-input" id="draw_${m.id}_t2" placeholder="${m.team2 || 'พิมพ์ชื่อทีม'}">
                        </div>
                    </div>
                    <div class="match-actions" style="margin-top: 10px;">
                        <button class="table-btn-record" onclick="applyDrawForMatch('${cat}','${m.round}','${m.id}')">บันทึกคู่ประกบ</button>
                    </div>
                </div>
            `).join('');
            area.innerHTML = `<div class="matches-grid">${cards}</div>`;
        }

        function applyDrawForMatch(categoryKey, roundText, matchId) {
            const t1 = (document.getElementById(`draw_${matchId}_t1`).value || '').trim();
            const t2 = (document.getElementById(`draw_${matchId}_t2`).value || '').trim();
            if (!t1 || !t2) {
                alert('กรุณากรอกชื่อทีมทั้งสองฝั่ง');
                return;
            }
            drawOverrides[matchId] = { team1: t1, team2: t2 };
            drawHistory.push({
                date: new Date().toLocaleString(),
                category: categoryKey,
                round: roundText,
                matchId,
                team1: t1,
                team2: t2,
                drawnBy: 'admin',
                notes: ''
            });
            saveDrawPersistence();
            alert(`บันทึกคู่ประกบให้แมท ${matchId} เรียบร้อย`);
            renderDrawMatches();
        }

        // ===================== Settings System =====================
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1xtwqAxLOdKJknKxxYCNQ14Vm2inMIfuKg5Xddsy69rw/edit?usp=sharing';
        const GOOGLE_SHEETS_ID = '1xtwqAxLOdKJknKxxYCNQ14Vm2inMIfuKg5Xddsy69rw';
        
        // Google Apps Script Web App URL - ต้องอัปเดตหลังจาก Deploy
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby0MX9n8pxxurUmv9lrhpCK0hu8RLlo3f1gT0D9PLWQrJNquwngETlPlQCyJUrCOD3IYg/exec';

        function generateSettingsContent() {
            return `
                <div class="settings-container">
                    <div class="settings-header">
                        <h3>⚙️ ตั้งค่าระบบ</h3>
                        <p>จัดการข้อมูลและตั้งค่าระบบการแข่งขัน</p>
                    </div>
                    
                    <div class="settings-sections">
                        <!-- Data Management Section -->
                        <div class="settings-section">
                            <h4>📊 การจัดการข้อมูล</h4>
                            <div class="settings-actions">
                                <div class="action-group">
                                    <label>รีเซ็ตระบบทั้งหมด:</label>
                                    <button class="danger-btn" onclick="showResetModal('system')">🗑️ รีเซ็ตระบบ</button>
                                    <small>ล้างข้อมูลทั้งหมด (รหัส: 567)</small>
                                </div>
                                <div class="action-group">
                                    <label>รีเซ็ตข้อมูลจับฉลาก:</label>
                                    <button class="warning-btn" onclick="showResetModal('draw')">🎲 รีเซ็ตจับฉลาก</button>
                                    <small>ล้างข้อมูลจับฉลากเท่านั้น (รหัส: 567)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Testing Section -->
                        <div class="settings-section">
                            <h4>🧪 การทดสอบระบบ</h4>
                            <div class="settings-actions">
                                <div class="action-group">
                                    <label>ทดสอบการแสดงผลทุกประเภท:</label>
                                    <button class="btn" onclick="testAllCategories()">🧪 ทดสอบทุกประเภท</button>
                                    <small>ทดสอบการแสดงผล Mock data ในทุกประเภท</small>
                                </div>
                                <div class="action-group">
                                    <label>ตรวจสอบความสมบูรณ์ของ Mock Data:</label>
                                    <button class="btn" onclick="validateMockData()">🔍 ตรวจสอบ Mock Data</button>
                                    <small>ตรวจสอบโครงสร้างและความสมบูรณ์ของข้อมูล Mock</small>
                                </div>
                                <div class="action-group">
                                    <label>ทดสอบ Google Sheets API:</label>
                                    <button class="btn" onclick="testGoogleSheetsAPI()">🔗 ทดสอบ Google Sheets API</button>
                                    <small>ทดสอบการเชื่อมต่อและดึงข้อมูลจาก Google Sheets</small>
                                </div>
                                <div class="action-group">
                                    <label>ล้าง Cache ข้อมูล:</label>
                                    <button class="btn" onclick="clearCategoryCache()">🗑️ ล้าง Cache ทั้งหมด</button>
                                    <small>ล้างข้อมูล Cache เพื่อดึงข้อมูลใหม่จาก Google Sheets</small>
                                </div>
                                <div class="action-group">
                                    <label>ตรวจสอบข้อผิดพลาด:</label>
                                    <button class="btn" onclick="checkForErrors()">🔧 ตรวจสอบข้อผิดพลาด</button>
                                    <small>ตรวจสอบข้อผิดพลาดทั่วไปและความพร้อมของระบบ</small>
                                </div>
                            </div>
                        </div>

                        <!-- Google Sheets Section -->
                        <div class="settings-section">
                            <h4>📋 Google Sheets</h4>
                            <div class="sheets-info">
                                <div class="info-item">
                                    <label>Google Sheets URL:</label>
                                    <a href="${GOOGLE_SHEETS_URL}" target="_blank" class="sheets-link">${GOOGLE_SHEETS_URL}</a>
                                </div>
                                <div class="info-item">
                                    <label>Apps Script URL:</label>
                                    <div class="url-input-container">
                                        <input type="text" id="appsScriptUrl" class="url-input" 
                                               placeholder="วาง Web App URL ที่ได้จาก Apps Script" 
                                               value="${GOOGLE_APPS_SCRIPT_URL}">
                                        <button class="small-btn" onclick="updateAppsScriptUrl()">อัปเดต</button>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <label>สถานะ:</label>
                                    <span id="sheetsStatus" class="status-indicator">🔍 กำลังตรวจสอบ...</span>
                                </div>
                            </div>
                            <div class="settings-actions">
                                <button class="primary-btn" onclick="testGoogleSheetsConnection()">🔗 ทดสอบการเชื่อมต่อ</button>
                                <button class="secondary-btn" onclick="openGoogleSheets()">📖 เปิด Google Sheets</button>
                                <button class="secondary-btn" onclick="showSetupInstructions()">📋 วิธีติดตั้ง</button>
                            </div>
                        </div>

                        <!-- System Info Section -->
                        <div class="settings-section">
                            <h4>ℹ️ ข้อมูลระบบ</h4>
                            <div class="system-info">
                                <div class="info-item">
                                    <label>เวอร์ชัน:</label>
                                    <span>MN Tournament 2025 v1.0</span>
                                </div>
                                <div class="info-item">
                                    <label>ข้อมูลในระบบ:</label>
                                    <span id="dataStats">กำลังโหลด...</span>
                                </div>
                                <div class="info-item">
                                    <label>ข้อมูลจับฉลาก:</label>
                                    <span id="drawStats">กำลังโหลด...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reset Confirmation Modal -->
                <div class="modal" id="resetModal">
                    <div class="modal-content">
                        <h3 id="resetModalTitle">ยืนยันการรีเซ็ต</h3>
                        <p id="resetModalMessage">คุณแน่ใจหรือไม่ที่จะรีเซ็ตข้อมูล?</p>
                        <div class="password-section">
                            <label for="resetPassword">รหัสผ่าน:</label>
                            <input type="password" id="resetPassword" placeholder="กรอกรหัสผ่าน" maxlength="3">
                        </div>
                        <div class="modal-buttons">
                            <button class="modal-btn btn-cancel" onclick="closeResetModal()">ยกเลิก</button>
                            <button class="modal-btn btn-danger" onclick="confirmReset()">ยืนยัน</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showResetModal(type) {
            const modal = document.getElementById('resetModal');
            const title = document.getElementById('resetModalTitle');
            const message = document.getElementById('resetModalMessage');
            
            if (type === 'system') {
                title.textContent = '🗑️ รีเซ็ตระบบทั้งหมด';
                message.textContent = 'การดำเนินการนี้จะล้างข้อมูลทั้งหมดในระบบ รวมถึงผลการแข่งขันและข้อมูลจับฉลาก';
            } else if (type === 'draw') {
                title.textContent = '🎲 รีเซ็ตข้อมูลจับฉลาก';
                message.textContent = 'การดำเนินการนี้จะล้างเฉพาะข้อมูลการจับฉลากเท่านั้น';
            }
            
            modal.dataset.resetType = type;
            modal.style.display = 'block';
            document.getElementById('resetPassword').focus();
        }

        function closeResetModal() {
            document.getElementById('resetModal').style.display = 'none';
            document.getElementById('resetPassword').value = '';
        }

        function confirmReset() {
            const password = document.getElementById('resetPassword').value;
            const resetType = document.getElementById('resetModal').dataset.resetType;
            
            if (password !== '567') {
                alert('รหัสผ่านไม่ถูกต้อง');
                return;
            }
            
            if (resetType === 'system') {
                resetAllSystem();
            } else if (resetType === 'draw') {
                resetDrawSystem();
            }
            
            closeResetModal();
        }

        function resetAllSystem() {
            if (confirm('⚠️ คุณแน่ใจหรือไม่ที่จะล้างข้อมูลทั้งหมด?\n\nการดำเนินการนี้ไม่สามารถย้อนกลับได้!')) {
                // Clear all localStorage data
                localStorage.clear();
                
                // Reset global variables
                drawOverrides = {};
                drawHistory = [];
                allTeams = [];
                currentAdminMatches = [];
                allMatchesData = null;
                
                alert('✅ รีเซ็ตระบบทั้งหมดเรียบร้อย\n\nข้อมูลทั้งหมดถูกล้างแล้ว');
                
                // Refresh the page to reset everything
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }

        function resetDrawSystem() {
            if (confirm('⚠️ คุณแน่ใจหรือไม่ที่จะล้างข้อมูลการจับฉลาก?\n\nการดำเนินการนี้ไม่สามารถย้อนกลับได้!')) {
                // Clear only draw-related data
                localStorage.removeItem('mn_draw_overrides');
                localStorage.removeItem('mn_draw_history');
                
                // Reset draw variables
                drawOverrides = {};
                drawHistory = [];
                
                alert('✅ รีเซ็ตข้อมูลจับฉลากเรียบร้อย\n\nข้อมูลการจับฉลากถูกล้างแล้ว');
                
                // Refresh draw system if it's currently open
                if (document.getElementById('drawMatchesArea')) {
                    renderDrawMatches();
                }
            }
        }

        async function testGoogleSheetsConnection() {
            const statusElement = document.getElementById('sheetsStatus');
            statusElement.innerHTML = '🔄 กำลังทดสอบ...';
            
            try {
                // ตรวจสอบว่าได้ตั้งค่า URL แล้วหรือยัง
                if (GOOGLE_APPS_SCRIPT_URL === 'YOUR_WEB_APP_URL_HERE') {
                    statusElement.innerHTML = '⚠️ ยังไม่ได้ตั้งค่า URL';
                    statusElement.className = 'status-indicator warning';
                    alert('⚠️ กรุณาตั้งค่า Google Apps Script URL ก่อน!\n\n1. Deploy Google Apps Script เป็น Web App\n2. คัดลอก Web App URL\n3. อัปเดต GOOGLE_APPS_SCRIPT_URL ในโปรแกรม');
                    return;
                }
                
                // ทดสอบการเชื่อมต่อ Google Apps Script
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    statusElement.innerHTML = '✅ เชื่อมต่อสำเร็จ';
                    statusElement.className = 'status-indicator success';
                    alert('✅ การเชื่อมต่อ Google Sheets สำเร็จ!\n\nสามารถอ่านและเขียนข้อมูลได้ปกติ');
                } else {
                    throw new Error(result.message || 'Unknown error');
                }
                
            } catch (error) {
                console.error('Google Sheets connection test failed:', error);
                statusElement.innerHTML = '❌ เชื่อมต่อล้มเหลว';
                statusElement.className = 'status-indicator error';
                alert(`❌ การเชื่อมต่อ Google Sheets ล้มเหลว!\n\nข้อผิดพลาด: ${error.message}\n\nกรุณาตรวจสอบ:\n1. Google Apps Script ได้ Deploy แล้ว\n2. URL ถูกต้อง\n3. การตั้งค่า "Who has access: Anyone"`);
            }
        }

        function openGoogleSheets() {
            window.open(GOOGLE_SHEETS_URL, '_blank');
        }

        function updateAppsScriptUrl() {
            const urlInput = document.getElementById('appsScriptUrl');
            const newUrl = urlInput.value.trim();
            
            if (!newUrl) {
                alert('กรุณาใส่ Apps Script URL');
                return;
            }
            
            if (newUrl === 'YOUR_WEB_APP_URL_HERE') {
                alert('กรุณาใส่ URL ที่ถูกต้องจาก Google Apps Script');
                return;
            }
            
            // อัปเดต URL ในโปรแกรม (ในความเป็นจริงจะต้องอัปเดตในไฟล์)
            // สำหรับตอนนี้จะเก็บใน localStorage
            localStorage.setItem('mn_apps_script_url', newUrl);
            
            alert('✅ อัปเดต Apps Script URL เรียบร้อย!\n\nกรุณา Refresh หน้าเว็บเพื่อให้การเปลี่ยนแปลงมีผล');
        }

        function showSetupInstructions() {
            const instructions = `
🚀 วิธีติดตั้ง Google Apps Script:

1. เปิด Google Sheets:
   ${GOOGLE_SHEETS_URL}

2. ไปที่ Extensions > Apps Script

3. ลบโค้ดเดิมและวางโค้ดจากไฟล์:
   google_apps_script.js

4. คลิก Deploy > New deployment
   - Type: Web app
   - Execute as: Me
   - Who has access: Anyone

5. คัดลอก Web App URL และวางในช่องด้านบน

6. คลิก "ทดสอบการเชื่อมต่อ"

📁 ไฟล์ที่ต้องใช้:
- google_apps_script.js (โค้ด Apps Script)
- GOOGLE_APPS_SCRIPT_SETUP.md (คู่มือละเอียด)
            `;
            
            alert(instructions);
        }

        function updateDataStats() {
            const dataStats = document.getElementById('dataStats');
            const drawStats = document.getElementById('drawStats');
            
            if (dataStats) {
                const totalMatches = 159;
                const completedMatches = calculateCompletedMatches();
                dataStats.textContent = `เสร็จแล้ว ${completedMatches}/${totalMatches} แมท`;
            }
            
            if (drawStats) {
                const totalDraws = Object.keys(drawOverrides).length;
                const totalHistory = drawHistory.length;
                drawStats.textContent = `คู่ประกบ ${totalDraws} แมท, ประวัติ ${totalHistory} รายการ`;
            }
        }

        function calculateCompletedMatches() {
            const categories = ['A', 'B', 'C-B', 'C-C', 'D', 'ใหม่', 'ผสม'];
            let completed = 0;
            
            categories.forEach(category => {
                const categoryData = getCategoryData(category);
                
                // Count completed matches in groups
                categoryData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        if (match.completed) completed++;
                    });
                });
                
                // Count completed knockout matches
                categoryData.knockoutMatches.forEach(match => {
                    if (match.completed) completed++;
                });
                
                // Count completed finals
                categoryData.finals.forEach(match => {
                    if (match.completed) completed++;
                });
            });
            
            return completed;
        }

        function generateMatchTableRow(match) {
            const statusClass = match.completed ? 'completed' : 'pending';
            const statusText = match.completed ? 'เสร็จแล้ว' : 'รอการแข่งขัน';
            const roundText = match.group ? `${match.round} (${match.group})` : match.round;
            
            let scoreDisplay = '-';
            if (match.completed && match.score1 && match.score2) {
                const scores = match.score1.map((s1, i) => `${s1}-${match.score2[i]}`).join(', ');
                scoreDisplay = `${scores} (${match.sets1}-${match.sets2})`;
            }
            
            return `
                <tr class="match-row ${statusClass}">
                    <td class="match-id">${match.id}</td>
                    <td class="match-category">มือ ${match.category}</td>
                    <td class="match-round">${roundText}</td>
                    <td class="team-name">${match.team1}</td>
                    <td class="team-name">${match.team2}</td>
                    <td class="match-score">${scoreDisplay}</td>
                    <td class="match-status">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td class="match-actions">
                        ${match.completed ? 
                            `<button class="table-btn-edit" onclick="editMatchHandler('${match.id}')">แก้ไข</button>` :
                            `<button class="table-btn-record" onclick="recordMatchHandler('${match.id}')">บันทึก</button>`
                        }
                    </td>
                </tr>
            `;
        }

        let allMatchesData = null; // เก็บข้อมูลแมททั้งหมด

        function filterAllMatches() {
            if (!allMatchesData) {
                allMatchesData = calculateAllMatchesStats();
            }
            
            const categoryFilter = document.getElementById('allMatchesCategoryFilter').value;
            const roundFilter = document.getElementById('allMatchesRoundFilter').value;
            const statusFilter = document.getElementById('allMatchesStatusFilter').value;
            
            let filteredMatches = allMatchesData.matches;
            
            if (categoryFilter) {
                filteredMatches = filteredMatches.filter(match => match.category === categoryFilter);
            }
            
            if (roundFilter) {
                filteredMatches = filteredMatches.filter(match => match.round === roundFilter);
            }
            
            if (statusFilter === 'completed') {
                filteredMatches = filteredMatches.filter(match => match.completed);
            } else if (statusFilter === 'pending') {
                filteredMatches = filteredMatches.filter(match => !match.completed);
            }
            
            document.getElementById('allMatchesTable').innerHTML = generateAllMatchesTable(filteredMatches);
        }

        // ฟังก์ชันทดสอบการเชื่อมต่อแบบง่าย
        async function testConnection() {
            try {
                console.log('Testing connection to:', GOOGLE_APPS_SCRIPT_URL);
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=test`);
                const result = await response.json();
                console.log('Connection test result:', result);
                return result.status === 'success';
            } catch (error) {
                console.error('Connection test failed:', error);
                return false;
            }
        }

        async function refreshData() {
            console.log('=== REFRESH DEBUG START ===');
            console.log('Current category:', currentCategory);
            console.log('Google Apps Script URL:', GOOGLE_APPS_SCRIPT_URL);
            
            if (!currentCategory) {
                console.log('No category selected for refresh');
                alert('⚠️ กรุณาเลือกประเภทการแข่งขันก่อน');
                return;
            }
            
            // ทดสอบการเชื่อมต่อก่อน
            console.log('Testing connection...');
            const connectionOk = await testConnection();
            if (!connectionOk) {
                alert('⚠️ ไม่สามารถเชื่อมต่อ Google Apps Script ได้\n\nกรุณาตรวจสอบ:\n• การเชื่อมต่ออินเทอร์เน็ต\n• Google Apps Script URL\n• การตั้งค่า Web App');
                return;
            }
            console.log('Connection test passed');
            
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalContent = refreshBtn.innerHTML;
            
            try {
                // แสดงสถานะการรีเฟรช
                refreshBtn.innerHTML = '⏳';
                refreshBtn.disabled = true;
                refreshBtn.title = 'กำลังรีเฟรช...';
                refreshBtn.className = 'refresh-btn loading';
                
                // ล้างแคชของประเภทปัจจุบัน
                console.log('Clearing cache for category:', currentCategory);
                clearCategoryCache(currentCategory);
                
                // รีเฟรชข้อมูล
                console.log('Refreshing data for category:', currentCategory);
                console.log('Calling loadCategory with fromRefresh=true');
                await loadCategory(currentCategory, true);
                console.log('loadCategory completed successfully');
                
                // แสดงสถานะสำเร็จ
                refreshBtn.innerHTML = '✅';
                refreshBtn.title = 'รีเฟรชสำเร็จ!';
                refreshBtn.className = 'refresh-btn success';
                
                // รีเซ็ตปุ่มหลังจาก 2 วินาที
                setTimeout(() => {
                    refreshBtn.innerHTML = originalContent;
                    refreshBtn.disabled = false;
                    refreshBtn.title = 'รีเฟรชข้อมูล';
                    refreshBtn.className = 'refresh-btn';
                }, 2000);
                
            } catch (error) {
                console.error('=== REFRESH ERROR ===');
                console.error('Error refreshing data:', error);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                
                // แสดงสถานะข้อผิดพลาด
                refreshBtn.innerHTML = '❌';
                refreshBtn.title = 'รีเฟรชล้มเหลว!';
                refreshBtn.className = 'refresh-btn error';
                
                // แสดงข้อความแจ้งเตือนที่ละเอียดขึ้น
                let errorMessage = '⚠️ ไม่สามารถรีเฟรชข้อมูลได้\n\n';
                if (error.message.includes('fetch')) {
                    errorMessage += '• ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต\n';
                    errorMessage += '• ตรวจสอบ Google Apps Script URL\n';
                } else if (error.message.includes('JSON')) {
                    errorMessage += '• ข้อมูลที่ได้รับไม่ถูกต้อง\n';
                    errorMessage += '• ตรวจสอบ Google Sheets\n';
                } else {
                    errorMessage += `• ข้อผิดพลาด: ${error.message}\n`;
                }
                errorMessage += '\nกรุณาลองใหม่อีกครั้ง';
                
                alert(errorMessage);
                
                // รีเซ็ตปุ่มหลังจาก 3 วินาที
                setTimeout(() => {
                    refreshBtn.innerHTML = originalContent;
                    refreshBtn.disabled = false;
                    refreshBtn.title = 'รีเฟรชข้อมูล';
                    refreshBtn.className = 'refresh-btn';
                }, 3000);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });
            
            // Add event listener for reset password Enter key
            document.addEventListener('keypress', function(e) {
                if (e.target && e.target.id === 'resetPassword' && e.key === 'Enter') {
                    confirmReset();
                }
            });
            
            document.getElementById('adminModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAdminModal();
                }
            });
            
            document.getElementById('scoreModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeScoreModal();
                }
            });
            
            // Add event listener for reset modal
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'resetModal') {
                    closeResetModal();
                }
            });
            
            // Initialize teams list when page loads
            initializeTeamsList();
        });
    </script>
</body>
</html>
